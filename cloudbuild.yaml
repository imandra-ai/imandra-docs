substitutions:
  TAG_NAME: trigger
steps:
  - name: gcr.io/cloud-builders/gcloud
    id: 'submit-build'
    waitFor: ['-']
    entrypoint: '/bin/bash'
    env:
      - "IMANDRA_DOCS_BUILDER=eu.gcr.io/imandra-dev/imandra-docs-builder:8133b6ee2fd35064d4e2bbdf6e7e1e64617976c2"
    args:
      - '-c'
      - |
        mkdir -p tmp
        gsutil cp 'gs://imandra-dev-cloudbuilds/imandra-docs/cloudbuild.yaml' ./tmp/cloudbuild.yaml
        gcloud builds submit \
          'gs://imandra-dev-cloudbuilds/imandra-docs/imandra-docs-cloudbuild.tar.gz' \
          --config tmp/cloudbuild.yaml \
          --async \
          --substitutions="BRANCH_NAME=$BRANCH_NAME,COMMIT_SHA=$COMMIT_SHA,REPO_NAME=imandra-docs,TAG_NAME=build,_IMANDRA_DOCS_BUILDER=$$IMANDRA_DOCS_BUILDER"
