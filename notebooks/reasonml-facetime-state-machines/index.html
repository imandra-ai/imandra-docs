<!DOCTYPE html>
<html>
    <head><meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Imandra Documentation - Exploring The Apple FaceTime Bug with ReasonML State Machines</title>
        <meta property="og:url" content="https://docs.imandra.ai/imandra-docs/notebooks/reasonml-facetime-state-machines/">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Imandra Documentation - Exploring The Apple FaceTime Bug with ReasonML State Machines">
        <meta property="og:description" content="In this notebook we explore the Apple FaceTime bug and different ways of modelling our applications as state machines.">
        <meta property="og:image" content="https://storage.googleapis.com/imandra-assets/images/og_image_default_i78.jpg">


        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116937440-6"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-116937440-1');
        </script>
        <script type="text/javascript"> var sc_project=11767520; var sc_invisible=1; var sc_security="fa7e88d1"; </script>
        <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
        <noscript><div class="statcounter">
            <a title="Web Analytics" href="http://statcounter.com/" target="_blank">
                <img class="statcounter" src="//c.statcounter.com/11767520/0/fa7e88d1/1/" alt="Web Analytics"></a>
        </div></noscript>
        

        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i%7CMerriweather:300,300i,400,400i%7CRoboto+Slab:300,300i,400,400i">

        <link rel="stylesheet" href="/imandra-docs/static/style/style.min.c7df16ea.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/nbextensions/nbimandra/styles.b466ce6f.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/docs-styles.b9de737f.css" type="text/css">
        
        <link rel="stylesheet" href="/imandra-docs/static/jekyll-styles.691e8f5f.css" type="text/css">
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="/imandra-docs/static/nbimandra-rjs-bundle.b85e58fd.js"></script>

        <style type="text/css">
         .highlight .hll { background-color: #ffffcc }
         .highlight  { background: #f8f8f8; }
         .highlight .c { color: #408080; font-style: italic } /* Comment */
         .highlight .err { border: 1px solid #FF0000 } /* Error */
         .highlight .k { color: #008000; font-weight: bold } /* Keyword */
         .highlight .o { color: #666666 } /* Operator */
         .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
         .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
         .highlight .cp { color: #BC7A00 } /* Comment.Preproc */
         .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
         .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
         .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
         .highlight .gd { color: #A00000 } /* Generic.Deleted */
         .highlight .ge { font-style: italic } /* Generic.Emph */
         .highlight .gr { color: #FF0000 } /* Generic.Error */
         .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
         .highlight .gi { color: #00A000 } /* Generic.Inserted */
         .highlight .go { color: #888888 } /* Generic.Output */
         .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
         .highlight .gs { font-weight: bold } /* Generic.Strong */
         .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
         .highlight .gt { color: #0044DD } /* Generic.Traceback */
         .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
         .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
         .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
         .highlight .kp { color: #008000 } /* Keyword.Pseudo */
         .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
         .highlight .kt { color: #B00040 } /* Keyword.Type */
         .highlight .m { color: #666666 } /* Literal.Number */
         .highlight .s { color: #BA2121 } /* Literal.String */
         .highlight .na { color: #7D9029 } /* Name.Attribute */
         .highlight .nb { color: #008000 } /* Name.Builtin */
         .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
         .highlight .no { color: #880000 } /* Name.Constant */
         .highlight .nd { color: #AA22FF } /* Name.Decorator */
         .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
         .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
         .highlight .nf { color: #0000FF } /* Name.Function */
         .highlight .nl { color: #A0A000 } /* Name.Label */
         .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
         .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
         .highlight .nv { color: #19177C } /* Name.Variable */
         .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
         .highlight .w { color: #bbbbbb } /* Text.Whitespace */
         .highlight .mb { color: #666666 } /* Literal.Number.Bin */
         .highlight .mf { color: #666666 } /* Literal.Number.Float */
         .highlight .mh { color: #666666 } /* Literal.Number.Hex */
         .highlight .mi { color: #666666 } /* Literal.Number.Integer */
         .highlight .mo { color: #666666 } /* Literal.Number.Oct */
         .highlight .sa { color: #BA2121 } /* Literal.String.Affix */
         .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
         .highlight .sc { color: #BA2121 } /* Literal.String.Char */
         .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
         .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
         .highlight .s2 { color: #BA2121 } /* Literal.String.Double */
         .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
         .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
         .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
         .highlight .sx { color: #008000 } /* Literal.String.Other */
         .highlight .sr { color: #BB6688 } /* Literal.String.Regex */
         .highlight .s1 { color: #BA2121 } /* Literal.String.Single */
         .highlight .ss { color: #19177C } /* Literal.String.Symbol */
         .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
         .highlight .fm { color: #0000FF } /* Name.Function.Magic */
         .highlight .vc { color: #19177C } /* Name.Variable.Class */
         .highlight .vg { color: #19177C } /* Name.Variable.Global */
         .highlight .vi { color: #19177C } /* Name.Variable.Instance */
         .highlight .vm { color: #19177C } /* Name.Variable.Magic */
         .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
        </style>

        <!-- Loading mathjax macro -->
        <!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: { 
                    automatic: true 
                    }
                },
                "HTML-CSS": {
                    linebreaks: { 
                    automatic: true 
                    }
                }
            });
        
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration --><script>
  function handleCopyClick() {
      var el = this;
      var terminal = el.closest('.terminal');
      var highlight = terminal.getElementsByClassName('highlight')[0];
      copyToClipboardMsg(highlight);

      terminal.classList.add('terminal--hide');
      setTimeout(function () {
          terminal.classList.remove('terminal--hide');
      }, 2000);


      function copyToClipboardMsg(elem) {
          var succeed = copyToClipboard(elem);
          var msg;
          if (!succeed) {
              msg = 'Error!';
          } else {
              msg = 'Copied!';
          }

          var msgElem = terminal.querySelector('.terminal__copy-msg');
          msgElem.innerHTML = msg;
          setTimeout(function () {
              msgElem.innerHTML = 'You rock!';
          }, 1000);
      }

      function copyToClipboard(elem) {
          // create hidden text element, if it doesn't already exist
          var targetId = '_hiddenCopyText_';
          var isInput = elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA';
          var origSelectionStart, origSelectionEnd;
          if (isInput) {
              // can just use the original source element for the selection and copy
              target = elem;
              origSelectionStart = elem.selectionStart;
              origSelectionEnd = elem.selectionEnd;
          } else {
              // must use a temporary form element for the selection and copy
              target = terminal.querySelector('#' + targetId);
              if (!target) {
                  var target = document.createElement('textarea');
                  // target.style.display = 'flex';
                  // target.style.position = 'absolute';
                  // target.style.left = '-1000%';
                  target.id = targetId;
                 elem.appendChild(target);
              }
              target.textContent = elem.textContent.trim();
          }

          // select the content
          var currentFocus = document.activeElement;
          target.focus();
          target.setSelectionRange(0, target.value.length);

          // copy the selection
          var succeed;
          try {
              succeed = document.execCommand('copy');
          } catch (e) {
              succeed = false;
          }
          // restore original focus
          if (currentFocus && typeof currentFocus.focus === 'function') {
              currentFocus.focus();
          }

          if (isInput) {
              // restore prior selection
              elem.setSelectionRange(origSelectionStart, origSelectionEnd);
          } else {
              // clear temporary content
              elem.removeChild(target);
          }
          return succeed;
      }
  }
</script>
    </head>
    <body>
        <div class="background">
        </div>
        <div class="page-container">
            <main class="main-content-column">
                <!-- Jupyter (Imandra core docs) version -->
<header class="header">
    <div class="top-row-container">
        <div class="top-row">

            <div id="toggler--left" class="side__left-menu-toggler">
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p class="side__toggle-text">Docs</p>
            </div>

            <div class="side__logo-container">
                <a class="side__logo-link" href="/">
                    <img class="side__logo " src = "/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-docs.svg" alt="Imandra Logo" title="Imandra Logo">
                    <img class="side__logo--min " src="/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-min.svg" alt="Imandra Logo" title="Imandra Logo">

                </a>
            </div>

            <div id="toggler--right" class="side__right-menu-toggler">
                <p class="side__toggle-text">Pages</p>
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <nav id="side-nav-menu" class="side__nav-container side__nav-container--hidden">
                <ul class="side__nav-list">
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/">Documentation Home</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs">Imandra Core</a>
                        
                        <ul class="side__nav-list--sub-level-1">
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/welcome">A quick tour</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/installation">Installation</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-simple">Installer</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-manual-opam">Manual (opam)</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-docker">Docker Image</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-jupyter">Jupyter Notebook</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-vscode">VSCode</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/installation-server-image">Server Image</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/logic-and-program-modes">Logic and Program modes</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/verification">Verification</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-commands">Commands</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-attributes">Attributes</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-unrolling">Unrolling</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-simplification">Simplification</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-blast">Blast</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-induction">Induction</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall">Waterfall</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/proving-program-termination">Proving program termination</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/decomposition">Region Decomposition</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/decomposition-intro">Background to decomposition</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/imandra-tools-intro">Imandra tools introduction</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/idf">Iterative Decomposition Framework</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/region-probabilities">Region Probabilities</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/loading-files">Multifile development</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/extracting-ocaml-modules-with-imandra-extract">Extracting OCaml modules</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/plugins">Code generation and plugins</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/reflection">Reflection of terms</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/imandravs">Imandra vs.</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/examples">Examples</a>
                                
                                <ul class="side__nav-list--sub-level-2  side__nav-list--sub-level-2--active">
                                    
                                    
                                    
                                    
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        <span class="side__nav-link side__nav-link--minisec">Beginner</span>
                                        </li>
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/webservice-auth-logic">Analysing Web-app authentication logic</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/simple-vehicle-controller">Simple vehicle controller</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/simple-stoplight-model">Simple car intersection model</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-tic-tac-toe">Tic Tac Toe with ReasonML</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link side__nav-link--active" href="/imandra-docs/notebooks/reasonml-facetime-state-machines">Exploring The Apple FaceTime Bug with ReasonML State Machines</a>
                                            
                                            
                                            
                                            <div class="side__within-page-nav--sub-level-2">
                                            
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h2" href="#A-simplified-call-model">A simplified call model</a>
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h2" href="#Changing-the-model">Changing the model</a>
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h2" href="#The-ideal-approach">The ideal approach</a>
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h2" href="#Meeting-halfway">Meeting halfway</a>
  
  
                                            </div>
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/crossing-river-safely">Crossing the river safely</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        <span class="side__nav-link side__nav-link--minisec">Intermediate</span>
                                        </li>
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/ubs-case-study">Analysing the UBS ATS Dark Pool</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/six-swiss-exchange-pricing">Region Decomposition - Exchange Pricing</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-an-ros-node">Creating and Verifying a ROS Node</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/key-pair-security">Key Pair Security in Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/sudoku">Solving Sudoku with Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/solver-synthesis">Synthesising a game solver in Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/exchange-implied-trading">Exchange Implied Trading</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/school-scheduler">Solving school scheduling during COVID</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        <span class="side__nav-link side__nav-link--minisec">Advanced</span>
                                        </li>
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/recursion-induction-and-rewriting">Recursion, Induction and Rewriting</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-merge-sort">Verifying merge sort in Imandra</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/ripple-carry-adder">Verifying a Ripple Carry Adder</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/region-probabilities-example">Calculating Region Probabilities</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/supervised-learning">Analysing Machine Learning Models</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/probabilistic-reasoning-in-reasonml">Probabilistic Reasoning in ReasonML</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/notebooks/a-comparison-with-tla-plus">A comparison with TLA+</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/reference">Reference</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    
                                    
                                    
                                        
                                        
                                        
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/odoc/imandra-base/Imandra_prelude/">Standard Library</a>
                                            
                                            
                                            
                                        </li>
                                        
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                            
                                            <a class="side__nav-link" href="/imandra-docs/odoc/">API Docs</a>
                                            
                                            
                                            
                                        </li>
                                        
                                    
                                </ul>
                                
                            </li>
                            
                        </ul>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/idf-py">Py IDF</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/ipl">Imandra Protocol Language</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/imandra-rule-synth">Imandra Rule Synth</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/fix-engine">FIX Engine</a>
                        
                    </li>
                    
                </ul>
            </nav>
        </div>
    </div>

    <div class="background">
    </div>



    <div class="template-header">
        <div class="top-bar">
            <div class="side__nav-search">
                <input id="search" type="search" placeholder="Search">
                <div class="side__nav-search-icon">
                    <i class="fa fa-search"></i>
                </div>
            </div>

            <nav class="top-bar__nav-container" id="top-menu">
                <a href="#" class="top-bar__toggle"></a>
                <div class="top-nav-bar__group ">
                    <div class="top-nav-bar__nav nav-bar--blue top-nav-bar__nav--hidden">
                        <ul class="top-nav-bar__links top-nav-bar__links--hidden-smaller-than-tablet">



                            <li class="top-nav-bar__item top-nav-bar__item--flex">
                                <a href="https://www.imandra.ai/" class="top-nav-bar__link">Home</a>
                            </li>

                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--applications">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Applications</p>
                                <ul class="dropdown-content dropdown-content--applications">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--fv.svg" alt="Formal Verification" title="Formal Verification Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/app-fv">Formal Verification</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--mbse.svg" alt="Model-Based Software Engineering" title="Model-Based Software Engineering Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/app-mbse">Model-Based Software Engineering</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--si.svg" alt="IPL Demo Gallery" title="System Integration Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/app-si">System Integration</a>
                                    </li>
                                </ul>
                            </li>

                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--explore">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Explore</p>
                                <ul class="dropdown-content dropdown-content--explore">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--core.svg" alt="Try Imandra" title="Try Imandra Icon">
                                        <a class="dropdown__link" href="https://try.imandra.ai/">Try Online</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--demos.svg" alt="Imandra Demo Gallery" title="Imandra Demo Gallery Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/demos">Demo Gallery</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--demos.svg" alt="IPL Demo Gallery" title="IPL Gallery Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/ipl-gallery">IPL Gallery</a>
                                    </li>
                                </ul>
                            </li>




                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--docs">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Docs</p>
                                <ul class="dropdown-content dropdown-content--docs">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/imandra-docs/">Imandra Core</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/idf-py/">PYIDF</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/ipl/">IPL</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/imandra-rule-synth/">Rule Synthesis</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://docs.imandra.ai/fix-engine/">Fix Engine</a>
                                    </li>
                                </ul>
                            </li>



                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--products">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Products</p>
                                <ul class="dropdown-content dropdown-content--products">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--core.svg" alt="Imandra Core" title="Imandra Core Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/core">Imandra Core</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--ipl.svg" alt="Imandra Protocol Language" title="Imandra Protocol Language Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/ipl-product">Imandra Protocol Language</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--systems.svg" alt="Imandra Markets - Systems" title="Imandra Markets - Systems Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/systems">Imandra Markets - Systems</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--connectivity.svg" alt="Imandra Markets - Connectivity" title="Imandra Markets - Connectivity Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/connectivity">Imandra Markets - Connectivity</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--autopilot.svg" alt="Imandra Markets - Autopilot" title="Imandra Markets - Autopilot Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/autopilot">Imandra Markets - Autopilot</a>
                                    </li>
                                </ul>
                            </li>



                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--industries">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Industries</p>
                                <ul class="dropdown-content dropdown-content--industries">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--financial.svg" alt="Financial Markets" title="Financial Markets Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/markets">Financial Markets</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--autonomy.svg" alt="Autonomous Systems" title="Autonomous Systems Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/autonomy">Autonomous Systems</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--ml.svg" alt="Machine Learning" title="Machine Learning Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/ml">Machine Learning</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--government.svg" alt="Machine Learning" title="Machine Learning Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/government">Government and defense</a>
                                    </li>
                                </ul>
                            </li>

                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--media">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Media</p>
                                <ul class="dropdown-content dropdown-content--media">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--media.svg" alt="Media" title="Media Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/media">Media</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--blog.svg" alt="Blog" title="Blog Icon">
                                        <a class="dropdown__link dropdown__link--last " href="https://medium.com/imandra">Blog</a>
                                    </li>
                                </ul>
                            </li>

                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--company">
                                <p class="top-nav-bar__link top-nav-bar__link--group" onclick="">Company</p>
                                <ul class="dropdown-content dropdown-content--company">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--about.svg" alt="About" title="About Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/about">About</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--careers.svg" alt=" Careers" title="Careers Icon">
                                        <a class="dropdown__link dropdown__link--bottom" href="https://www.imandra.ai/careers">Careers</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--research.svg" alt="Research" title="Research Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/research">Research</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>

                    </div>
                </div>
            </nav>
        </div>

        

        <div class="template-header__image-container">
            <a class="template-header__image" href="/imandra-docs">
                <img class="site-specific-image" src="/imandra-docs/static/img/site_specific_image_v_2.svg">
            </a>
        </div>
    </div>



    <script>
        document.getElementById('toggler--left').addEventListener('click', function () {
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');
            document.getElementsByClassName('side__nav-container')[0].classList.toggle(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.add('top-nav-bar__nav--hidden');
        });

        document.getElementById('toggler--right').addEventListener('click', function () {
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');

            document.getElementsByClassName('side__nav-container')[0].classList.add(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.toggle(
                'top-nav-bar__nav--hidden');
        });
    </script>
</header>
                <article class="article__container article__container--notebooks">
                    <div class="main-content main-content--jupyter">
                        
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Exploring-The-Apple-FaceTime-Bug-with-ReasonML-State-Machines">Exploring The Apple FaceTime Bug with ReasonML State Machines<a class="anchor-link" href="#Exploring-The-Apple-FaceTime-Bug-with-ReasonML-State-Machines">&#182;</a></h1><p><a href="https://www.bbc.co.uk/news/technology-47037846">The Apple FaceTime bug</a> swept the news in early 2019 - callers using FaceTime were able to hear the microphone of a new participant being added to a call, before the new participant had accepted the incoming call request. Yikes!</p>
<p><a href="https://twitter.com/DavidKPiano">@DavidKPiano</a> recently wrote <a href="https://medium.com/@DavidKPiano/the-facetime-bug-and-the-dangers-of-implicit-state-machines-a5f0f61bdaa2">a very interesting Medium article</a> about the bug, using it to illustrate the dangers of implicit state machines in your codebase. David's post presents a strong case for explicitly identifying your state machines - by making them a prominent part of your design and your code itself, your thinking about changes becomes more robust. I encourage you to check out his post and also his JS library <a href="https://github.com/davidkpiano/xstate">xstate</a>!</p>
<p>I'm going to explore the adapted example from that post from a slightly different angle - we'll look at various ways of encoding his example as a state machine in ReasonML code, and show how this process can help us prevent invalid states from being admitted in the first place. We'll also have a look at using <a href="https://www.imandra.ai">Imandra</a> to verify properties of our state machines.</p>
<p>I'll also add that we're in no way making any assumptions or judgements about how Apple employees actually develop FaceTime here - this post is more to illustrate that these kind of bugs are pervasive, and the more tools we have to help eliminate them, the better.</p>
<p>Overall, I hope to reiterate David's message that state machines are a very useful tool for modelling parts of your applications. Writing them explicitly and using a tool like <code>xstate</code> can help make it easier for you to reason about your system, but it turns out they also make it easier for computers to reason about your system too! Let's dive in.</p>
<p>Remember, you can hit 'Try this!' to open an interactive notebook and play around with the model yourself.</p>
<h2 id="A-simplified-call-model">A simplified call model<a class="anchor-link" href="#A-simplified-call-model">&#182;</a></h2><p>Let's start with some simple types represeting actions in an application for receiving incoming calls. We'll assume that once remote users make it into the <code>peopleInCall</code> list, they can hear the microphone of the phone running the app:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-2" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">type</span> <span class="n">person</span> <span class="ow">=</span> <span class="kt">int</span><span class="ow">;</span>

<span class="k">type</span> <span class="n">action</span> <span class="ow">=</span>
  <span class="ow">|</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="n">person</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="nc">CallAccepted</span>
  <span class="ow">|</span> <span class="nc">CallRejected</span>
  <span class="ow">|</span> <span class="nc">EndCall</span><span class="ow">;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[1]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type person = int
type action =
    CallIncomingFrom of person
  | CallAccepted
  | CallRejected
  | EndCall
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can receive incoming calls from a person, accept or reject an incoming call, and then end a call. So far so good - next, let's come up with a state type for these actions to act on:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-4" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">type</span> <span class="n">status</span> <span class="ow">=</span>
  <span class="ow">|</span> <span class="nc">Idle</span>
  <span class="ow">|</span> <span class="nc">CallActive</span>
  <span class="ow">|</span> <span class="nc">CallIncoming</span><span class="ow">;</span>

<span class="k">type</span> <span class="n">state</span> <span class="ow">=</span> <span class="ow">{</span>
  <span class="n">status</span><span class="ow">:</span> <span class="n">status</span><span class="ow">,</span>
  <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="n">option</span><span class="ow">(</span><span class="n">person</span><span class="ow">),</span>
  <span class="n">peopleInCall</span><span class="ow">:</span> <span class="kt">list</span><span class="ow">(</span><span class="n">person</span><span class="ow">),</span>
<span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type status = Idle | CallActive | CallIncoming
type state = {
  status : status;
  callIncomingFrom : person option;
  peopleInCall : person list;
}
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Nothing looks too out of the ordinary here - these are all fields we're likely to need as our app runs. Now let's write the core state update logic:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-6" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">update</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">state</span><span class="ow">:</span> <span class="n">state</span><span class="ow">,</span> <span class="n">action</span><span class="ow">):</span> <span class="n">state</span> <span class="ow">=&gt;</span>
  <span class="k">switch</span> <span class="ow">(</span><span class="n">action</span><span class="ow">)</span> <span class="ow">{</span>
  <span class="ow">|</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="n">person</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">CallIncoming</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">Some</span><span class="ow">(</span><span class="n">person</span><span class="ow">)}</span>
  <span class="ow">|</span> <span class="nc">CallRejected</span> <span class="ow">=&gt;</span> <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">Idle</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span><span class="ow">}</span>
  <span class="ow">|</span> <span class="nc">CallAccepted</span> <span class="ow">=&gt;</span>
    <span class="k">switch</span> <span class="ow">(</span><span class="n">state</span><span class="ow">.</span><span class="n">callIncomingFrom</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="ow">|</span> <span class="nc">Some</span><span class="ow">(</span><span class="n">p</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{</span><span class="n">status</span><span class="ow">:</span> <span class="nc">CallActive</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="ow">[</span><span class="n">p</span><span class="ow">]}</span>
    <span class="ow">|</span> <span class="nc">None</span> <span class="ow">=&gt;</span> <span class="n">state</span>
    <span class="ow">}</span>
  <span class="ow">|</span> <span class="nc">EndCall</span> <span class="ow">=&gt;</span> <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">Idle</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="bp">[]</span><span class="ow">}</span>
  <span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val update : state -&gt; action -&gt; state = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This function represents the transitions of a state machine!</p>
<p>Encoding this in the Reason/OCaml type system gives us a couple of advantages - the <code>switch</code> statement (<code>match</code> in OCaml syntax) can also check that we've exhaustively covered all the actions. Also, if we decide to wire this up to a React UI, ReasonML's React bindings include a ReducerComponent out of the box that expects a function of this shape. React's new Hooks API also has a similar primitive in the form of the <code>useReducer</code> Hook.</p>
<h2 id="Changing-the-model">Changing the model<a class="anchor-link" href="#Changing-the-model">&#182;</a></h2><p>Now let's imagine a new requirement comes in.</p>
<blockquote><p>Handle messages from the system requesting new people be added to a call.</p>
</blockquote>
<p>Let's give that a go. We'll add a new action <code>AddPerson</code> representing the system message:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-8" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">type</span> <span class="n">action_v2</span> <span class="ow">=</span>
  <span class="ow">|</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="n">person</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="nc">CallAccepted</span>
  <span class="ow">|</span> <span class="nc">CallRejected</span>
  <span class="ow">|</span> <span class="nc">EndCall</span>
  <span class="ow">|</span> <span class="nc">AddPerson</span><span class="ow">(</span><span class="n">person</span><span class="ow">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type action_v2 =
    CallIncomingFrom of person
  | CallAccepted
  | CallRejected
  | EndCall
  | AddPerson of person
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-9" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">update_v2</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">state</span><span class="ow">:</span> <span class="n">state</span><span class="ow">,</span> <span class="n">action</span><span class="ow">:</span> <span class="n">action_v2</span><span class="ow">):</span> <span class="n">state</span> <span class="ow">=&gt;</span>
  <span class="k">switch</span> <span class="ow">(</span><span class="n">action</span><span class="ow">)</span> <span class="ow">{</span>
  <span class="ow">|</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="n">person</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">CallIncoming</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">Some</span><span class="ow">(</span><span class="n">person</span><span class="ow">)}</span>
  <span class="ow">|</span> <span class="nc">CallRejected</span> <span class="ow">=&gt;</span> <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">Idle</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span><span class="ow">}</span>
  <span class="ow">|</span> <span class="nc">CallAccepted</span> <span class="ow">=&gt;</span>
    <span class="k">switch</span> <span class="ow">(</span><span class="n">state</span><span class="ow">.</span><span class="n">callIncomingFrom</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="ow">|</span> <span class="nc">Some</span><span class="ow">(</span><span class="n">p</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{</span><span class="n">status</span><span class="ow">:</span> <span class="nc">CallActive</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="ow">[</span><span class="n">p</span><span class="ow">]}</span>
    <span class="ow">|</span> <span class="nc">None</span> <span class="ow">=&gt;</span> <span class="n">state</span>
    <span class="ow">}</span>
  <span class="ow">|</span> <span class="nc">EndCall</span> <span class="ow">=&gt;</span> <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">Idle</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="bp">[]</span><span class="ow">}</span>
  <span class="ow">|</span> <span class="nc">AddPerson</span><span class="ow">(</span><span class="n">person</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="ow">[</span><span class="n">person</span><span class="ow">,</span> <span class="ow">...</span><span class="n">state</span><span class="ow">.</span><span class="n">peopleInCall</span><span class="ow">]}</span>
  <span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val update_v2 : state -&gt; action_v2 -&gt; state = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We'll even write a test for it:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-11" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">type</span> <span class="n">test_outcome</span> <span class="ow">=</span> <span class="ow">|</span> <span class="nc">Pass</span> <span class="ow">|</span> <span class="nc">Fail</span><span class="ow">;</span>

<span class="k">let</span> <span class="n">test_add_person_action</span> <span class="ow">=</span> <span class="ow">{</span>
  <span class="k">let</span> <span class="n">start_state</span> <span class="ow">=</span> <span class="ow">{</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">CallActive</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="ow">[</span><span class="mi">1</span><span class="ow">,</span> <span class="mi">2</span><span class="ow">],</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span> <span class="ow">};</span>
  <span class="k">let</span> <span class="n">end_state</span> <span class="ow">=</span> <span class="n">update_v2</span><span class="ow">(</span><span class="n">start_state</span><span class="ow">,</span> <span class="nc">AddPerson</span><span class="ow">(</span><span class="mi">3</span><span class="ow">));</span>
  <span class="k">if</span> <span class="ow">(</span><span class="nn">List</span><span class="p">.</span><span class="n">exists</span><span class="ow">(</span><span class="n">x</span> <span class="ow">=&gt;</span> <span class="n">x</span> <span class="ow">==</span> <span class="mi">3</span><span class="ow">,</span> <span class="n">end_state</span><span class="ow">.</span><span class="n">peopleInCall</span><span class="ow">)</span> <span class="ow">&amp;&amp;</span> <span class="n">end_state</span><span class="ow">.</span><span class="n">status</span> <span class="ow">==</span> <span class="nc">CallActive</span><span class="ow">)</span> <span class="ow">{</span>
      <span class="nc">Pass</span>
  <span class="ow">}</span> <span class="k">else</span> <span class="ow">{</span>
      <span class="nc">Fail</span>
  <span class="ow">}</span>
<span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type test_outcome = Pass | Fail
val test_add_person_action : test_outcome = Pass
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>...and all is right with the world. Or is it? If you look carefully, we've baked into our test an assumption about the starting status of the state when handling the <code>AddPerson</code> action - something that's easily done if we've got our feature implementation blinkers on.</p>
<p>What the test misses is the <code>AddPerson</code> action being used in a state that isn't <code>CallActive</code>. As nothing actually validates that the state is correct, we could potentially end up having a person added to <code>peopleInCall</code> before the call is accepted-similar to what happened with the real bug.</p>
<h2 id="The-ideal-approach">The ideal approach<a class="anchor-link" href="#The-ideal-approach">&#182;</a></h2><p>Although the type system has helped us out here a bit, we can leverage it even further by writing our states in a way that makes expressing this bug impossible in the first place.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-13" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">type</span> <span class="n">call</span> <span class="ow">=</span> <span class="ow">{</span><span class="n">people</span><span class="ow">:</span> <span class="kt">list</span><span class="ow">(</span><span class="n">person</span><span class="ow">)};</span>

<span class="k">type</span> <span class="n">ideal_state</span> <span class="ow">=</span>
  <span class="ow">|</span> <span class="nc">Idle</span>
  <span class="ow">|</span> <span class="nc">CallActive</span><span class="ow">(</span><span class="n">call</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="nc">CallIncoming</span><span class="ow">(</span><span class="n">person</span><span class="ow">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type call = { people : person list; }
type ideal_state = Idle | CallActive of call | CallIncoming of person
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here we're using a variant type to represent mutually exclusive bits of state. This means we can't have any <code>call</code> state unless we're actually in an active call, and similarly it eliminates some possible uncertainty in the <code>CallIncoming</code> state about the person we're receiving the call from.</p>
<p>We also define a type for the outcome of an update:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-15" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">type</span> <span class="n">update_outcome</span><span class="ow">(</span><span class="k">&#39;</span><span class="n">a</span><span class="ow">)</span> <span class="ow">=</span>
  <span class="ow">|</span> <span class="nc">Updated</span><span class="ow">(</span><span class="k">&#39;</span><span class="n">a</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="nc">Invalid</span><span class="ow">;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type &#39;a update_outcome = Updated of &#39;a | Invalid
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Previously we only returned the original state for unexpected actions (returning <code>state</code> for the <code>state.callIncomingFrom == None</code> branch of the <code>CallAccepted</code> action, in <code>update_v2</code>). We know intuitively this shouldn't happen, but let's use the type system to our advantage by explicitly making cases like that an invalid outcome. That way the code that's actually running our state machine can check for invalid outcomes and log an error message to let us know that something is wired up incorrectly, which may indicate another bug somewhere.</p>
<p>Now let's use these new types in our new and improved update function:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-17" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">ideal_update</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">state</span><span class="ow">:</span> <span class="n">ideal_state</span><span class="ow">,</span> <span class="n">action</span> <span class="ow">:</span> <span class="n">action_v2</span><span class="ow">):</span> <span class="n">update_outcome</span><span class="ow">(</span><span class="n">ideal_state</span><span class="ow">)</span> <span class="ow">=&gt;</span>
  <span class="k">switch</span> <span class="ow">(</span><span class="n">state</span><span class="ow">,</span> <span class="n">action</span><span class="ow">)</span> <span class="ow">{</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">Idle</span><span class="ow">,</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="n">p</span><span class="ow">))</span> <span class="ow">=&gt;</span> <span class="nc">Updated</span><span class="ow">(</span><span class="nc">CallIncoming</span><span class="ow">(</span><span class="n">p</span><span class="ow">))</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallIncoming</span><span class="ow">(_),</span> <span class="nc">CallRejected</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="nc">Updated</span><span class="ow">(</span><span class="nc">Idle</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallIncoming</span><span class="ow">(</span><span class="n">p</span><span class="ow">),</span> <span class="nc">CallAccepted</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="nc">Updated</span><span class="ow">(</span><span class="nc">CallActive</span><span class="ow">({</span><span class="n">people</span><span class="ow">:</span> <span class="ow">[</span><span class="n">p</span><span class="ow">]}))</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallActive</span><span class="ow">(_),</span> <span class="nc">EndCall</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="nc">Updated</span><span class="ow">(</span><span class="nc">Idle</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallActive</span><span class="ow">(</span><span class="n">call</span><span class="ow">),</span> <span class="nc">AddPerson</span><span class="ow">(</span><span class="n">p</span><span class="ow">))</span> <span class="ow">=&gt;</span>
    <span class="nc">Updated</span><span class="ow">(</span><span class="nc">CallActive</span><span class="ow">({</span><span class="n">people</span><span class="ow">:</span> <span class="ow">[</span><span class="n">p</span><span class="ow">,</span> <span class="ow">...</span><span class="n">call</span><span class="ow">.</span><span class="n">people</span><span class="ow">]}))</span>
  <span class="ow">|</span> <span class="ow">_</span> <span class="ow">=&gt;</span> <span class="nc">Invalid</span>
  <span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val ideal_update : ideal_state -&gt; action_v2 -&gt; ideal_state update_outcome =
  &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The types have actually guided us here to make our transition function more correct - we are now forced to switch on both the action coming in <em>and</em> the current state in order to have access to the call state that we need to update when adding a new person to the call.</p>
<h2 id="Meeting-halfway">Meeting halfway<a class="anchor-link" href="#Meeting-halfway">&#182;</a></h2><p>While this representation is ideal for this small example, we can't always quite pull this off. Sometimes we simply can't express the type of constraint we want, due to the limitations of the type system. Sometimes we can, but by doing so we make the code unreadable or very unwieldy to use. Alternatively, we may have started with the original representation, but have too much code dependent on it to be able to make the change under given time constraints (although the Reason/OCaml type system would definitely help with the refactoring!). So let's not let the 'perfect' be the enemy of the good - instead, let's take a step back to the original version of our update function in order to demonstrate what it looks like to meet somewhere in the middle.</p>
<p>One way of looking at static type systems like this is as tools for proving properties of your code at compile time. By writing our code in a way that satisfies the rules of the type system, we're given a certain class of guarantees about our programs - the tradeoff is that we lose some expressiveness. In our ideal representation we can no longer express certain invalid states, which is what we want! But sometimes by following the rules of the type system we find it hard to express certain things that we do want.</p>
<p>If we're using Reason/OCaml, we have another option - we can use <a href="https://www.imandra.ai">Imandra</a>, a cloud-native automated reasoning engine.</p>
<p>Like a type system, Imandra is also a tool that can be used to prove that properties of your program hold true, but we can express these properties themselves as snippets of Reason/OCaml code. This allows us to direct the checking process in a way that's much more tailored to the domain of the program itself, rather than on the more generic language level.</p>
<p>What does this all mean? Let's start by writing a property, or verification goal, about our earlier implementation <code>update_v2</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-19" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">add_person_property</span> <span class="ow">=</span>
    <span class="ow">(</span><span class="n">state</span><span class="ow">:</span> <span class="n">state</span><span class="ow">,</span> <span class="n">person</span><span class="ow">:</span> <span class="kt">int</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">let</span> <span class="n">new_state</span> <span class="ow">=</span> <span class="n">update_v2</span><span class="ow">(</span><span class="n">state</span><span class="ow">,</span> <span class="nc">AddPerson</span><span class="ow">(</span><span class="n">person</span><span class="ow">));</span>
  <span class="k">if</span> <span class="ow">(</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="ow">(</span><span class="n">new_state</span><span class="ow">.</span><span class="n">peopleInCall</span><span class="ow">)</span> <span class="ow">&gt;</span> <span class="mi">0</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="n">new_state</span><span class="ow">.</span><span class="n">status</span> <span class="ow">==</span> <span class="nc">CallActive</span><span class="ow">;</span>
  <span class="ow">}</span> <span class="k">else</span> <span class="ow">{</span>
    <span class="bp">true</span><span class="ow">;</span>
  <span class="ow">};</span>
<span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val add_person_property : state -&gt; person -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is a function that takes an arbitrary state and person, performs some actions on them, and then returns <code>true</code> or <code>false</code> to indicate whether the property holds. So here we're saying that if there are people in the call after responding to the <code>AddPerson</code> message, we're in the <code>CallActive</code> state, which is a nice general concept we'd like to be true! We are specifically testing the action that we know is broken here, but let's accept that for now and see what happens when we ask Imandra to verify the property for us (we're specifying a max unrolling depth for verification of 50 with the <code>~upto</code> flag-we'll come back to this later):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-21" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="n">verify</span> <span class="n">upto</span><span class="ow">:</span><span class="mi">50</span> <span class="n">add_person_property</span><span class="ow">;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : state -&gt; person -&gt; bool = &lt;fun&gt;
module CX : sig val state : state val person : person end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Counterexample (after 2 steps, 0.015s):
 let (state : state) =
  {status = Idle; callIncomingFrom = None; peopleInCall = []}
 let (person : int) = 2
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px dashed #D84315; border-bottom: 1px dashed #D84315"><i class="fa fa-times-circle-o" style="margin-right: 0.5em; color: #D84315"></i><span>Refuted</span></div><div><div class="imandra-alternatives" id="alt-6d5cf13f-c424-41d9-bc4e-04b0dc193ec8"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-40747235-9670-4863-86b5-774b1c62b1c3"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;not\l(List.length (person :: state.peopleInCall) \&lt;= 0 \|\| state.status = CallActive)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
goal -&gt; call_68 [label=&quot;calls&quot;];
call_68 [label=&quot;List.length (person :: state.peopleInCall)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_68 -&gt; call_164 [label=&quot;calls&quot;];
call_164 [label=&quot;List.length state.peopleInCall&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_164 -&gt; call_200 [label=&quot;calls&quot;];
call_200 [label=&quot;List.length (List.tl state.peopleInCall)&quot;,shape=box,style=filled,color=&quot;yellow&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-40747235-9670-4863-86b5-774b1c62b1c3';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-d599c8f1-f97b-4ac3-838d-a3420345f751"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-57f4097d-7da0-4b10-9065-7d8c5e0ae58f"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-4ce72fb0-af05-4a48-9242-a840ccda9bc2"><table><tr><td><b>ground_instances</b></td><td>2</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.015s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-79de0701-5205-48ff-be5b-ec71232d8afc"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-b9b1c2fb-0997-494f-949a-e421fa370980"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-315a9e85-f282-4c1d-ad20-f3a08f02474e"><table><tr><td><b>num checks</b></td><td>5</td></tr><tr><td><b>arith-make-feasible</b></td><td>5</td></tr><tr><td><b>arith-max-columns</b></td><td>9</td></tr><tr><td><b>rlimit count</b></td><td>1044</td></tr><tr><td><b>arith-cheap-eqs</b></td><td>1</td></tr><tr><td><b>mk clause</b></td><td>8</td></tr><tr><td><b>datatype occurs check</b></td><td>36</td></tr><tr><td><b>mk bool var</b></td><td>41</td></tr><tr><td><b>arith-lower</b></td><td>2</td></tr><tr><td><b>datatype splits</b></td><td>7</td></tr><tr><td><b>decisions</b></td><td>9</td></tr><tr><td><b>propagations</b></td><td>4</td></tr><tr><td><b>arith-max-rows</b></td><td>2</td></tr><tr><td><b>conflicts</b></td><td>2</td></tr><tr><td><b>datatype accessor ax</b></td><td>12</td></tr><tr><td><b>datatype constructor ax</b></td><td>13</td></tr><tr><td><b>num allocs</b></td><td>1358327</td></tr><tr><td><b>final checks</b></td><td>6</td></tr><tr><td><b>added eqs</b></td><td>41</td></tr><tr><td><b>del clause</b></td><td>4</td></tr><tr><td><b>arith eq adapter</b></td><td>2</td></tr><tr><td><b>arith-upper</b></td><td>3</td></tr><tr><td><b>memory</b></td><td>7.450000</td></tr><tr><td><b>max memory</b></td><td>7.450000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-79de0701-5205-48ff-be5b-ec71232d8afc';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-53caa817-c160-486b-93d9-d459764e1acc"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.015s]
  if List.length .peopleInCall &gt; 0 then .status = CallActive else true</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-39259b5f-bffc-44a3-84c7-dc5856b463b1"><table><tr><td><b>into</b></td><td><pre>List.length (( :var_0: ) :: ) &lt;= 0 || ( :var_1: ).status = CallActive</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-b2cf662e-30b3-4c93-8091-64f4dd656b05"><table><tr><td><b>expr</b></td><td><pre>(|List.length_1774| (|::_3| person_118 (peopleInCall_33 state_117)))</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-28e7ec75-e572-46cc-ba91-ce3132b1e349"><table><tr><td><b>expr</b></td><td><pre>(|List.length_1774| (peopleInCall_33 state_117))</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let (state : state) =
  {status = Idle; callIncomingFrom = None; peopleInCall = []}
 let (person : int) = 2
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-53caa817-c160-486b-93d9-d459764e1acc';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-719f9e00-e9fb-4676-a6f6-c0bdb948aa26"><textarea style="display: none">digraph &quot;proof&quot; {
p_4 [label=&quot;Start (if List.length .peopleInCall \&gt; 0 then .status = CallActive\l       else true :time 0.015s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_4 -&gt; p_3 [label=&quot;&quot;];
p_3 [label=&quot;Simplify (List.length (( :var_0: ) :: ) \&lt;= 0\l          \|\| ( :var_1: ).status = CallActive :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_3 -&gt; p_2 [label=&quot;&quot;];
p_2 [label=&quot;Unroll ([List.length (person :: state.peopleInCall)], [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_2 -&gt; p_1 [label=&quot;&quot;];
p_1 [label=&quot;Unroll ([List.length state.peopleInCall], [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_1 -&gt; p_0 [label=&quot;&quot;];
p_0 [label=&quot;Sat (Some  let (state : state) =\l  \{status = Idle; callIncomingFrom = None; peopleInCall = []\}\l let (person : int) = 2\l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-719f9e00-e9fb-4676-a6f6-c0bdb948aa26';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-57f4097d-7da0-4b10-9065-7d8c5e0ae58f';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-d599c8f1-f97b-4ac3-838d-a3420345f751';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-6d5cf13f-c424-41d9-bc4e-04b0dc193ec8';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Imandra analyses our code symbolically and we don't just get a pass/failure result - we get concrete counterexample values for the inputs to our function that illustrate the flaw in our thinking. If we want, we can compute and experiment with them (which can be very useful for investigating bugs Imandra has found):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-23" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="ow">(</span><span class="nn">CX</span><span class="p">.</span><span class="n">state</span><span class="ow">.</span><span class="n">peopleInCall</span><span class="ow">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : person = 0
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As we said, the goal above is fairly focused in on our new feature, and we've written it already knowing there's a bug in the area we're targeting - let's work with something that's more universal, helped by the fact that we've modeled things as a state machine. A helpful pattern when dealing with state machines is to check that properties hold under arbitrary sequences of actions:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-25" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">call_with_people_in_is_active_property</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">update_fn</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">,</span> <span class="n">actions</span> <span class="ow">:</span> <span class="kt">list</span><span class="ow">(</span><span class="k">&#39;</span><span class="n">a</span><span class="ow">))</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">let</span> <span class="n">final_state</span> <span class="ow">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span><span class="ow">(</span><span class="n">update_fn</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">,</span> <span class="n">actions</span><span class="ow">);</span>
  <span class="k">if</span> <span class="ow">(</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="ow">(</span><span class="n">final_state</span><span class="ow">.</span><span class="n">peopleInCall</span><span class="ow">)</span> <span class="ow">&gt;</span> <span class="mi">0</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="n">final_state</span><span class="ow">.</span><span class="n">status</span> <span class="ow">==</span> <span class="nc">CallActive</span><span class="ow">;</span>
  <span class="ow">}</span> <span class="k">else</span> <span class="ow">{</span>
    <span class="bp">true</span><span class="ow">;</span>
  <span class="ow">};</span>
<span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val call_with_people_in_is_active_property :
  (state -&gt; &#39;a -&gt; state) -&gt; state -&gt; &#39;a list -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This checks the same underlying idea that we never have more than 0 people in the call unless the call is active, but in a more general way - we no longer check the single specific action. The nice thing about properties like this is that we can imagine that we'd still want them to hold true as we make additional changes to our state machine, and staying decoupled from specific actions helps us achieve that.</p>
<p>We simulate actions run in a react-like reducer using a <code>fold</code> (<code>fold</code> and <code>reduce</code> are synonymous). We're also passing in a target <code>update_fn</code> as we're going to use it on multiple versions of <code>update</code> as we progress. Imandra will check that the property holds for all possible values of the type 'list of actions' (the last parameter to our property function). Let's try it out:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-27" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">initial_state</span> <span class="ow">=</span> <span class="ow">{</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">Idle</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="bp">[]</span> <span class="ow">};</span>
<span class="n">verify</span> <span class="n">upto</span><span class="ow">:</span><span class="mi">50</span> <span class="n">call_with_people_in_is_active_property</span><span class="ow">(</span><span class="n">update_v2</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val initial_state : state =
  {status = Idle; callIncomingFrom = None; peopleInCall = []}
File &#34;jupyter cell 14&#34;, line 2, characters 15-79:
2 | verify upto:50 call_with_people_in_is_active_property(update_v2, initial_state);
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Warning 5: this function application is partial,
maybe some arguments are missing.
- : action_v2 list -&gt; bool = &lt;fun&gt;
module CX : sig val _x_0 : action_v2 list end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Counterexample (after 4 steps, 0.014s):
 let (_x_0 : action_v2 list) = [(AddPerson (4))]
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px dashed #D84315; border-bottom: 1px dashed #D84315"><i class="fa fa-times-circle-o" style="margin-right: 0.5em; color: #D84315"></i><span>Refuted</span></div><div><div class="imandra-alternatives" id="alt-7bbdd1e3-7cd1-414b-97db-2d6868000eba"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-673b3ec3-af5e-4b01-8b35-d93930267967"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : state)\l    = List.fold_left update_v2\l      \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0\lin not (_x_0.status = CallActive \|\| List.length _x_0.peopleInCall \&lt;= 0)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
goal -&gt; call_32 [label=&quot;calls&quot;];
goal -&gt; call_36 [label=&quot;calls&quot;];
call_32 [label=&quot;List.fold_left update_v2\l\{status = ; callIncomingFrom = ; peopleInCall = \} _x_0&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_32 -&gt; call_250 [label=&quot;calls&quot;];
call_36 [label=&quot;List.length\l(List.fold_left update_v2\l \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_36 -&gt; call_126 [label=&quot;calls&quot;];
call_250 [label=&quot;List.fold_left update_v2\l(update_v2 \{status = ; callIncomingFrom = ; peopleInCall = \}\l (List.hd _x_0))\l(List.tl _x_0)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_250 -&gt; call_506 [label=&quot;calls&quot;];
call_126 [label=&quot;List.length\l(List.tl\l (List.fold_left update_v2\l  \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_126 -&gt; call_445 [label=&quot;calls&quot;];
call_506 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\lList.fold_left update_v2\l(update_v2\l (update_v2 \{status = ; callIncomingFrom = ; peopleInCall = \}\l  (List.hd _x_0))\l (List.hd _x_0))\l(List.tl _x_0)&quot;,shape=box,style=filled,color=&quot;yellow&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_445 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.fold_left update_v2\l   \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))&quot;,shape=box,style=filled,color=&quot;yellow&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-673b3ec3-af5e-4b01-8b35-d93930267967';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-383236aa-8a9a-4e53-8bae-8e51ad3e7795"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-f946d5b5-563b-4d57-ac70-ed71a597db20"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-a6895cf8-333c-4eb2-b72b-2822b88289a1"><table><tr><td><b>ground_instances</b></td><td>4</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.014s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-52f139a1-47f2-45d4-8c12-fe13aa4e9992"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-7f8e74eb-5875-443b-9160-2cf838aa1e33"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-73dbf21c-4be7-4c1c-b0cf-8a4a55def8fc"><table><tr><td><b>num checks</b></td><td>9</td></tr><tr><td><b>arith-make-feasible</b></td><td>8</td></tr><tr><td><b>arith-max-columns</b></td><td>10</td></tr><tr><td><b>rlimit count</b></td><td>3772</td></tr><tr><td><b>arith-cheap-eqs</b></td><td>4</td></tr><tr><td><b>mk clause</b></td><td>34</td></tr><tr><td><b>datatype occurs check</b></td><td>75</td></tr><tr><td><b>mk bool var</b></td><td>194</td></tr><tr><td><b>arith-lower</b></td><td>3</td></tr><tr><td><b>arith-diseq</b></td><td>2</td></tr><tr><td><b>datatype splits</b></td><td>21</td></tr><tr><td><b>decisions</b></td><td>91</td></tr><tr><td><b>propagations</b></td><td>72</td></tr><tr><td><b>arith-max-rows</b></td><td>3</td></tr><tr><td><b>conflicts</b></td><td>11</td></tr><tr><td><b>datatype accessor ax</b></td><td>36</td></tr><tr><td><b>minimized lits</b></td><td>1</td></tr><tr><td><b>datatype constructor ax</b></td><td>55</td></tr><tr><td><b>num allocs</b></td><td>4118704</td></tr><tr><td><b>final checks</b></td><td>9</td></tr><tr><td><b>added eqs</b></td><td>271</td></tr><tr><td><b>del clause</b></td><td>8</td></tr><tr><td><b>arith eq adapter</b></td><td>5</td></tr><tr><td><b>arith-upper</b></td><td>5</td></tr><tr><td><b>memory</b></td><td>8.210000</td></tr><tr><td><b>max memory</b></td><td>8.210000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-52f139a1-47f2-45d4-8c12-fe13aa4e9992';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-275b328c-9514-4e9d-bbda-45385f459a55"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.014s]
  let (_x_0 : state)
      = List.fold_left update_v2
        {status = ; callIncomingFrom = ; peopleInCall = }
        ( :var_0: )
  in
  if List.length _x_0.peopleInCall &gt; 0 then _x_0.status = CallActive
  else true</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-fa0e4985-5def-4f54-8ffb-48578e4d15e2"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : state)
    = List.fold_left update_v2
      {status = ; callIncomingFrom = ; peopleInCall = } ( :var_0: )
in _x_0.status = CallActive || List.length _x_0.peopleInCall &lt;= 0</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-d931ea47-0ca3-460d-bd13-221abddede5f"><table><tr><td><b>expr</b></td><td><pre>(|List.length_1842|
  (peopleInCall_33 (|`List.fold_left update_v2[0]`_1837|
                     (|</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-58366d7f-37b0-4d87-9350-02b95e78c109"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left update_v2[0]`_1837|
  (|rec_mk.state_1827| Idle_25 None_4 |[]_2|)
  _x_0_127)</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-d2047d1e-83c5-4915-819a-ec8909548ffa"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1832| (peopleInCall_33 (|`List.fold_left update_v2[0]`_1837|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-856e7d74-39bb-4afc-9a68-15e85b4e901f"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left update_v2[0]`_1837|
  (update_v2_52 (|rec_mk.state_1827| Idle_25 None_4 |[]_2|)
  </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let (_x_0 : action_v2 list) = [(AddPerson (4))]
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-275b328c-9514-4e9d-bbda-45385f459a55';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-b3d35ecc-e5cc-43e2-8943-a3e88784a8f4"><textarea style="display: none">digraph &quot;proof&quot; {
p_11 [label=&quot;Start (let (_x_0 : state)\l           = List.fold_left update_v2\l             \{status = ; callIncomingFrom = ; peopleInCall = \}\l             ( :var_0: )\l       in\l       if List.length _x_0.peopleInCall \&gt; 0 then _x_0.status = CallActive\l       else true :time 0.014s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_11 -&gt; p_10 [label=&quot;&quot;];
p_10 [label=&quot;Simplify (let (_x_0 : state)\l              = List.fold_left update_v2\l                \{status = ; callIncomingFrom = ; peopleInCall = \}\l                ( :var_0: )\l          in _x_0.status = CallActive \|\| List.length _x_0.peopleInCall \&lt;= 0\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_10 -&gt; p_9 [label=&quot;&quot;];
p_9 [label=&quot;Unroll ([List.length\l         (List.fold_left update_v2\l          \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_9 -&gt; p_8 [label=&quot;&quot;];
p_8 [label=&quot;Unroll ([List.fold_left update_v2\l         \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_8 -&gt; p_7 [label=&quot;&quot;];
p_7 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.fold_left update_v2\l           \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_7 -&gt; p_6 [label=&quot;&quot;];
p_6 [label=&quot;Unroll ([List.fold_left update_v2\l         (update_v2\l          \{status = ; callIncomingFrom = ; peopleInCall = \}\l          (List.hd _x_0))\l         (List.tl _x_0)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_6 -&gt; p_5 [label=&quot;&quot;];
p_5 [label=&quot;Sat (Some  let (_x_0 : action_v2 list) = [(AddPerson (4))]\l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-b3d35ecc-e5cc-43e2-8943-a3e88784a8f4';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-f946d5b5-563b-4d57-ac70-ed71a597db20';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-383236aa-8a9a-4e53-8bae-8e51ad3e7795';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-7bbdd1e3-7cd1-414b-97db-2d6868000eba';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The sequence of actions with a single <code>AddPerson</code> item already contradicts our property, which immediately shows us our issue and gives us an example to help out:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-29" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="n">update_v2</span><span class="ow">(</span><span class="n">initial_state</span><span class="ow">,</span> <span class="nc">AddPerson</span><span class="ow">(</span><span class="mi">4</span><span class="ow">));</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : state = {status = Idle; callIncomingFrom = None; peopleInCall = [4]}
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's try running the same property on our original update function, from before we added the new <code>AddPerson</code> action:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-31" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="n">verify</span> <span class="n">upto</span><span class="ow">:</span><span class="mi">50</span> <span class="n">call_with_people_in_is_active_property</span><span class="ow">(</span><span class="n">update</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>File &#34;jupyter cell 16&#34;, line 1, characters 15-76:
1 | verify upto:50 call_with_people_in_is_active_property(update, initial_state);
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Warning 5: this function application is partial,
maybe some arguments are missing.
- : action list -&gt; bool = &lt;fun&gt;
module CX : sig val _x_0 : action list end
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre>Counterexample (after 7 steps, 0.019s):
 let (_x_0 : action list) =
  [(CallIncomingFrom (3)); CallAccepted; (CallIncomingFrom (5))]
</pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px dashed #D84315; border-bottom: 1px dashed #D84315"><i class="fa fa-times-circle-o" style="margin-right: 0.5em; color: #D84315"></i><span>Refuted</span></div><div><div class="imandra-alternatives" id="alt-2b003dae-1cde-4bc7-ba37-53e5afb30e79"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-graphviz" id="graphviz-ae0597c2-f729-4e2a-ad20-88b07b3e514c"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;let (_x_0 : state)\l    = List.fold_left update\l      \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0\lin not (_x_0.status = CallActive \|\| List.length _x_0.peopleInCall \&lt;= 0)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
goal -&gt; call_36 [label=&quot;calls&quot;];
goal -&gt; call_32 [label=&quot;calls&quot;];
call_36 [label=&quot;List.length\l(List.fold_left update\l \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_36 -&gt; call_126 [label=&quot;calls&quot;];
call_32 [label=&quot;List.fold_left update\l\{status = Idle; callIncomingFrom = None; peopleInCall = []\} _x_0&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_32 -&gt; call_238 [label=&quot;calls&quot;];
call_126 [label=&quot;List.length\l(List.tl\l (List.fold_left update\l  \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_126 -&gt; call_392 [label=&quot;calls&quot;];
call_238 [label=&quot;List.fold_left update\l(update \{status = ; callIncomingFrom = ; peopleInCall = \}\l (List.hd _x_0))\l(List.tl _x_0)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_238 -&gt; call_453 [label=&quot;calls&quot;];
call_392 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.fold_left update\l   \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_392 -&gt; call_680 [label=&quot;calls&quot;];
call_453 [label=&quot;let (_x_0 : action list) = List.tl _x_0 in\lList.fold_left update\l(update\l (update \{status = ; callIncomingFrom = ; peopleInCall = \}\l  (List.hd _x_0))\l (List.hd _x_0))\l(List.tl _x_0)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_453 -&gt; call_752 [label=&quot;calls&quot;];
call_680 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.tl\l   (List.fold_left update\l    \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)))&quot;,shape=box,style=filled,color=&quot;yellow&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_752 [label=&quot;let (_x_0 : action list) = List.tl _x_0 in\llet (_x_1 : action list) = List.tl _x_0 in\lList.fold_left update\l(update\l (update\l  (update \{status = ; callIncomingFrom = ; peopleInCall = \}\l   (List.hd _x_0))\l  (List.hd _x_0))\l (List.hd _x_1))\l(List.tl _x_1)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_752 -&gt; call_1115 [label=&quot;calls&quot;];
call_1115 [label=&quot;let (_x_0 : action list) = List.tl _x_0 in\llet (_x_1 : action list) = List.tl _x_0 in\llet (_x_2 : action list) = List.tl _x_1 in\lList.fold_left update\l(update\l (update\l  (update\l   (update \{status = ; callIncomingFrom = ; peopleInCall = \}\l    (List.hd _x_0))\l   (List.hd _x_0))\l  (List.hd _x_1))\l (List.hd _x_2))\l(List.tl _x_2)&quot;,shape=box,style=filled,color=&quot;yellow&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-ae0597c2-f729-4e2a-ad20-88b07b3e514c';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-b0d91058-04c7-46da-9ce0-35f1692939bc"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-c45cf838-e4d9-437a-9a40-b98ad6a481a2"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-65a630e0-6467-45f7-af0f-dad32d8fdfda"><table><tr><td><b>ground_instances</b></td><td>7</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>0.019s</pre></td></tr><tr><td><b>details</b></td><td><div class="imandra-fold panel panel-default" id="fold-69a082fc-af29-4797-af1c-ae3b1a26d805"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-344ad428-1cb7-4fc9-8970-7d78684c6944"><table><tr><td><b>smt_stats</b></td><td><div class="imandra-table" id="table-53e320c8-4b37-4e09-a8ef-46e8ce07c78b"><table><tr><td><b>num checks</b></td><td>15</td></tr><tr><td><b>arith-make-feasible</b></td><td>21</td></tr><tr><td><b>arith-max-columns</b></td><td>13</td></tr><tr><td><b>rlimit count</b></td><td>8536</td></tr><tr><td><b>arith-cheap-eqs</b></td><td>38</td></tr><tr><td><b>mk clause</b></td><td>98</td></tr><tr><td><b>datatype occurs check</b></td><td>162</td></tr><tr><td><b>mk bool var</b></td><td>480</td></tr><tr><td><b>arith-lower</b></td><td>23</td></tr><tr><td><b>arith-diseq</b></td><td>2</td></tr><tr><td><b>datatype splits</b></td><td>39</td></tr><tr><td><b>decisions</b></td><td>232</td></tr><tr><td><b>propagations</b></td><td>340</td></tr><tr><td><b>arith-max-rows</b></td><td>5</td></tr><tr><td><b>conflicts</b></td><td>41</td></tr><tr><td><b>datatype accessor ax</b></td><td>105</td></tr><tr><td><b>minimized lits</b></td><td>22</td></tr><tr><td><b>datatype constructor ax</b></td><td>140</td></tr><tr><td><b>num allocs</b></td><td>8298798</td></tr><tr><td><b>final checks</b></td><td>15</td></tr><tr><td><b>added eqs</b></td><td>1084</td></tr><tr><td><b>del clause</b></td><td>27</td></tr><tr><td><b>arith eq adapter</b></td><td>26</td></tr><tr><td><b>arith-upper</b></td><td>25</td></tr><tr><td><b>time</b></td><td>0.001000</td></tr><tr><td><b>memory</b></td><td>8.790000</td></tr><tr><td><b>max memory</b></td><td>8.790000</td></tr></table></div></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-69a082fc-af29-4797-af1c-ae3b1a26d805';
  fold.hydrate(target);
});
</script></div></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-03cc9296-d2cb-4d9d-9199-f8d32ac47aed"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.019s]
  let (_x_0 : state)
      = List.fold_left update
        {status = ; callIncomingFrom = ; peopleInCall = }
        ( :var_0: )
  in
  if List.length _x_0.peopleInCall &gt; 0 then _x_0.status = CallActive
  else true</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-15cb883f-15a9-4357-894c-fcc37cbbd326"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : state)
    = List.fold_left update
      {status = ; callIncomingFrom = ; peopleInCall = } ( :var_0: )
in _x_0.status = CallActive || List.length _x_0.peopleInCall &lt;= 0</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-9eb4e48b-256c-4468-9c51-6520a35b380d"><table><tr><td><b>expr</b></td><td><pre>(|List.length_1883|
  (peopleInCall_33 (|`List.fold_left update[0]`_1878|
                     (|rec</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-552d1ea7-86ca-4e4b-9a7a-dd56c1a464b6"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left update[0]`_1878|
  (|rec_mk.state_1868| Idle_25 None_4 |[]_2|)
  _x_0_129)</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-567f729a-30df-4aba-b6a8-15c0c7fd2634"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1873| (peopleInCall_33 (|`List.fold_left update[0]`_1878|
                    </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-164a1232-9e5a-481c-b285-efa48b18157a"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left update[0]`_1878|
  (update_36 (|rec_mk.state_1868| Idle_25 None_4 |[]_2|)
        </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-82b4d65e-d059-436a-bab3-018c0322fce6"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1873| (peopleInCall_33 (|`List.fold_left update[0]`_1878|
                    </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-dc8d95fc-7ab2-4dbf-9331-578466228482"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left update[0]`_1878|
  (update_36 (update_36 (|rec_mk.state_1868| Idle_25 None_4 |[]_2</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-210a9375-001c-48a8-ac14-b359206df52e"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (update_36 (update_36 (update_36 (|rec_mk.state_1868|
                                   </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li>Sat (Some  let (_x_0 : action list) =
  [(CallIncomingFrom (3)); CallAccepted; (CallIncomingFrom (5))]
)</li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-03cc9296-d2cb-4d9d-9199-f8d32ac47aed';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-6057a694-49d5-4b74-98f7-47c8e229b805"><textarea style="display: none">digraph &quot;proof&quot; {
p_21 [label=&quot;Start (let (_x_0 : state)\l           = List.fold_left update\l             \{status = ; callIncomingFrom = ; peopleInCall = \}\l             ( :var_0: )\l       in\l       if List.length _x_0.peopleInCall \&gt; 0 then _x_0.status = CallActive\l       else true :time 0.019s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_21 -&gt; p_20 [label=&quot;&quot;];
p_20 [label=&quot;Simplify (let (_x_0 : state)\l              = List.fold_left update\l                \{status = ; callIncomingFrom = ; peopleInCall = \}\l                ( :var_0: )\l          in _x_0.status = CallActive \|\| List.length _x_0.peopleInCall \&lt;= 0\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_20 -&gt; p_19 [label=&quot;&quot;];
p_19 [label=&quot;Unroll ([List.length\l         (List.fold_left update\l          \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_19 -&gt; p_18 [label=&quot;&quot;];
p_18 [label=&quot;Unroll ([List.fold_left update\l         \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_18 -&gt; p_17 [label=&quot;&quot;];
p_17 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.fold_left update\l           \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_17 -&gt; p_16 [label=&quot;&quot;];
p_16 [label=&quot;Unroll ([List.fold_left update\l         (update \{status = ; callIncomingFrom = ; peopleInCall = \}\l          (List.hd _x_0))\l         (List.tl _x_0)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_16 -&gt; p_15 [label=&quot;&quot;];
p_15 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.tl\l           (List.fold_left update\l            \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_15 -&gt; p_14 [label=&quot;&quot;];
p_14 [label=&quot;Unroll ([let (_x_0 : action list) = List.tl _x_0 in\l         List.fold_left update\l         (update\l          (update \{status = ; callIncomingFrom = ; peopleInCall = \}\l           (List.hd _x_0))\l          (List.hd _x_0))\l         (List.tl _x_0)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_14 -&gt; p_13 [label=&quot;&quot;];
p_13 [label=&quot;Unroll ([let (_x_0 : action list) = List.tl _x_0 in\l         let (_x_1 : action list) = List.tl _x_0 in\l         List.fold_left update\l         (update\l          (update\l           (update \{status = ; callIncomingFrom = ; peopleInCall = \}\l            (List.hd _x_0))\l           (List.hd _x_0))\l          (List.hd _x_1))\l         (List.tl _x_1)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_13 -&gt; p_12 [label=&quot;&quot;];
p_12 [label=&quot;Sat (Some  let (_x_0 : action list) =\l  [(CallIncomingFrom (3)); CallAccepted; (CallIncomingFrom (5))]\l)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-6057a694-49d5-4b74-98f7-47c8e229b805';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-c45cf838-e4d9-437a-9a40-b98ad6a481a2';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-b0d91058-04c7-46da-9ce0-35f1692939bc';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-2b003dae-1cde-4bc7-ba37-53e5afb30e79';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This reveals another case we hadn't considered! We don't handle the <code>CallIncomingFrom</code> action from the <code>CallActive</code> state - it drops us straight out of <code>CallActive</code> back into <code>CallIncoming</code> while leaving people in the call, which might not be what we want.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-33" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="n">update</span><span class="ow">(</span><span class="n">update</span><span class="ow">(</span><span class="n">update</span><span class="ow">(</span><span class="n">initial_state</span><span class="ow">,</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="mi">4</span><span class="ow">)),</span> <span class="nc">CallAccepted</span><span class="ow">),</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="mi">5</span><span class="ow">));</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : state =
{status = CallIncoming; callIncomingFrom = Some 5; peopleInCall = [4]}
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we know there's a problem, we can re-work our update logic to accommodate. We learnt earlier while working on our 'ideal' representation that checking the current state is a good idea, so let's incorporate that here:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-35" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">good_update</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">state</span><span class="ow">:</span> <span class="n">state</span><span class="ow">,</span> <span class="n">action</span><span class="ow">:</span> <span class="n">action_v2</span><span class="ow">):</span> <span class="n">state</span> <span class="ow">=&gt;</span>
  <span class="k">switch</span> <span class="ow">(</span><span class="n">state</span><span class="ow">.</span><span class="n">status</span><span class="ow">,</span> <span class="n">action</span><span class="ow">)</span> <span class="ow">{</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">Idle</span><span class="ow">,</span> <span class="nc">CallIncomingFrom</span><span class="ow">(</span><span class="n">person</span><span class="ow">))</span> <span class="ow">=&gt;</span>
    <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">CallIncoming</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">Some</span><span class="ow">(</span><span class="n">person</span><span class="ow">)}</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallIncoming</span><span class="ow">,</span> <span class="nc">CallRejected</span><span class="ow">)</span> <span class="ow">=&gt;</span>
    <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">Idle</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span><span class="ow">}</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallIncoming</span><span class="ow">,</span> <span class="nc">CallAccepted</span><span class="ow">)</span> <span class="ow">=&gt;</span>
    <span class="k">switch</span> <span class="ow">(</span><span class="n">state</span><span class="ow">.</span><span class="n">callIncomingFrom</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="ow">|</span> <span class="nc">Some</span><span class="ow">(</span><span class="n">p</span><span class="ow">)</span> <span class="ow">=&gt;</span>
      <span class="ow">{</span><span class="n">status</span><span class="ow">:</span> <span class="nc">CallActive</span><span class="ow">,</span> <span class="n">callIncomingFrom</span><span class="ow">:</span> <span class="nc">None</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="ow">[</span><span class="n">p</span><span class="ow">]}</span>
    <span class="ow">|</span> <span class="ow">_</span> <span class="ow">=&gt;</span> <span class="n">state</span>
    <span class="ow">}</span>

  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallActive</span><span class="ow">,</span> <span class="nc">AddPerson</span><span class="ow">(</span><span class="n">p</span><span class="ow">))</span> <span class="ow">=&gt;</span>
    <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="ow">[</span><span class="n">p</span><span class="ow">,</span> <span class="ow">...</span><span class="n">state</span><span class="ow">.</span><span class="n">peopleInCall</span><span class="ow">]}</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="nc">CallActive</span><span class="ow">,</span> <span class="nc">EndCall</span><span class="ow">)</span> <span class="ow">=&gt;</span>
    <span class="ow">{...</span><span class="n">state</span><span class="ow">,</span> <span class="n">status</span><span class="ow">:</span> <span class="nc">Idle</span><span class="ow">,</span> <span class="n">peopleInCall</span><span class="ow">:</span> <span class="bp">[]</span><span class="ow">}</span>
  <span class="ow">|</span> <span class="ow">_</span> <span class="ow">=&gt;</span> <span class="n">state</span>
  <span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val good_update : state -&gt; action_v2 -&gt; state = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, let's check it with our general property:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-37" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="n">verify</span> <span class="n">upto</span><span class="ow">:</span><span class="mi">50</span> <span class="n">call_with_people_in_is_active_property</span><span class="ow">(</span><span class="n">good_update</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>File &#34;jupyter cell 19&#34;, line 1, characters 15-81:
1 | verify upto:50 call_with_people_in_is_active_property(good_update, initial_state);
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Warning 5: this function application is partial,
maybe some arguments are missing.
- : action_v2 list -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px dashed #337ab7; border-bottom: 1px dashed #337ab7"><i class="fa fa-question-circle-o" style="margin-right: 0.5em; color: #337ab7"></i><span>Unknown (Verification aborted by the solver (after 24 steps))</span></div><div><div class="imandra-alternatives" id="alt-2e1abe5c-c842-45f9-b90f-fec5bd3c2426"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>instances</a></li><li class="" data-toggle="tab"><a>call graph</a></li><li class="" data-toggle="tab"><a>proof</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-fold panel panel-default" id="fold-074cbeb1-551e-4630-bf1c-f19b706508b3"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><div class="imandra-table" id="table-389a3078-ce56-4587-a882-775079143bd4"><table><tr><td><b>expanded</b></td><td><ul><li>List.length
(List.tl
 (List.tl
  (List.fold_left good_update
   {status = ; callIncomingFrom = ; peopleInCall = } _x_0).peopleInCall))</li><li>List.length
(List.tl
 (List.fold_left good_update
  {status = ; callIncomingFrom = ; peopleInCall = } _x_0).peopleInCall)</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl
       (List.tl
        (List.tl
         (List.tl
          (List.tl
           (List.tl
            (List.tl
             (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
List.fold_left good_update
(good_update (good_update (good_update  ) (List.hd _x_0))
 (List.hd _x_1))
(List.tl _x_1)</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
let (_x_4 : action_v2 list) = List.tl _x_3 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update (good_update (good_update  ) (List.hd _x_0))
    (List.hd _x_1))
   (List.hd _x_2))
  (List.hd _x_3))
 (List.hd _x_4))
(List.tl _x_4)</li><li>let (_x_0 : action_v2 list) = List.tl _x_0 in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
let (_x_4 : action_v2 list) = List.tl _x_3 in
let (_x_5 : action_v2 list) = List.tl _x_4 in
let (_x_6 : action_v2 list) = List.tl _x_5 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update
    (good_update
     (good_update
      (good_update
       (good_update
        {status = ; callIncomingFrom = ; peopleInCall = }
        (List.hd _x_0))
       (List.hd _x_0))
      (List.hd _x_1))
     (List.hd _x_2))
    (List.hd _x_3))
   (List.hd _x_4))
  (List.hd _x_5))
 (List.hd _x_6))
(List.tl _x_6)</li><li>let (_x_0 : action_v2 list) = List.tl _x_0 in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update {status = ; callIncomingFrom = ; peopleInCall = }
    (List.hd _x_0))
   (List.hd _x_0))
  (List.hd _x_1))
 (List.hd _x_2))
(List.tl _x_2)</li><li>List.length
(List.tl
 (List.tl
  (List.tl
   (List.fold_left good_update
    {status = ; callIncomingFrom = ; peopleInCall = } _x_0).peopleInCall)))</li><li>List.fold_left good_update
{status = ; callIncomingFrom = ; peopleInCall = } _x_0</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
let (_x_4 : action_v2 list) = List.tl _x_3 in
let (_x_5 : action_v2 list) = List.tl _x_4 in
let (_x_6 : action_v2 list) = List.tl _x_5 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update
    (good_update
     (good_update (good_update (good_update  ) (List.hd _x_0))
      (List.hd _x_1))
     (List.hd _x_2))
    (List.hd _x_3))
   (List.hd _x_4))
  (List.hd _x_5))
 (List.hd _x_6))
(List.tl _x_6)</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
List.fold_left good_update
(good_update
 (good_update (good_update (good_update  ) (List.hd _x_0))
  (List.hd _x_1))
 (List.hd _x_2))
(List.tl _x_2)</li><li>let (_x_0 : action_v2 list) = List.tl _x_0 in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
let (_x_4 : action_v2 list) = List.tl _x_3 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update
    (good_update
     (good_update {status = ; callIncomingFrom = ; peopleInCall = }
      (List.hd _x_0))
     (List.hd _x_0))
    (List.hd _x_1))
   (List.hd _x_2))
  (List.hd _x_3))
 (List.hd _x_4))
(List.tl _x_4)</li><li>let (_x_0 : action_v2 list) = List.tl _x_0 in
List.fold_left good_update
(good_update
 (good_update {status = ; callIncomingFrom = ; peopleInCall = }
  (List.hd _x_0))
 (List.hd _x_0))
(List.tl _x_0)</li><li>List.length
(List.tl
 (List.tl
  (List.tl
   (List.tl
    (List.tl
     (List.fold_left good_update
      {status = ; callIncomingFrom = ; peopleInCall = } _x_0).peopleInCall)))))</li><li>List.length
(List.fold_left good_update
 {status = ; callIncomingFrom = ; peopleInCall = } _x_0).peopleInCall</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
let (_x_4 : action_v2 list) = List.tl _x_3 in
let (_x_5 : action_v2 list) = List.tl _x_4 in
let (_x_6 : action_v2 list) = List.tl _x_5 in
let (_x_7 : action_v2 list) = List.tl _x_6 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update
    (good_update
     (good_update
      (good_update (good_update (good_update  ) (List.hd _x_0))
       (List.hd _x_1))
      (List.hd _x_2))
     (List.hd _x_3))
    (List.hd _x_4))
   (List.hd _x_5))
  (List.hd _x_6))
 (List.hd _x_7))
(List.tl _x_7)</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
let (_x_4 : action_v2 list) = List.tl _x_3 in
let (_x_5 : action_v2 list) = List.tl _x_4 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update
    (good_update (good_update (good_update  ) (List.hd _x_0))
     (List.hd _x_1))
    (List.hd _x_2))
   (List.hd _x_3))
  (List.hd _x_4))
 (List.hd _x_5))
(List.tl _x_5)</li><li>let (_x_0 : action_v2 list) = List.tl _x_0 in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
let (_x_4 : action_v2 list) = List.tl _x_3 in
let (_x_5 : action_v2 list) = List.tl _x_4 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update
    (good_update
     (good_update
      (good_update {status = ; callIncomingFrom = ; peopleInCall = }
       (List.hd _x_0))
      (List.hd _x_0))
     (List.hd _x_1))
    (List.hd _x_2))
   (List.hd _x_3))
  (List.hd _x_4))
 (List.hd _x_5))
(List.tl _x_5)</li><li>let (_x_0 : action_v2 list) = List.tl _x_0 in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
List.fold_left good_update
(good_update
 (good_update
  (good_update
   (good_update
    (good_update {status = ; callIncomingFrom = ; peopleInCall = }
     (List.hd _x_0))
    (List.hd _x_0))
   (List.hd _x_1))
  (List.hd _x_2))
 (List.hd _x_3))
(List.tl _x_3)</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl
       (List.tl
        (List.tl
         (List.tl
          (List.tl
           (List.tl
            (List.tl
             (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
List.fold_left good_update
(good_update
 (good_update (good_update (good_update  ) (List.hd _x_0))
  (List.hd _x_1))
 (List.hd _x_2))
(List.tl _x_2)</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
List.fold_left good_update
(good_update
 (good_update
  (good_update (good_update (good_update  ) (List.hd _x_0))
   (List.hd _x_1))
  (List.hd _x_2))
 (List.hd _x_3))
(List.tl _x_3)</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
List.fold_left good_update
(good_update (good_update (good_update  ) (List.hd _x_0))
 (List.hd _x_1))
(List.tl _x_1)</li><li>let (_x_0 : action_v2 list) = List.tl _x_0 in
let (_x_1 : action_v2 list) = List.tl _x_0 in
List.fold_left good_update
(good_update
 (good_update
  (good_update {status = ; callIncomingFrom = ; peopleInCall = }
   (List.hd _x_0))
  (List.hd _x_0))
 (List.hd _x_1))
(List.tl _x_1)</li><li>List.fold_left good_update
(good_update {status = ; callIncomingFrom = ; peopleInCall = }
 (List.hd _x_0))
(List.tl _x_0)</li><li>List.length
(List.tl
 (List.tl
  (List.tl
   (List.tl
    (List.fold_left good_update
     {status = ; callIncomingFrom = ; peopleInCall = } _x_0).peopleInCall))))</li></ul></td></tr><tr><td><b>blocked</b></td><td><ul><li>List.length
(List.tl
 (List.tl
  (List.tl
   (List.tl
    (List.tl
     (List.tl
      (List.fold_left good_update
       {status = ; callIncomingFrom = ; peopleInCall = } _x_0).peopleInCall))))))</li><li>let (_x_0 : action_v2 list)
    = List.tl
      (List.tl
       (List.tl
        (List.tl
         (List.tl
          (List.tl
           (List.tl
            (List.tl
             (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))
in
let (_x_1 : action_v2 list) = List.tl _x_0 in
let (_x_2 : action_v2 list) = List.tl _x_1 in
let (_x_3 : action_v2 list) = List.tl _x_2 in
List.fold_left good_update
(good_update
 (good_update
  (good_update (good_update (good_update  ) (List.hd _x_0))
   (List.hd _x_1))
  (List.hd _x_2))
 (List.hd _x_3))
(List.tl _x_3)</li></ul></td></tr></table></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-074cbeb1-551e-4630-bf1c-f19b706508b3';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-11c20700-5cbc-408d-854d-2a427407c279"><textarea style="display: none">digraph &quot;call graph&quot; {
goal [label=&quot;not\l((List.fold_left good_update\l  \{status = Idle; callIncomingFrom = None; peopleInCall = []\} _x_0).status\l = CallActive\l \|\| List.length\l    (List.fold_left good_update\l     \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall\l    \&lt;= 0)&quot;,shape=box,style=filled,color=&quot;cyan&quot;,fontname=&quot;courier&quot;,fontsize=14];
goal -&gt; call_36 [label=&quot;calls&quot;];
goal -&gt; call_32 [label=&quot;calls&quot;];
call_36 [label=&quot;List.length\l(List.fold_left good_update\l \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_36 -&gt; call_126 [label=&quot;calls&quot;];
call_32 [label=&quot;List.fold_left good_update\l\{status = ; callIncomingFrom = ; peopleInCall = \} _x_0&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_32 -&gt; call_263 [label=&quot;calls&quot;];
call_126 [label=&quot;List.length\l(List.tl\l (List.fold_left good_update\l  \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_126 -&gt; call_427 [label=&quot;calls&quot;];
call_263 [label=&quot;List.fold_left good_update\l(good_update \{status = ; callIncomingFrom = ; peopleInCall = \}\l (List.hd _x_0))\l(List.tl _x_0)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_263 -&gt; call_488 [label=&quot;calls&quot;];
call_427 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.fold_left good_update\l   \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_427 -&gt; call_806 [label=&quot;calls&quot;];
call_488 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\lList.fold_left good_update\l(good_update\l (good_update \{status = ; callIncomingFrom = ; peopleInCall = \}\l  (List.hd _x_0))\l (List.hd _x_0))\l(List.tl _x_0)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_488 -&gt; call_833 [label=&quot;calls&quot;];
call_806 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.tl\l   (List.fold_left good_update\l    \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)))&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_806 -&gt; call_5700 [label=&quot;calls&quot;];
call_833 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\llet (_x_1 : action_v2 list) = List.tl _x_0 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update \{status = ; callIncomingFrom = ; peopleInCall = \}\l   (List.hd _x_0))\l  (List.hd _x_0))\l (List.hd _x_1))\l(List.tl _x_1)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_833 -&gt; call_1299 [label=&quot;calls&quot;];
call_5700 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.tl\l   (List.tl\l    (List.fold_left good_update\l     \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))))&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_5700 -&gt; call_14976 [label=&quot;calls&quot;];
call_1299 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update \{status = ; callIncomingFrom = ; peopleInCall = \}\l    (List.hd _x_0))\l   (List.hd _x_0))\l  (List.hd _x_1))\l (List.hd _x_2))\l(List.tl _x_2)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_1299 -&gt; call_2166 [label=&quot;calls&quot;];
call_14976 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.tl\l   (List.tl\l    (List.tl\l     (List.fold_left good_update\l      \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)))))&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_14976 -&gt; call_375818 [label=&quot;calls&quot;];
call_2166 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update\l    (good_update \{status = ; callIncomingFrom = ; peopleInCall = \}\l     (List.hd _x_0))\l    (List.hd _x_0))\l   (List.hd _x_1))\l  (List.hd _x_2))\l (List.hd _x_3))\l(List.tl _x_3)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_2166 -&gt; call_3799 [label=&quot;calls&quot;];
call_375818 [label=&quot;List.length\l(List.tl\l (List.tl\l  (List.tl\l   (List.tl\l    (List.tl\l     (List.tl\l      (List.fold_left good_update\l       \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))))))&quot;,shape=box,style=filled,color=&quot;yellow&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_3799 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\llet (_x_4 : action_v2 list) = List.tl _x_3 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update\l    (good_update\l     (good_update \{status = ; callIncomingFrom = ; peopleInCall = \}\l      (List.hd _x_0))\l     (List.hd _x_0))\l    (List.hd _x_1))\l   (List.hd _x_2))\l  (List.hd _x_3))\l (List.hd _x_4))\l(List.tl _x_4)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_3799 -&gt; call_5983 [label=&quot;calls&quot;];
call_5983 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\llet (_x_4 : action_v2 list) = List.tl _x_3 in\llet (_x_5 : action_v2 list) = List.tl _x_4 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update\l    (good_update\l     (good_update\l      (good_update \{status = ; callIncomingFrom = ; peopleInCall = \}\l       (List.hd _x_0))\l      (List.hd _x_0))\l     (List.hd _x_1))\l    (List.hd _x_2))\l   (List.hd _x_3))\l  (List.hd _x_4))\l (List.hd _x_5))\l(List.tl _x_5)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_5983 -&gt; call_9682 [label=&quot;calls&quot;];
call_9682 [label=&quot;let (_x_0 : action_v2 list) = List.tl _x_0 in\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\llet (_x_4 : action_v2 list) = List.tl _x_3 in\llet (_x_5 : action_v2 list) = List.tl _x_4 in\llet (_x_6 : action_v2 list) = List.tl _x_5 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update\l    (good_update\l     (good_update\l      (good_update\l       (good_update\l        \{status = ; callIncomingFrom = ; peopleInCall = \}\l        (List.hd _x_0))\l       (List.hd _x_0))\l      (List.hd _x_1))\l     (List.hd _x_2))\l    (List.hd _x_3))\l   (List.hd _x_4))\l  (List.hd _x_5))\l (List.hd _x_6))\l(List.tl _x_6)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_9682 -&gt; call_14991 [label=&quot;calls&quot;];
call_14991 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\lList.fold_left good_update\l(good_update (good_update (good_update  ) (List.hd _x_0))\l (List.hd _x_1))\l(List.tl _x_1)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_14991 -&gt; call_29760 [label=&quot;calls&quot;];
call_29760 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\lList.fold_left good_update\l(good_update\l (good_update (good_update (good_update  ) (List.hd _x_0))\l  (List.hd _x_1))\l (List.hd _x_2))\l(List.tl _x_2)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_29760 -&gt; call_46408 [label=&quot;calls&quot;];
call_46408 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update (good_update (good_update  ) (List.hd _x_0))\l   (List.hd _x_1))\l  (List.hd _x_2))\l (List.hd _x_3))\l(List.tl _x_3)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_46408 -&gt; call_23388 [label=&quot;calls&quot;];
call_23388 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\llet (_x_4 : action_v2 list) = List.tl _x_3 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update (good_update (good_update  ) (List.hd _x_0))\l    (List.hd _x_1))\l   (List.hd _x_2))\l  (List.hd _x_3))\l (List.hd _x_4))\l(List.tl _x_4)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_23388 -&gt; call_14978 [label=&quot;calls&quot;];
call_14978 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\llet (_x_4 : action_v2 list) = List.tl _x_3 in\llet (_x_5 : action_v2 list) = List.tl _x_4 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update\l    (good_update (good_update (good_update  ) (List.hd _x_0))\l     (List.hd _x_1))\l    (List.hd _x_2))\l   (List.hd _x_3))\l  (List.hd _x_4))\l (List.hd _x_5))\l(List.tl _x_5)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_14978 -&gt; call_230580 [label=&quot;calls&quot;];
call_230580 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\llet (_x_4 : action_v2 list) = List.tl _x_3 in\llet (_x_5 : action_v2 list) = List.tl _x_4 in\llet (_x_6 : action_v2 list) = List.tl _x_5 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update\l    (good_update\l     (good_update (good_update (good_update  ) (List.hd _x_0))\l      (List.hd _x_1))\l     (List.hd _x_2))\l    (List.hd _x_3))\l   (List.hd _x_4))\l  (List.hd _x_5))\l (List.hd _x_6))\l(List.tl _x_6)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_230580 -&gt; call_375977 [label=&quot;calls&quot;];
call_375977 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\llet (_x_4 : action_v2 list) = List.tl _x_3 in\llet (_x_5 : action_v2 list) = List.tl _x_4 in\llet (_x_6 : action_v2 list) = List.tl _x_5 in\llet (_x_7 : action_v2 list) = List.tl _x_6 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update\l   (good_update\l    (good_update\l     (good_update\l      (good_update (good_update (good_update  ) (List.hd _x_0))\l       (List.hd _x_1))\l      (List.hd _x_2))\l     (List.hd _x_3))\l    (List.hd _x_4))\l   (List.hd _x_5))\l  (List.hd _x_6))\l (List.hd _x_7))\l(List.tl _x_7)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_375977 -&gt; call_636437 [label=&quot;calls&quot;];
call_636437 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl\l       (List.tl\l        (List.tl\l         (List.tl\l          (List.tl\l           (List.tl\l            (List.tl\l             (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\lList.fold_left good_update\l(good_update (good_update (good_update  ) (List.hd _x_0))\l (List.hd _x_1))\l(List.tl _x_1)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_636437 -&gt; call_801 [label=&quot;calls&quot;];
call_801 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl\l       (List.tl\l        (List.tl\l         (List.tl\l          (List.tl\l           (List.tl\l            (List.tl\l             (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\lList.fold_left good_update\l(good_update\l (good_update (good_update (good_update  ) (List.hd _x_0))\l  (List.hd _x_1))\l (List.hd _x_2))\l(List.tl _x_2)&quot;,shape=box,style=filled,color=&quot;green&quot;,fontname=&quot;courier&quot;,fontsize=14];
call_801 -&gt; call_1084863 [label=&quot;calls&quot;];
call_1084863 [label=&quot;let (_x_0 : action_v2 list)\l    = List.tl\l      (List.tl\l       (List.tl\l        (List.tl\l         (List.tl\l          (List.tl\l           (List.tl\l            (List.tl\l             (List.tl (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))\lin\llet (_x_1 : action_v2 list) = List.tl _x_0 in\llet (_x_2 : action_v2 list) = List.tl _x_1 in\llet (_x_3 : action_v2 list) = List.tl _x_2 in\lList.fold_left good_update\l(good_update\l (good_update\l  (good_update (good_update (good_update  ) (List.hd _x_0))\l   (List.hd _x_1))\l  (List.hd _x_2))\l (List.hd _x_3))\l(List.tl _x_3)&quot;,shape=box,style=filled,color=&quot;yellow&quot;,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-11c20700-5cbc-408d-854d-2a427407c279';
  graphviz.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-33f7e658-4475-427e-a01b-5f6bb4127fa9"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof attempt</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-9721a27d-9e00-44f6-828e-b4cd37799c78"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-9a8b081a-98ba-4271-9761-26b91494cad9"><table><tr><td><b>ground_instances</b></td><td>24</td></tr><tr><td><b>definitions</b></td><td>0</td></tr><tr><td><b>inductions</b></td><td>0</td></tr><tr><td><b>search_time</b></td><td><pre>106.706s</pre></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-ffae17dd-d9bd-47e2-b5d4-94183d8dc2d3"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[106.706s]
  let (_x_0 : state)
      = List.fold_left good_update
        {status = ; callIncomingFrom = ; peopleInCall = }
        ( :var_0: )
  in
  if List.length _x_0.peopleInCall &gt; 0 then _x_0.status = CallActive
  else true</pre></li><li><div><h4>simplify</h4><div class="imandra-table" id="table-5ae28656-0681-454b-a3e2-ad72ec7ab967"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : state)
    = List.fold_left good_update
      {status = ; callIncomingFrom = ; peopleInCall = } ( :var_0: )
in _x_0.status = CallActive || List.length _x_0.peopleInCall &lt;= 0</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-a31523a5-5fb5-4e2c-b0e5-3a8e2084ec3c"><table><tr><td><b>expr</b></td><td><pre>(|List.length_1890|
  (peopleInCall_33 (|`List.fold_left good_update[0]`_1885|
                     </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-1c8665f9-1428-4392-b047-3f179515d3e8"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left good_update[0]`_1885|
  (|rec_mk.state_1875| Idle_25 None_4 |[]_2|)
  _x_0_151)</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-24a52eb5-2567-49f2-903f-8c11b06fe8cd"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1880| (peopleInCall_33 (|`List.fold_left good_update[0]`_1885|
               </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-96629851-73b0-4af1-9bd4-aa7ecf41b7c4"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left good_update[0]`_1885|
  (good_update_130 (|rec_mk.state_1875| Idle_25 None_4 |[]_2</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-d725cca9-0436-450c-87f6-ae7845fa19f0"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1880| (peopleInCall_33 (|`List.fold_left good_update[0]`_1885|
               </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-f16d55bc-b0dd-4ee9-bd88-f8965bc2a2c0"><table><tr><td><b>expr</b></td><td><pre>(|`List.fold_left good_update[0]`_1885|
  (good_update_130 (good_update_130 (|rec_mk.state_1875| Idl</pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-d429daab-71df-4634-93ad-df775942609a"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-2434b56d-cada-4367-a330-870efc51773e"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-6f740727-3de9-422f-a087-8db15420e089"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-c87c9b74-3c56-4a49-b048-45fe113845a3"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1880| (peopleInCall_33 (|`List.fold_left good_update[0]`_1885|
               </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-fda63533-2c4d-4503-98e7-e379e2292dad"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-c105af93-cd0a-49f0-9f95-1877a97c8498"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-b6461ecc-3e02-4235-97b9-1e3d42f55642"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-943f37d5-591c-4567-b40a-6784e0f60bca"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-fea0a2bb-e7b7-4023-ae12-94ab56cf6c19"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1880| (peopleInCall_33 (|`List.fold_left good_update[0]`_1885|
               </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-b8af497b-81d1-4f83-b232-05b98d3f0502"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-3111bca8-5713-412a-b3b5-459d42a621a3"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-f0d6a679-778e-4ad0-9c7a-ea66ef5ae743"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-adcc4532-11f9-4942-956f-8936b570a780"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-d2b648c2-7c20-4414-85e1-a9265f87756a"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (|get.::.1_1880| (peopleInCall_33 (|`List.fold_left good_update[0]`_1885|
               </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-e846715f-ddf8-470c-9030-fd2024ccf8f9"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-60c004e1-db96-478a-b868-b5fd142ff13a"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-cd0773c8-dec6-43a7-a0ed-2b925ec228db"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li><li><div>unroll<div class="imandra-table" id="table-c6e900c5-15a9-4bb7-9130-ad0abddfbe31"><table><tr><td><b>expr</b></td><td><pre>(let ((a!1 (good_update_130 (good_update_130 (good_update_130 (|rec_mk.state_1875|
                 </pre></td></tr><tr><td><b>expansions</b></td><td><ul></ul></td></tr></table></div></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-ffae17dd-d9bd-47e2-b5d4-94183d8dc2d3';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-7b83bc74-2662-4faf-be1b-60db4f80447f"><textarea style="display: none">digraph &quot;proof&quot; {
p_25 [label=&quot;Start (let (_x_0 : state)\l           = List.fold_left good_update\l             \{status = ; callIncomingFrom = ; peopleInCall = \}\l             ( :var_0: )\l       in\l       if List.length _x_0.peopleInCall \&gt; 0 then _x_0.status = CallActive\l       else true :time 106.706s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_25 -&gt; p_24 [label=&quot;&quot;];
p_24 [label=&quot;Simplify (let (_x_0 : state)\l              = List.fold_left good_update\l                \{status = ; callIncomingFrom = ; peopleInCall = \}\l                ( :var_0: )\l          in _x_0.status = CallActive \|\| List.length _x_0.peopleInCall \&lt;= 0\l          :expansions [] :rw [] :fc [])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_24 -&gt; p_23 [label=&quot;&quot;];
p_23 [label=&quot;Unroll ([List.length\l         (List.fold_left good_update\l          \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_23 -&gt; p_22 [label=&quot;&quot;];
p_22 [label=&quot;Unroll ([List.fold_left good_update\l         \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_22 -&gt; p_21 [label=&quot;&quot;];
p_21 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.fold_left good_update\l           \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_21 -&gt; p_20 [label=&quot;&quot;];
p_20 [label=&quot;Unroll ([List.fold_left good_update\l         (good_update\l          \{status = ; callIncomingFrom = ; peopleInCall = \}\l          (List.hd _x_0))\l         (List.tl _x_0)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_20 -&gt; p_19 [label=&quot;&quot;];
p_19 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.tl\l           (List.fold_left good_update\l            \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_19 -&gt; p_18 [label=&quot;&quot;];
p_18 [label=&quot;Unroll ([let (_x_0 : action_v2 list) = List.tl _x_0 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           \{status = ; callIncomingFrom = ; peopleInCall = \}\l           (List.hd _x_0))\l          (List.hd _x_0))\l         (List.tl _x_0)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_18 -&gt; p_17 [label=&quot;&quot;];
p_17 [label=&quot;Unroll ([let (_x_0 : action_v2 list) = List.tl _x_0 in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            \{status = ; callIncomingFrom = ; peopleInCall = \}\l            (List.hd _x_0))\l           (List.hd _x_0))\l          (List.hd _x_1))\l         (List.tl _x_1)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_17 -&gt; p_16 [label=&quot;&quot;];
p_16 [label=&quot;Unroll ([let (_x_0 : action_v2 list) = List.tl _x_0 in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             \{status = ; callIncomingFrom = ; peopleInCall = \}\l             (List.hd _x_0))\l            (List.hd _x_0))\l           (List.hd _x_1))\l          (List.hd _x_2))\l         (List.tl _x_2)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_16 -&gt; p_15 [label=&quot;&quot;];
p_15 [label=&quot;Unroll ([let (_x_0 : action_v2 list) = List.tl _x_0 in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             (good_update\l              \{status = ; callIncomingFrom = ; peopleInCall = \}\l              (List.hd _x_0))\l             (List.hd _x_0))\l            (List.hd _x_1))\l           (List.hd _x_2))\l          (List.hd _x_3))\l         (List.tl _x_3)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_15 -&gt; p_14 [label=&quot;&quot;];
p_14 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.tl\l           (List.tl\l            (List.fold_left good_update\l             \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall)))],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_14 -&gt; p_13 [label=&quot;&quot;];
p_13 [label=&quot;Unroll ([let (_x_0 : action_v2 list) = List.tl _x_0 in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         let (_x_4 : action_v2 list) = List.tl _x_3 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             (good_update\l              (good_update\l               \{status = ; callIncomingFrom = ; peopleInCall = \}\l               (List.hd _x_0))\l              (List.hd _x_0))\l             (List.hd _x_1))\l            (List.hd _x_2))\l           (List.hd _x_3))\l          (List.hd _x_4))\l         (List.tl _x_4)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_13 -&gt; p_12 [label=&quot;&quot;];
p_12 [label=&quot;Unroll ([let (_x_0 : action_v2 list) = List.tl _x_0 in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         let (_x_4 : action_v2 list) = List.tl _x_3 in\l         let (_x_5 : action_v2 list) = List.tl _x_4 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             (good_update\l              (good_update\l               (good_update\l                \{status = ; callIncomingFrom = ; peopleInCall = \}\l                (List.hd _x_0))\l               (List.hd _x_0))\l              (List.hd _x_1))\l             (List.hd _x_2))\l            (List.hd _x_3))\l           (List.hd _x_4))\l          (List.hd _x_5))\l         (List.tl _x_5)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_12 -&gt; p_11 [label=&quot;&quot;];
p_11 [label=&quot;Unroll ([let (_x_0 : action_v2 list) = List.tl _x_0 in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         let (_x_4 : action_v2 list) = List.tl _x_3 in\l         let (_x_5 : action_v2 list) = List.tl _x_4 in\l         let (_x_6 : action_v2 list) = List.tl _x_5 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             (good_update\l              (good_update\l               (good_update\l                (good_update\l                 \{status = ; callIncomingFrom = ; peopleInCall = \}\l                 (List.hd _x_0))\l                (List.hd _x_0))\l               (List.hd _x_1))\l              (List.hd _x_2))\l             (List.hd _x_3))\l            (List.hd _x_4))\l           (List.hd _x_5))\l          (List.hd _x_6))\l         (List.tl _x_6)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_11 -&gt; p_10 [label=&quot;&quot;];
p_10 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         List.fold_left good_update\l         (good_update (good_update (good_update  ) (List.hd _x_0))\l          (List.hd _x_1))\l         (List.tl _x_1)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_10 -&gt; p_9 [label=&quot;&quot;];
p_9 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.tl\l           (List.tl\l            (List.tl\l             (List.fold_left good_update\l              \{status = ; callIncomingFrom = ; peopleInCall = \} _x_0).peopleInCall))))],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_9 -&gt; p_8 [label=&quot;&quot;];
p_8 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         List.fold_left good_update\l         (good_update\l          (good_update (good_update (good_update  ) (List.hd _x_0))\l           (List.hd _x_1))\l          (List.hd _x_2))\l         (List.tl _x_2)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_8 -&gt; p_7 [label=&quot;&quot;];
p_7 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update (good_update (good_update  ) (List.hd _x_0))\l            (List.hd _x_1))\l           (List.hd _x_2))\l          (List.hd _x_3))\l         (List.tl _x_3)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_7 -&gt; p_6 [label=&quot;&quot;];
p_6 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         let (_x_4 : action_v2 list) = List.tl _x_3 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update (good_update (good_update  ) (List.hd _x_0))\l             (List.hd _x_1))\l            (List.hd _x_2))\l           (List.hd _x_3))\l          (List.hd _x_4))\l         (List.tl _x_4)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_6 -&gt; p_5 [label=&quot;&quot;];
p_5 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         let (_x_4 : action_v2 list) = List.tl _x_3 in\l         let (_x_5 : action_v2 list) = List.tl _x_4 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             (good_update (good_update (good_update  ) (List.hd _x_0))\l              (List.hd _x_1))\l             (List.hd _x_2))\l            (List.hd _x_3))\l           (List.hd _x_4))\l          (List.hd _x_5))\l         (List.tl _x_5)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_5 -&gt; p_4 [label=&quot;&quot;];
p_4 [label=&quot;Unroll ([List.length\l         (List.tl\l          (List.tl\l           (List.tl\l            (List.tl\l             (List.tl\l              (List.fold_left good_update\l               \{status = ; callIncomingFrom = ; peopleInCall = \}\l               _x_0).peopleInCall)))))],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_4 -&gt; p_3 [label=&quot;&quot;];
p_3 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         let (_x_4 : action_v2 list) = List.tl _x_3 in\l         let (_x_5 : action_v2 list) = List.tl _x_4 in\l         let (_x_6 : action_v2 list) = List.tl _x_5 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             (good_update\l              (good_update (good_update (good_update  ) (List.hd _x_0))\l               (List.hd _x_1))\l              (List.hd _x_2))\l             (List.hd _x_3))\l            (List.hd _x_4))\l           (List.hd _x_5))\l          (List.hd _x_6))\l         (List.tl _x_6)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_3 -&gt; p_2 [label=&quot;&quot;];
p_2 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl (List.tl (List.tl (List.tl (List.tl _x_0))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         let (_x_3 : action_v2 list) = List.tl _x_2 in\l         let (_x_4 : action_v2 list) = List.tl _x_3 in\l         let (_x_5 : action_v2 list) = List.tl _x_4 in\l         let (_x_6 : action_v2 list) = List.tl _x_5 in\l         let (_x_7 : action_v2 list) = List.tl _x_6 in\l         List.fold_left good_update\l         (good_update\l          (good_update\l           (good_update\l            (good_update\l             (good_update\l              (good_update\l               (good_update\l                (good_update (good_update  ) (List.hd _x_0))\l                (List.hd _x_1))\l               (List.hd _x_2))\l              (List.hd _x_3))\l             (List.hd _x_4))\l            (List.hd _x_5))\l           (List.hd _x_6))\l          (List.hd _x_7))\l         (List.tl _x_7)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_2 -&gt; p_1 [label=&quot;&quot;];
p_1 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl\l                 (List.tl\l                  (List.tl\l                   (List.tl\l                    (List.tl\l                     (List.tl\l                      (List.tl\l                       (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         List.fold_left good_update\l         (good_update (good_update (good_update  ) (List.hd _x_0))\l          (List.hd _x_1))\l         (List.tl _x_1)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_1 -&gt; p_0 [label=&quot;&quot;];
p_0 [label=&quot;Unroll ([let (_x_0 : action_v2 list)\l             = List.tl\l               (List.tl\l                (List.tl\l                 (List.tl\l                  (List.tl\l                   (List.tl\l                    (List.tl\l                     (List.tl\l                      (List.tl\l                       (List.tl (List.tl (List.tl (List.tl (List.tl _x_0)))))))))))))\l         in\l         let (_x_1 : action_v2 list) = List.tl _x_0 in\l         let (_x_2 : action_v2 list) = List.tl _x_1 in\l         List.fold_left good_update\l         (good_update\l          (good_update (good_update (good_update  ) (List.hd _x_0))\l           (List.hd _x_1))\l          (List.hd _x_2))\l         (List.tl _x_2)],\l        [[]])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-7b83bc74-2662-4faf-be1b-60db4f80447f';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-9721a27d-9e00-44f6-828e-b4cd37799c78';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-33f7e658-4475-427e-a01b-5f6bb4127fa9';
  fold.hydrate(target);
});
</script></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-2e1abe5c-c842-45f9-b90f-fec5bd3c2426';
  alternatives.hydrate(target);
});
</script></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Imandra's standard unrolling verification method can't find any issues up to our fairly high bound of 50 here. Although it hasn't totally proved things for us, this is a good indicator that we're on the right lines as it can't find any counterexamples. It's pretty hard for us to prove things completely in this case using this method, due to the nature of our property - as the list of actions is arbitrary and our state machine contains cycles, there are valid sequences of actions that are infinite, for example <code>[CallIncoming(1), CallAccepted, EndCall, CallIncoming(1), CallAccepted, EndCall, ...]</code>.</p>
<p>If we want to increase our level of confidence even further, we can spend a bit longer to get a complete proof. In this case we can try Imandra's <code>[@auto]</code> method, which performs a proof by induction for all possible inputs:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-39" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="ow">[</span><span class="o">@</span><span class="n">auto</span><span class="ow">]</span> <span class="n">verify</span> <span class="n">call_with_people_in_is_active_property</span><span class="ow">(</span><span class="n">good_update</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">);</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[20]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>File &#34;jupyter cell 20&#34;, line 1, characters 15-81:
1 | [@auto] verify call_with_people_in_is_active_property(good_update, initial_state);
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Warning 5: this function application is partial,
maybe some arguments are missing.
- : action_v2 list -&gt; bool = &lt;fun&gt;
<span class="ansi-white-intense-fg ansi-bold">Goal</span>:

call_with_people_in_is_active_property good_update initial_state _x_0.

1 nontautological subgoal.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1</span>:

|---------------------------------------------------------------------------
 C0. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).status
     = CallActive
 C1. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).peopleInCall
     &lt;= 0


Must try induction.

We shall induct according to a scheme derived from <span class="ansi-blue-intense-fg ansi-bold">List.fold_left</span>.

<span class="ansi-cyan-intense-fg ansi-bold">Induction scheme</span>:

 (Is_a([], _x_0) ==&gt;  _x_0)
 &amp;&amp; (not Is_a([], _x_0) &amp;&amp;  (List.tl _x_0) ==&gt;  _x_0).

2 nontautological subgoals.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.2</span>:

 H0. Is_a([], _x_0)
|---------------------------------------------------------------------------
 C0. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).status
     = CallActive
 C1. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).peopleInCall
     &lt;= 0

But simplification reduces this to true, using the definitions of
<span class="ansi-blue-intense-fg ansi-bold">List.fold_left </span>and<span class="ansi-blue-intense-fg ansi-bold"> List.length</span>.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1</span>:

 H0. not Is_a([], _x_0)
 H1. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_0)).status
     = CallActive
     || List.length
        (List.fold_left good_update
         {status = Idle; callIncomingFrom = None; peopleInCall = []}
         (List.tl _x_0)).peopleInCall
        &lt;= 0
|---------------------------------------------------------------------------
 C0. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).status
     = CallActive
 C1. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).peopleInCall
     &lt;= 0

This simplifies, using the forward-chaining rule <span class="ansi-yellow-intense-fg ansi-bold">List.len_nonnegative</span> to the
following 2 subgoals:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2</span>:

 H0. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_0)).peopleInCall
     &lt;= 0
|---------------------------------------------------------------------------
 C0. Is_a([], _x_0)
 C1. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).peopleInCall
     &lt;= 0
 C3. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_0)).status
     = CallActive


We can eliminate destructors by the following
substitution:
 _x_0 -&gt; _x_01 :: _x_02

This produces the modified subgoal:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;</span>:

 H0. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_02).peopleInCall
     &lt;= 0
|---------------------------------------------------------------------------
 C0. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_02).status
     = CallActive
 C1. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (_x_01 :: _x_02)).peopleInCall
     &lt;= 0
 C2. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (_x_01 :: _x_02)).status
     = CallActive

This simplifies, using the definition of <span class="ansi-blue-intense-fg ansi-bold">List.fold_left</span> to:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;</span>:

 H0. Is_a(CallIncomingFrom, _x_01)
 H1. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_02).peopleInCall
     &lt;= 0
|---------------------------------------------------------------------------
 C0. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_02).status
     = CallActive
 C1. (List.fold_left good_update
      {status = CallIncoming;
       callIncomingFrom = Some (Destruct(CallIncomingFrom, 0, _x_01));
       peopleInCall = []}
      _x_02).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = CallIncoming;
       callIncomingFrom = Some (Destruct(CallIncomingFrom, 0, _x_01));
       peopleInCall = []}
      _x_02).peopleInCall
     &lt;= 0


Candidates for generalization:

 Some (Destruct(CallIncomingFrom, 0, _x_01))
 List.fold_left good_update
 {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_02

This produces the modified subgoal:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;</span>:

 H0. Is_a(CallIncomingFrom, _x_01)
 H1. List.length gen_2.peopleInCall &lt;= 0
|---------------------------------------------------------------------------
 C0. gen_2.status = CallActive
 C1. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).peopleInCall
     &lt;= 0


Candidates for generalization:

 List.fold_left good_update
 {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []} _x_02

However, we can refute the result of performing this generalization and thus
abandon it.

<span class="ansi-yellow-intense-fg ansi-bold">Hint:</span> It may be useful to examine the abandoned generalized formula, to help
you derive relevant generalization rules:

 H0. Is_a(CallIncomingFrom, _x_01)
 H1. List.length gen_2.peopleInCall &lt;= 0
<span class="ansi-white-fg">|---------------------------------------------------------------------------</span>
 C0. gen_2.status = CallActive
 C1. gen_3.status = CallActive
 C2. List.length gen_3.peopleInCall &lt;= 0

Must try induction.

We shall induct according to a scheme derived from <span class="ansi-blue-intense-fg ansi-bold">List.fold_left</span>.

<span class="ansi-cyan-intense-fg ansi-bold">Induction scheme</span>:

 (Is_a([], _x_02) ==&gt;  _x_01 _x_02 gen_1 gen_2)
 &amp;&amp; (not Is_a([], _x_02) &amp;&amp;  _x_01 (List.tl _x_02) gen_1 gen_2
     ==&gt;  _x_01 _x_02 gen_1 gen_2).

2 nontautological subgoals.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.2</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a([], _x_02)
 H2. Is_a(CallIncomingFrom, _x_01)
|---------------------------------------------------------------------------
 C0. gen_2.status = CallActive
 C1. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).peopleInCall
     &lt;= 0
 C2. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).status
     = CallActive

But simplification reduces this to true, using the definitions of
<span class="ansi-blue-intense-fg ansi-bold">List.fold_left </span>and<span class="ansi-blue-intense-fg ansi-bold"> List.length</span>.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1</span>:

 H0. not Is_a([], _x_02)
 H1. (((not (List.length gen_2.peopleInCall &lt;= 0)
        || gen_2.status = CallActive)
       || List.length
          (List.fold_left good_update
           {status = CallIncoming; callIncomingFrom = gen_1;
            peopleInCall = []}
           (List.tl _x_02)).peopleInCall
          &lt;= 0)
      || (List.fold_left good_update
          {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
          (List.tl _x_02)).status
         = CallActive)
     || not Is_a(CallIncomingFrom, _x_01)
 H2. List.length gen_2.peopleInCall &lt;= 0
 H3. Is_a(CallIncomingFrom, _x_01)
|---------------------------------------------------------------------------
 C0. gen_2.status = CallActive
 C1. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).peopleInCall
     &lt;= 0
 C2. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).status
     = CallActive

This simplifies, using the forward-chaining rule <span class="ansi-yellow-intense-fg ansi-bold">List.len_nonnegative</span> to the
following 2 subgoals:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2</span>:

 H0. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (List.tl _x_02)).status
     = CallActive
 H1. List.length gen_2.peopleInCall &lt;= 0
 H2. Is_a(CallIncomingFrom, _x_01)
|---------------------------------------------------------------------------
 C0. Is_a([], _x_02)
 C1. gen_2.status = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (List.tl _x_02)).peopleInCall
     &lt;= 0
 C3. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).peopleInCall
     &lt;= 0
 C4. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).status
     = CallActive


We can eliminate destructors by the following
substitution:
 _x_02 -&gt; _x_021 :: _x_022

This produces the modified subgoal:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).status
     = CallActive
|---------------------------------------------------------------------------
 C0. gen_2.status = CallActive
 C1. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (_x_021 :: _x_022)).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (_x_021 :: _x_022)).peopleInCall
     &lt;= 0
 C3. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).peopleInCall
     &lt;= 0

This simplifies, using the definition of <span class="ansi-blue-intense-fg ansi-bold">List.fold_left</span> to the following 2
subgoals:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).status
     = CallActive
|---------------------------------------------------------------------------
 C0. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).peopleInCall
     &lt;= 0
 C1. gen_2.status = CallActive
 C2. Is_a(CallAccepted, _x_021)
 C3. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).status
     = CallActive
 C4. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).peopleInCall
     &lt;= 0

This simplifies, using the forward-chaining rule <span class="ansi-yellow-intense-fg ansi-bold">List.len_nonnegative</span> to:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2&#39;</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).status
     = CallActive
|---------------------------------------------------------------------------
 C0. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).peopleInCall
     &lt;= 0
 C1. gen_2.status = CallActive
 C2. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).status
     = CallActive
 C3. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).peopleInCall
     &lt;= 0


Candidates for generalization:

 List.fold_left good_update
 {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []} _x_022
 List.fold_left good_update
 {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022

However, we can refute the result of performing this generalization and thus
abandon it.

<span class="ansi-yellow-intense-fg ansi-bold">Hint:</span> It may be useful to examine the abandoned generalized formula, to help
you derive relevant generalization rules:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. gen_1.status = CallActive
<span class="ansi-white-fg">|---------------------------------------------------------------------------</span>
 C0. List.length gen_2.peopleInCall &lt;= 0
 C1. gen_2.status = CallActive
 C2. gen_2.status = CallActive
 C3. List.length gen_1.peopleInCall &lt;= 0

Must try induction.

The recursive terms in the conjecture suggest 2 inductions.
Subsumption and merging reduces this to 1.

We shall induct according to a scheme derived from <span class="ansi-blue-intense-fg ansi-bold">List.fold_left</span>.

<span class="ansi-cyan-intense-fg ansi-bold">Induction scheme</span>:

 (Is_a([], _x_022) ==&gt;  _x_01 _x_021 _x_022 gen_1 gen_2)
 &amp;&amp; (not Is_a([], _x_022) &amp;&amp;  _x_01 _x_021 (List.tl _x_022) gen_1 gen_2
     ==&gt;  _x_01 _x_021 _x_022 gen_1 gen_2).

2 nontautological subgoals.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2&#39;.2</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).status
     = CallActive
 H4. Is_a([], _x_022)
|---------------------------------------------------------------------------
 C0. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).peopleInCall
     &lt;= 0
 C1. gen_2.status = CallActive
 C2. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).status
     = CallActive
 C3. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).peopleInCall
     &lt;= 0

But simplification reduces this to true, using the definitions of
<span class="ansi-blue-intense-fg ansi-bold">List.fold_left </span>and<span class="ansi-blue-intense-fg ansi-bold"> List.length</span>.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2&#39;.1</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).status
     = CallActive
 H4. not Is_a([], _x_022)
 H5. ((((((not (List.length gen_2.peopleInCall &lt;= 0)
           || not Is_a(CallIncomingFrom, _x_01))
          || not Is_a(CallRejected, _x_021))
         || gen_2.status = CallActive)
        || not
           ((List.fold_left good_update
             {status = CallIncoming; callIncomingFrom = gen_1;
              peopleInCall = []}
             (List.tl _x_022)).status
            = CallActive))
       || List.length
          (List.fold_left good_update
           {status = Idle; callIncomingFrom = None; peopleInCall = []}
           (List.tl _x_022)).peopleInCall
          &lt;= 0)
      || (List.fold_left good_update
          {status = Idle; callIncomingFrom = None; peopleInCall = []}
          (List.tl _x_022)).status
         = CallActive)
     || List.length
        (List.fold_left good_update
         {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
         (List.tl _x_022)).peopleInCall
        &lt;= 0
|---------------------------------------------------------------------------
 C0. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).peopleInCall
     &lt;= 0
 C1. gen_2.status = CallActive
 C2. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).status
     = CallActive
 C3. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).peopleInCall
     &lt;= 0

This simplifies, using the forward-chaining rule <span class="ansi-yellow-intense-fg ansi-bold">List.len_nonnegative</span> to the
following 4 subgoals:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2&#39;.1.4</span>:

 H0. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (List.tl _x_022)).peopleInCall
     &lt;= 0
 H1. List.length gen_2.peopleInCall &lt;= 0
 H2. Is_a(CallIncomingFrom, _x_01)
 H3. Is_a(CallRejected, _x_021)
 H4. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).status
     = CallActive
 H5. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (List.tl _x_022)).status
     = CallActive
|---------------------------------------------------------------------------
 C0. Is_a([], _x_022)
 C1. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).peopleInCall
     &lt;= 0
 C2. gen_2.status = CallActive
 C3. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).status
     = CallActive
 C4. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).peopleInCall
     &lt;= 0
 C5. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_022)).peopleInCall
     &lt;= 0
 C6. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_022)).status
     = CallActive


We can eliminate destructors by the following
substitution:
 _x_022 -&gt; _x_0221 :: _x_0222

This produces the modified subgoal:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2&#39;.1.4&#39;</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_0222).status
     = CallActive
 H4. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (_x_0221 :: _x_0222)).status
     = CallActive
 H5. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_0222).peopleInCall
     &lt;= 0
|---------------------------------------------------------------------------
 C0. gen_2.status = CallActive
 C1. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      (_x_0221 :: _x_0222)).peopleInCall
     &lt;= 0
 C2. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (_x_0221 :: _x_0222)).status
     = CallActive
 C3. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).status
     = CallActive
 C4. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).peopleInCall
     &lt;= 0
 C5. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (_x_0221 :: _x_0222)).peopleInCall
     &lt;= 0

This simplifies, using the definition of <span class="ansi-blue-intense-fg ansi-bold">List.fold_left</span> to:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2&#39;.1.4&#39;&#39;</span>:

 H0. Is_a(Some, gen_1)
 H1. List.length gen_2.peopleInCall &lt;= 0
 H2. Is_a(CallIncomingFrom, _x_01)
 H3. Is_a(CallRejected, _x_021)
 H4. (List.fold_left good_update
      {status = CallActive; callIncomingFrom = None;
       peopleInCall = [Option.get gen_1]}
      _x_0222).status
     = CallActive
 H5. Is_a(CallAccepted, _x_0221)
 H6. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_0222).status
     = CallActive
 H7. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_0222).peopleInCall
     &lt;= 0
|---------------------------------------------------------------------------
 C0. gen_2.status = CallActive
 C1. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).peopleInCall
     &lt;= 0
 C3. List.length
     (List.fold_left good_update
      {status = CallActive; callIncomingFrom = None;
       peopleInCall = [Option.get gen_1]}
      _x_0222).peopleInCall
     &lt;= 0


We can eliminate destructors by the following
substitution:
 gen_1 -&gt; Some gen_11

This produces the modified subgoal:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1.2&#39;&#39;&#39;.1.2&#39;.2&#39;.1.4&#39;&#39;&#39;</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. Is_a(CallAccepted, _x_0221)
 H4. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = Some gen_11;
       peopleInCall = []}
      _x_0222).peopleInCall
     &lt;= 0
 H5. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = Some gen_11;
       peopleInCall = []}
      _x_0222).status
     = CallActive
 H6. (List.fold_left good_update
      {status = CallActive; callIncomingFrom = None; peopleInCall = [gen_11]}
      _x_0222).status
     = CallActive
|---------------------------------------------------------------------------
 C0. gen_2.status = CallActive
 C1. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).peopleInCall
     &lt;= 0
 C3. List.length
     (List.fold_left good_update
      {status = CallActive; callIncomingFrom = None; peopleInCall = [gen_11]}
      _x_0222).peopleInCall
     &lt;= 0


Candidates for generalization:

 List.fold_left good_update
 {status = CallActive; callIncomingFrom = None; peopleInCall = [gen_11]}
 _x_0222
 List.fold_left good_update
 {status = CallIncoming; callIncomingFrom = Some gen_11; peopleInCall = []}
 _x_0222
 List.fold_left good_update
 {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222

However, we can refute the result of performing this generalization and thus
abandon it.

<span class="ansi-yellow-intense-fg ansi-bold">Hint:</span> It may be useful to examine the abandoned generalized formula, to help
you derive relevant generalization rules:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. Is_a(CallAccepted, _x_0221)
 H4. List.length gen_2.peopleInCall &lt;= 0
 H5. gen_2.status = CallActive
 H6. gen_1.status = CallActive
<span class="ansi-white-fg">|---------------------------------------------------------------------------</span>
 C0. gen_2.status = CallActive
 C1. gen_3.status = CallActive
 C2. List.length gen_3.peopleInCall &lt;= 0
 C3. List.length gen_1.peopleInCall &lt;= 0

Must try induction.

<span class="ansi-red-intense-fg ansi-bold">  </span> Aborting proof attempt for <span class="ansi-white-intense-fg ansi-bold">_verify_target</span>.

<span class="ansi-cyan-intense-fg ansi-bold">  </span> Rules:
    (:def List.fold_left)
    (:def List.length)
    (:fc List.len_nonnegative)
    (:induct List.fold_left)

<span class="ansi-cyan-intense-fg ansi-bold">Checkpoints</span>:

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. Is_a(CallAccepted, _x_0221)
 H4. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = Some gen_11;
       peopleInCall = []}
      _x_0222).peopleInCall
     &lt;= 0
 H5. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = Some gen_11;
       peopleInCall = []}
      _x_0222).status
     = CallActive
 H6. (List.fold_left good_update
      {status = CallActive; callIncomingFrom = None; peopleInCall = [gen_11]}
      _x_0222).status
     = CallActive
<span class="ansi-white-fg">|---------------------------------------------------------------------------</span>
 C0. gen_2.status = CallActive
 C1. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0222).peopleInCall
     &lt;= 0
 C3. List.length
     (List.fold_left good_update
      {status = CallActive; callIncomingFrom = None; peopleInCall = [gen_11]}
      _x_0222).peopleInCall
     &lt;= 0

 H0. List.length gen_2.peopleInCall &lt;= 0
 H1. Is_a(CallIncomingFrom, _x_01)
 H2. Is_a(CallRejected, _x_021)
 H3. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).status
     = CallActive
<span class="ansi-white-fg">|---------------------------------------------------------------------------</span>
 C0. List.length
     (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).peopleInCall
     &lt;= 0
 C1. gen_2.status = CallActive
 C2. (List.fold_left good_update
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_022).status
     = CallActive
 C3. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_022).peopleInCall
     &lt;= 0

 H0. Is_a(CallIncomingFrom, _x_01)
 H1. List.length gen_2.peopleInCall &lt;= 0
<span class="ansi-white-fg">|---------------------------------------------------------------------------</span>
 C0. gen_2.status = CallActive
 C1. (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).status
     = CallActive
 C2. List.length
     (List.fold_left good_update
      {status = CallIncoming; callIncomingFrom = gen_1; peopleInCall = []}
      _x_02).peopleInCall
     &lt;= 0

module CX : sig val _x_01 : action_v2 val gen_2 : state val gen_3 : state end
module CX :
  sig
    val _x_01 : action_v2
    val _x_021 : action_v2
    val gen_1 : state
    val gen_2 : state
  end
module CX :
  sig
    val _x_01 : action_v2
    val _x_021 : action_v2
    val _x_0221 : action_v2
    val gen_1 : state
    val gen_2 : state
    val gen_3 : state
  end
<span class="ansi-red-intense-fg ansi-bold">Error</span>[/server]: Maximum induction depth reached (3). You can set this with #max_induct.
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We run into a limit here due to our use of <code>fold_left</code>. A common trick when using induction is to switch to using <code>fold_right</code> instead, which is easier to induct on (this also means the actions list is 'reduced' in reverse order, but that doesn't make a difference here):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-41" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="k">let</span> <span class="n">call_with_people_in_is_active_property_fold_right</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">update_fn</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">,</span> <span class="n">actions</span> <span class="ow">:</span> <span class="kt">list</span><span class="ow">(</span><span class="k">&#39;</span><span class="n">a</span><span class="ow">))</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">let</span> <span class="n">final_state</span> <span class="ow">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_right</span><span class="ow">((</span><span class="n">a</span><span class="ow">,</span> <span class="n">b</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="n">update_fn</span><span class="ow">(</span><span class="n">b</span><span class="ow">,</span> <span class="n">a</span><span class="ow">),</span> <span class="ow">~</span><span class="n">base</span><span class="ow">=</span><span class="n">initial_state</span><span class="ow">,</span> <span class="n">actions</span><span class="ow">);</span>
  <span class="k">if</span> <span class="ow">(</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span><span class="ow">(</span><span class="n">final_state</span><span class="ow">.</span><span class="n">peopleInCall</span><span class="ow">)</span> <span class="ow">&gt;</span> <span class="mi">0</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="n">final_state</span><span class="ow">.</span><span class="n">status</span> <span class="ow">==</span> <span class="nc">CallActive</span><span class="ow">;</span>
  <span class="ow">}</span> <span class="k">else</span> <span class="ow">{</span>
    <span class="bp">true</span><span class="ow">;</span>
  <span class="ow">};</span>
<span class="ow">};</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[21]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val call_with_people_in_is_active_property_fold_right :
  (state -&gt; &#39;a -&gt; state) -&gt; state -&gt; &#39;a list -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Exploring%20the%20FaceTime%20Bug%20With%20ReasonML%20State%20Machines.ipynb%23try-cell-42" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-reasonml"><pre><span></span><span class="ow">[</span><span class="o">@</span><span class="n">auto</span><span class="ow">]</span> <span class="n">verify</span><span class="ow">(</span><span class="n">call_with_people_in_is_active_property_fold_right</span><span class="ow">(</span><span class="n">good_update</span><span class="ow">,</span> <span class="n">initial_state</span><span class="ow">));</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[22]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>File &#34;jupyter cell 22&#34;, line 1, characters 14-93:
1 | [@auto] verify(call_with_people_in_is_active_property_fold_right(good_update, initial_state));
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Warning 5: this function application is partial,
maybe some arguments are missing.
- : action_v2 list -&gt; bool = &lt;fun&gt;
<span class="ansi-white-intense-fg ansi-bold">Goal</span>:

call_with_people_in_is_active_property_fold_right good_update initial_state
_x_0.

1 nontautological subgoal.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1</span>:

|---------------------------------------------------------------------------
 C0. (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).status
     = CallActive
 C1. List.length
     (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).peopleInCall
     &lt;= 0


Must try induction.

We shall induct according to a scheme derived from <span class="ansi-blue-intense-fg ansi-bold">List.fold_right</span>.

<span class="ansi-cyan-intense-fg ansi-bold">Induction scheme</span>:

 (Is_a([], _x_0) ==&gt;  _x_0)
 &amp;&amp; (not Is_a([], _x_0) &amp;&amp;  (List.tl _x_0) ==&gt;  _x_0).

2 nontautological subgoals.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.2</span>:

 H0. Is_a([], _x_0)
|---------------------------------------------------------------------------
 C0. (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).status
     = CallActive
 C1. List.length
     (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).peopleInCall
     &lt;= 0

But simplification reduces this to true, using the definitions of
<span class="ansi-blue-intense-fg ansi-bold">List.fold_right </span>and<span class="ansi-blue-intense-fg ansi-bold"> List.length</span>.

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1</span>:

 H0. not Is_a([], _x_0)
 H1. (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_0)).status
     = CallActive
     || List.length
        (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
         {status = Idle; callIncomingFrom = None; peopleInCall = []}
         (List.tl _x_0)).peopleInCall
        &lt;= 0
|---------------------------------------------------------------------------
 C0. (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).status
     = CallActive
 C1. List.length
     (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0).peopleInCall
     &lt;= 0

This simplifies, using the definition of <span class="ansi-blue-intense-fg ansi-bold">List.fold_right</span> to:

<span class="ansi-white-intense-fg ansi-bold">Subgoal 1.1&#39;</span>:

 H0. Is_a(CallActive,
     (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_0)).status)
 H1. Is_a(EndCall, List.hd _x_0)
|---------------------------------------------------------------------------
 C0. Is_a([], _x_0)
 C1. Is_a(Idle,
     (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []}
      (List.tl _x_0)).status)
 C2. List.length [] &lt;= 0

But simplification reduces this to true, using the definition of <span class="ansi-blue-intense-fg ansi-bold">List.length</span>.

<span class="ansi-cyan-intense-fg ansi-bold">  </span> Rules:
    (:def List.fold_right)
    (:def List.length)
    (:fc List.len_nonnegative)
    (:induct List.fold_right)

</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><div style="font-size: 1.2em; padding: 0.5em; border-top: 1px solid green; border-bottom: 1px solid green"><i class="fa fa-check-circle" style="margin-right: 0.5em; color: green"></i><span>Proved</span></div><div><div class="imandra-proof-top"><div class="imandra-fold panel panel-default" id="fold-832c99b7-ca07-4980-99bf-f29b33c60085"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>proof</span></div></div><div class="panel-body collapse"><div class="imandra-proof"><div class="imandra-alternatives" id="alt-51264dca-110e-47f8-87d3-d0d1f7847086"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>summary</a></li><li class="" data-toggle="tab"><a>full</a></li><li class="" data-toggle="tab"><a>graph</a></li></ul><div class="tab-content"><div class="tab-pane active"><div class="imandra-table" id="table-4a0714c3-265a-47b7-8156-b7b976d03d62"><table><tr><td><b>ground_instances</b></td><td>0</td></tr><tr><td><b>definitions</b></td><td>13</td></tr><tr><td><b>inductions</b></td><td>1</td></tr><tr><td><b>search_time</b></td><td><pre>1.246s</pre></td></tr></table></div></div><div class="tab-pane"><div class="imandra-fold panel panel-default" id="fold-df7e5140-3258-4503-855d-b3775afb9cf1"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>Expand</span></div></div><div class="panel-body collapse"><ul><li><pre>start[1.246s, &quot;Goal&quot;]
  let (_x_0 : state)
      = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
        {status = Idle; callIncomingFrom = None; peopleInCall = []}
        ( :var_0: )
  in
  if List.length _x_0.peopleInCall &gt; 0 then _x_0.status = CallActive
  else true</pre></li><li><div><h4>subproof</h4><div class="imandra-fold panel panel-default" id="fold-0cb8ea51-fced-4290-a8b3-66c38141fcfa"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>let (_x_0 : state)
    = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0
in _x_0.status = CallActive || List.length _x_0.peopleInCall &lt;= 0</span></div></div><div class="panel-body collapse"><ul><li><pre>start[1.246s, &quot;1&quot;]
  let (_x_0 : state)
      = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
        {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0
  in _x_0.status = CallActive || List.length _x_0.peopleInCall &lt;= 0</pre></li><li><pre>induction on (functional )
:scheme (Is_a([], _x_0) ==&gt;  _x_0)
        &amp;&amp; (not Is_a([], _x_0) &amp;&amp;  (List.tl _x_0) ==&gt;  _x_0)</pre></li><li><div><pre>Split (let (_x_0 : state)
           = {status = Idle; callIncomingFrom = None; peopleInCall = []}
       in
       let (_x_1 : state)
           = List.fold_right
             ((fun update_fn a b -&gt; update_fn b a) good_update) _x_0 _x_0
       in
       let (_x_2 : bool)
           = _x_1.status = CallActive || List.length _x_1.peopleInCall &lt;= 0
       in
       let (_x_3 : bool) = not Is_a([], _x_0) in
       let (_x_4 : state)
           = List.fold_right
             ((fun update_fn a b -&gt; update_fn b a) good_update) _x_0
             (List.tl _x_0)
       in
       (_x_2 || _x_3)
       &amp;&amp; (_x_2
           || not
              (_x_3
               &amp;&amp; (_x_4.status = CallActive
                   || List.length _x_4.peopleInCall &lt;= 0)))
       :cases [let (_x_0 : state)
                   = List.fold_right
                     ((fun update_fn a b -&gt; update_fn b a) good_update)
                     {status = Idle; callIncomingFrom = None;
                      peopleInCall = []}
                     _x_0
               in
               (not Is_a([], _x_0) || _x_0.status = CallActive)
               || List.length _x_0.peopleInCall &lt;= 0;
               let (_x_0 : state)
                   = {status = Idle; callIncomingFrom = None;
                      peopleInCall = []}
               in
               let (_x_1 : state)
                   = List.fold_right
                     ((fun update_fn a b -&gt; update_fn b a) good_update) _x_0
                     (List.tl _x_0)
               in
               let (_x_2 : state)
                   = List.fold_right
                     ((fun update_fn a b -&gt; update_fn b a) good_update) _x_0
                     _x_0
               in
               ((Is_a([], _x_0)
                 || not
                    (_x_1.status = CallActive
                     || List.length _x_1.peopleInCall &lt;= 0))
                || _x_2.status = CallActive)
               || List.length _x_2.peopleInCall &lt;= 0])</pre><ul><li><div><h5>subproof</h5><div class="imandra-fold panel panel-default" id="fold-b8b3f162-7eed-4b5f-9eb5-72551570fd84"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>let (_x_0 : state)
    = {status = Idle; callIncomingFrom = None; peopleInCall = []}
in
let (_x_1 : state)
    = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update) _x_0
      (List.tl _x_0)
in
let (_x_2 : state)
    = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update) _x_0
      _x_0
in
((Is_a([], _x_0)
  || not (_x_1.status = CallActive || List.length _x_1.peopleInCall &lt;= 0))
 || _x_2.status = CallActive)
|| List.length _x_2.peopleInCall &lt;= 0</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.914s, &quot;1.1&quot;]
  let (_x_0 : state)
      = {status = Idle; callIncomingFrom = None; peopleInCall = []}
  in
  let (_x_1 : state)
      = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
        _x_0 (List.tl _x_0)
  in
  let (_x_2 : state)
      = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
        _x_0 _x_0
  in
  ((Is_a([], _x_0)
    || not (_x_1.status = CallActive || List.length _x_1.peopleInCall &lt;= 0))
   || _x_2.status = CallActive)
  || List.length _x_2.peopleInCall &lt;= 0</pre></li><li><div><h6>simplify</h6><div class="imandra-table" id="table-bd635ade-b916-4ce7-bb6c-b5e9e11dd51b"><table><tr><td><b>into</b></td><td><pre>let (_x_0 : status)
    = (List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
       {status = Idle; callIncomingFrom = None; peopleInCall = []}
       (List.tl _x_0)).status
in
(((Is_a([], _x_0) || Is_a(Idle, _x_0)) || not Is_a(CallActive, _x_0))
 || not Is_a(EndCall, List.hd _x_0))
|| List.length [] &lt;= 0</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[List.fold_right, List.fold_right, List.fold_right, List.fold_right,
 List.fold_right, List.fold_right, List.fold_right, List.fold_right,
 List.fold_right, List.fold_right]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><ul><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li><li><pre>List.len_nonnegative</pre></li></ul></td></tr></table></div></div></li><li><div><h6>simplify</h6><div class="imandra-table" id="table-cfadd583-7d0c-4fdf-ac51-39919b469310"><table><tr><td><b>into</b></td><td><pre>true</pre></td></tr><tr><td><b>expansions</b></td><td><pre>List.length</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><pre>List.len_nonnegative</pre></td></tr></table></div></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-b8b3f162-7eed-4b5f-9eb5-72551570fd84';
  fold.hydrate(target);
});
</script></div></div></li><li><div><h5>subproof</h5><div class="imandra-fold panel panel-default" id="fold-9a8f7f7d-b418-426c-bc6a-c4823982bf08"><div class="panel-heading"><div><i class="fa fa-chevron-down hidden"></i><i class="fa fa-chevron-right"></i><span>let (_x_0 : state)
    = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
      {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0
in
(not Is_a([], _x_0) || _x_0.status = CallActive)
|| List.length _x_0.peopleInCall &lt;= 0</span></div></div><div class="panel-body collapse"><ul><li><pre>start[0.914s, &quot;1.2&quot;]
  let (_x_0 : state)
      = List.fold_right ((fun update_fn a b -&gt; update_fn b a) good_update)
        {status = Idle; callIncomingFrom = None; peopleInCall = []} _x_0
  in
  (not Is_a([], _x_0) || _x_0.status = CallActive)
  || List.length _x_0.peopleInCall &lt;= 0</pre></li><li><div><h6>simplify</h6><div class="imandra-table" id="table-4c90f5c6-1b5e-4813-87df-e6c8f27feaae"><table><tr><td><b>into</b></td><td><pre>true</pre></td></tr><tr><td><b>expansions</b></td><td><pre>[List.length, List.fold_right]</pre></td></tr><tr><td><b>rewrite_steps</b></td><td><ul></ul></td></tr><tr><td><b>forward_chaining</b></td><td><pre>List.len_nonnegative</pre></td></tr></table></div></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-9a8f7f7d-b418-426c-bc6a-c4823982bf08';
  fold.hydrate(target);
});
</script></div></div></li></ul></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-0cb8ea51-fced-4290-a8b3-66c38141fcfa';
  fold.hydrate(target);
});
</script></div></div></li></ul></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-df7e5140-3258-4503-855d-b3775afb9cf1';
  fold.hydrate(target);
});
</script></div></div><div class="tab-pane"><div class="imandra-graphviz" id="graphviz-e9e8f539-decb-463d-82d2-d81a45a8f610"><textarea style="display: none">digraph &quot;proof&quot; {
p_170 [label=&quot;Start (let (_x_0 : state)\l           = List.fold_right\l             ((fun update_fn a b -\&gt; update_fn b a) good_update)\l             \{status = Idle; callIncomingFrom = None; peopleInCall = []\}\l             ( :var_0: )\l       in\l       if List.length _x_0.peopleInCall \&gt; 0 then _x_0.status = CallActive\l       else true :name \&quot;Goal\&quot; :time 1.246s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_170 -&gt; p_168 [label=&quot;&quot;];
subgraph cluster_169 {
  color=blue;
p_168 [label=&quot;Start (let (_x_0 : state)\l           = List.fold_right\l             ((fun update_fn a b -\&gt; update_fn b a) good_update)\l             \{status = Idle; callIncomingFrom = None; peopleInCall = []\} _x_0\l       in _x_0.status = CallActive \|\| List.length _x_0.peopleInCall \&lt;= 0\l       :name \&quot;1\&quot; :time 1.246s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_168 -&gt; p_167 [label=&quot;&quot;];
p_167 [label=&quot;Induct ((functional ),\l        :scheme (Is_a([], _x_0) ==\&gt;  _x_0)\l                &amp;&amp; (not Is_a([], _x_0) &amp;&amp;  (List.tl _x_0) ==\&gt;  _x_0))&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_167 -&gt; p_166 [label=&quot;&quot;];
p_166 [label=&quot;Split (let (_x_0 : state)\l           = \{status = Idle; callIncomingFrom = None; peopleInCall = []\}\l       in\l       let (_x_1 : state)\l           = List.fold_right\l             ((fun update_fn a b -\&gt; update_fn b a) good_update) _x_0 _x_0\l       in\l       let (_x_2 : bool)\l           = _x_1.status = CallActive \|\| List.length _x_1.peopleInCall \&lt;= 0\l       in\l       let (_x_3 : bool) = not Is_a([], _x_0) in\l       let (_x_4 : state)\l           = List.fold_right\l             ((fun update_fn a b -\&gt; update_fn b a) good_update) _x_0\l             (List.tl _x_0)\l       in\l       (_x_2 \|\| _x_3)\l       &amp;&amp; (_x_2\l           \|\| not\l              (_x_3\l               &amp;&amp; (_x_4.status = CallActive\l                   \|\| List.length _x_4.peopleInCall \&lt;= 0)))\l       :cases [let (_x_0 : state)\l                   = List.fold_right\l                     ((fun update_fn a b -\&gt; update_fn b a) good_update)\l                     \{status = Idle; callIncomingFrom = None;\l                      peopleInCall = []\}\l                     _x_0\l               in\l               (not Is_a([], _x_0) \|\| _x_0.status = CallActive)\l               \|\| List.length _x_0.peopleInCall \&lt;= 0;\l               let (_x_0 : state)\l                   = \{status = Idle; callIncomingFrom = None;\l                      peopleInCall = []\}\l               in\l               let (_x_1 : state)\l                   = List.fold_right\l                     ((fun update_fn a b -\&gt; update_fn b a) good_update) _x_0\l                     (List.tl _x_0)\l               in\l               let (_x_2 : state)\l                   = List.fold_right\l                     ((fun update_fn a b -\&gt; update_fn b a) good_update) _x_0\l                     _x_0\l               in\l               ((Is_a([], _x_0)\l                 \|\| not\l                    (_x_1.status = CallActive\l                     \|\| List.length _x_1.peopleInCall \&lt;= 0))\l                \|\| _x_2.status = CallActive)\l               \|\| List.length _x_2.peopleInCall \&lt;= 0])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_166 -&gt; p_161 [label=&quot;&quot;];
subgraph cluster_162 {
  color=blue;
p_161 [label=&quot;Start (let (_x_0 : state)\l           = \{status = Idle; callIncomingFrom = None; peopleInCall = []\}\l       in\l       let (_x_1 : state)\l           = List.fold_right\l             ((fun update_fn a b -\&gt; update_fn b a) good_update) _x_0\l             (List.tl _x_0)\l       in\l       let (_x_2 : state)\l           = List.fold_right\l             ((fun update_fn a b -\&gt; update_fn b a) good_update) _x_0 _x_0\l       in\l       ((Is_a([], _x_0)\l         \|\| not\l            (_x_1.status = CallActive \|\| List.length _x_1.peopleInCall \&lt;= 0))\l        \|\| _x_2.status = CallActive)\l       \|\| List.length _x_2.peopleInCall \&lt;= 0 :name \&quot;1.1\&quot; :time 0.914s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_161 -&gt; p_160 [label=&quot;&quot;];
p_160 [label=&quot;Simplify (let (_x_0 : status)\l              = (List.fold_right\l                 ((fun update_fn a b -\&gt; update_fn b a) good_update)\l                 \{status = Idle; callIncomingFrom = None; peopleInCall = []\}\l                 (List.tl _x_0)).status\l          in\l          (((Is_a([], _x_0) \|\| Is_a(Idle, _x_0))\l            \|\| not Is_a(CallActive, _x_0))\l           \|\| not Is_a(EndCall, List.hd _x_0))\l          \|\| List.length [] \&lt;= 0\l          :expansions [List.fold_right;\l                       List.fold_right;\l                       List.fold_right;\l                       List.fold_right;\l                       List.fold_right;\l                       List.fold_right;\l                       List.fold_right;\l                       List.fold_right;\l                       List.fold_right;\l                       List.fold_right]\l          :rw []\l          :fc [List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative;\l               List.len_nonnegative])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_160 -&gt; p_159 [label=&quot;&quot;];
p_159 [label=&quot;Simplify (true :expansions [List.length] :rw [] :fc [List.len_nonnegative])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
p_166 -&gt; p_164 [label=&quot;&quot;];
subgraph cluster_165 {
  color=blue;
p_164 [label=&quot;Start (let (_x_0 : state)\l           = List.fold_right\l             ((fun update_fn a b -\&gt; update_fn b a) good_update)\l             \{status = Idle; callIncomingFrom = None; peopleInCall = []\} _x_0\l       in\l       (not Is_a([], _x_0) \|\| _x_0.status = CallActive)\l       \|\| List.length _x_0.peopleInCall \&lt;= 0 :name \&quot;1.2\&quot; :time 0.914s)&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
p_164 -&gt; p_163 [label=&quot;&quot;];
p_163 [label=&quot;Simplify (true :expansions [List.length; List.fold_right] :rw []\l          :fc [List.len_nonnegative])&quot;,shape=box,style=filled,fontname=&quot;courier&quot;,fontsize=14];
}
}
}
</textarea><button class="btn btn-primary">Load graph</button><div class="imandra-graphviz-loading display-none">Loading..</div><div class="imandra-graphviz-target"></div><script>
require(['nbextensions/nbimandra/graphviz'], function (graphviz) {
  var target = '#graphviz-e9e8f539-decb-463d-82d2-d81a45a8f610';
  graphviz.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-51264dca-110e-47f8-87d3-d0d1f7847086';
  alternatives.hydrate(target);
});
</script></div></div></div><script>
require(['nbextensions/nbimandra/fold'], function (fold) {
  var target = '#fold-832c99b7-ca07-4980-99bf-f29b33c60085';
  fold.hydrate(target);
});
</script></div></div></div></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Fully proved! For larger functions going into Imandra's more advanced features will require more expertise, and may or may not be worth it over the guarantees that the basic unrolling method gives us. Whether the cost makes sense will depend on what you're working on.</p>
<p>One other improvement we could make is to incorporate the <code>update_outcome</code> concept from our ideal version, and check that the property holds for valid resulting states only. This would enable us to stop passing the concrete, valid <code>initial_state</code> in as an argument and allow Imandra to verify that this works for all possible <code>state</code> values in our property arguments, as the update function would handle filtering out invalid states for us. Analogously we can 'guard' our states with a separate <code>is_valid</code> function as part of the property. Have a go at doing this yourself in the notebook!</p>
<p>We've given you a quick taste of some new possibilities here, but the takeaway is that state machines are a useful tool - having a formalized way of thinking about a class of system makes life easier for both you <em>and</em> the computer, whether that's via pure human brain power, a type system or an automated reasoning tool like <a href="https://www.imandra.ai">Imandra</a>.</p>
</div>
</div>
</div>
                    </div>
                </article>
            </main>
            <footer class="footer">
                <a class="copyrights"href="http://imandra.ai">&#9400; 2018 - 2021 Imandra Inc. All rights reserved.</a>
            </footer>
        </div>
    



    <script>
    (function () {
            var lastId;
            var sideMenu = $("#side-nav-menu");
            var topMenu = $("#top-menu");
            var topMenuHeight = topMenu.outerHeight() + 15;

            // All list items
            var menuItems = sideMenu.find('a.side__nav-link--within-page');

            // Anchors corresponding to menu items
            var scrollItems = menuItems.map(function () {
              var item = $(this).attr("href");
              var thisItem = item.substring(item.lastIndexOf("#") + 1, item.length);
              var linkedItem = $('#' + CSS.escape(thisItem));
              if (linkedItem.length) { return linkedItem; }
            });

            // Bind to scroll
            $(window).scroll(function () {
                // Get container scroll position
                var fromTop = $(this).scrollTop() + topMenuHeight;;
                // Get id of current scroll item
                var cur = scrollItems.map(function () {
                    if ($(this).offset().top < fromTop)
                        return this;
                });
                cur = cur[cur.length - 1];
                // Get the id of the current element
                var id = cur && cur.length ? cur[0].id : "";
                if (id && lastId !== id) {
                    lastId = id;
                    // Set/remove active class
                    menuItems.each(function (idx, item) {
                    var $item = $(item);
                    $item.removeClass("side__nav-link--within-page--active");

                    if (item.href.endsWith('#' + lastId)) {
                        $item.addClass("side__nav-link--within-page--active");
                    };
                    });
                }
            });
        })()
    </script>
    <script type="text/javascript"> docsearch({
      apiKey: 'ff3a61a82b58783e62ebfbf51e50b0bc',
      indexName: 'imandra',
      inputSelector: '#search',
      debug: false // Set debug to true if you want to inspect the dropdown
    });
    </script>

    </body>
</html>
