<!DOCTYPE html>
<html>
    <head><meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Imandra Documentation - Imandra-tools Introduction</title>
        <meta property="og:url" content="https://docs.imandra.ai/imandra-docs/notebooks/imandra-tools-intro/">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Imandra Documentation - Imandra-tools Introduction">
        <meta property="og:description" content="In this notebook we’re going to introduce the imandra-tools library and explore how it extends Imandra's principal region decomposition utilities.">
        <meta property="og:image" content="https://storage.googleapis.com/imandra-assets/images/og_image_default_i78.jpg">


        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116937440-6"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-116937440-1');
        </script>
        <script type="text/javascript"> var sc_project=11767520; var sc_invisible=1; var sc_security="fa7e88d1"; </script>
        <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
        <noscript><div class="statcounter">
            <a title="Web Analytics" href="http://statcounter.com/" target="_blank">
                <img class="statcounter" src="//c.statcounter.com/11767520/0/fa7e88d1/1/" alt="Web Analytics"></a>
        </div></noscript>
        

        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i%7CMerriweather:300,300i,400,400i%7CRoboto+Slab:300,300i,400,400i">

        <link rel="stylesheet" href="/imandra-docs/static/style/style.min.c7df16ea.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/nbextensions/nbimandra/styles.b466ce6f.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/docs-styles.b9de737f.css" type="text/css">
        
        <link rel="stylesheet" href="/imandra-docs/static/jekyll-styles.16c4c669.css" type="text/css">
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="/imandra-docs/static/nbimandra-rjs-bundle.b85e58fd.js"></script>

        <style type="text/css">
         .highlight .hll { background-color: #ffffcc }
         .highlight  { background: #f8f8f8; }
         .highlight .c { color: #408080; font-style: italic } /* Comment */
         .highlight .err { border: 1px solid #FF0000 } /* Error */
         .highlight .k { color: #008000; font-weight: bold } /* Keyword */
         .highlight .o { color: #666666 } /* Operator */
         .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
         .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
         .highlight .cp { color: #BC7A00 } /* Comment.Preproc */
         .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
         .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
         .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
         .highlight .gd { color: #A00000 } /* Generic.Deleted */
         .highlight .ge { font-style: italic } /* Generic.Emph */
         .highlight .gr { color: #FF0000 } /* Generic.Error */
         .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
         .highlight .gi { color: #00A000 } /* Generic.Inserted */
         .highlight .go { color: #888888 } /* Generic.Output */
         .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
         .highlight .gs { font-weight: bold } /* Generic.Strong */
         .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
         .highlight .gt { color: #0044DD } /* Generic.Traceback */
         .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
         .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
         .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
         .highlight .kp { color: #008000 } /* Keyword.Pseudo */
         .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
         .highlight .kt { color: #B00040 } /* Keyword.Type */
         .highlight .m { color: #666666 } /* Literal.Number */
         .highlight .s { color: #BA2121 } /* Literal.String */
         .highlight .na { color: #7D9029 } /* Name.Attribute */
         .highlight .nb { color: #008000 } /* Name.Builtin */
         .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
         .highlight .no { color: #880000 } /* Name.Constant */
         .highlight .nd { color: #AA22FF } /* Name.Decorator */
         .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
         .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
         .highlight .nf { color: #0000FF } /* Name.Function */
         .highlight .nl { color: #A0A000 } /* Name.Label */
         .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
         .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
         .highlight .nv { color: #19177C } /* Name.Variable */
         .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
         .highlight .w { color: #bbbbbb } /* Text.Whitespace */
         .highlight .mb { color: #666666 } /* Literal.Number.Bin */
         .highlight .mf { color: #666666 } /* Literal.Number.Float */
         .highlight .mh { color: #666666 } /* Literal.Number.Hex */
         .highlight .mi { color: #666666 } /* Literal.Number.Integer */
         .highlight .mo { color: #666666 } /* Literal.Number.Oct */
         .highlight .sa { color: #BA2121 } /* Literal.String.Affix */
         .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
         .highlight .sc { color: #BA2121 } /* Literal.String.Char */
         .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
         .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
         .highlight .s2 { color: #BA2121 } /* Literal.String.Double */
         .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
         .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
         .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
         .highlight .sx { color: #008000 } /* Literal.String.Other */
         .highlight .sr { color: #BB6688 } /* Literal.String.Regex */
         .highlight .s1 { color: #BA2121 } /* Literal.String.Single */
         .highlight .ss { color: #19177C } /* Literal.String.Symbol */
         .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
         .highlight .fm { color: #0000FF } /* Name.Function.Magic */
         .highlight .vc { color: #19177C } /* Name.Variable.Class */
         .highlight .vg { color: #19177C } /* Name.Variable.Global */
         .highlight .vi { color: #19177C } /* Name.Variable.Instance */
         .highlight .vm { color: #19177C } /* Name.Variable.Magic */
         .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
        </style>

        <!-- Loading mathjax macro -->
        <!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --><script>
  function handleCopyClick() {
      var el = this;
      var terminal = el.closest('.terminal');
      var highlight = terminal.getElementsByClassName('highlight')[0];
      copyToClipboardMsg(highlight);

      terminal.classList.add('terminal--hide');
      setTimeout(function () {
          terminal.classList.remove('terminal--hide');
      }, 2000);


      function copyToClipboardMsg(elem) {
          var succeed = copyToClipboard(elem);
          var msg;
          if (!succeed) {
              msg = 'Error!';
          } else {
              msg = 'Copied!';
          }

          var msgElem = terminal.querySelector('.terminal__copy-msg');
          msgElem.innerHTML = msg;
          setTimeout(function () {
              msgElem.innerHTML = 'You rock!';
          }, 1000);
      }

      function copyToClipboard(elem) {
          // create hidden text element, if it doesn't already exist
          var targetId = '_hiddenCopyText_';
          var isInput = elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA';
          var origSelectionStart, origSelectionEnd;
          if (isInput) {
              // can just use the original source element for the selection and copy
              target = elem;
              origSelectionStart = elem.selectionStart;
              origSelectionEnd = elem.selectionEnd;
          } else {
              // must use a temporary form element for the selection and copy
              target = terminal.querySelector('#' + targetId);
              if (!target) {
                  var target = document.createElement('textarea');
                  // target.style.display = 'flex';
                  // target.style.position = 'absolute';
                  // target.style.left = '-1000%';
                  target.id = targetId;
                 elem.appendChild(target);
              }
              target.textContent = elem.textContent.trim();
          }

          // select the content
          var currentFocus = document.activeElement;
          target.focus();
          target.setSelectionRange(0, target.value.length);

          // copy the selection
          var succeed;
          try {
              succeed = document.execCommand('copy');
          } catch (e) {
              succeed = false;
          }
          // restore original focus
          if (currentFocus && typeof currentFocus.focus === 'function') {
              currentFocus.focus();
          }

          if (isInput) {
              // restore prior selection
              elem.setSelectionRange(origSelectionStart, origSelectionEnd);
          } else {
              // clear temporary content
              elem.removeChild(target);
          }
          return succeed;
      }
  }
</script>
    </head>
    <body>
        <div class="background">
        </div>
        <div class="page-container">
            <main class="main-content-column">
                <!-- Jupyter (Imandra core docs) version -->
<header class="header">
    <div class="top-row-container">
        <div class="top-row">

            <div id="toggler--left" class="side__left-menu-toggler">
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p class="side__toggle-text">Docs</p>
            </div>

            <div class="side__logo-container">
                <a class="side__logo-link" href="/">
                    <img class="side__logo " src = "/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-docs.svg" alt="Imandra Logo" title="Imandra Logo">
                    <img class="side__logo--min " src="/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-min.svg" alt="Imandra Logo" title="Imandra Logo">

                </a>
            </div>

            <div id="toggler--right" class="side__right-menu-toggler">
                <p class="side__toggle-text">Pages</p>
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <nav id="side-nav-menu" class="side__nav-container side__nav-container--hidden">
                <ul class="side__nav-list">
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/">Documentation Home</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs">Imandra Core</a>
                        
                        <ul class="side__nav-list--sub-level-1">
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/welcome">A quick tour</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/installation">Installation</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-simple">Installer</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-manual-opam">Manual (opam)</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-docker">Docker Image</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-jupyter">Jupyter Notebook</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-vscode">VSCode</a>
                                        
                                        
                                        
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/logic-and-program-modes">Logic and Program modes</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/verification">Verification</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-commands">Commands</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-attributes">Attributes</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-unrolling">Unrolling</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-simplification">Simplification</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-blast">Blast</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-induction">Induction</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall">Waterfall</a>
                                        
                                        
                                        
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/proving-program-termination">Proving program termination</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/decomposition">Region Decomposition</a>
                                
                                <ul class="side__nav-list--sub-level-2  side__nav-list--sub-level-2--active">
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs/notebooks/imandra-tools-intro">Imandra tools introduction</a>
                                        
                                        
                                        
                                        <div class="side__within-page-nav--sub-level-2">
                                        
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h1" href="#Iterative-Decomposition-Framework-(Idf)">Iterative Decomposition Framework (Idf)</a>
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h1" href="#Region-Pretty-Printer-(Region_pp)">Region Pretty Printer (Region_pp)</a>
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h1" href="#Region-Term-Synthesizer-(Region_term_synth)">Region Term Synthesizer (Region_term_synth)</a>
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h1" href="#Region-Indexer-(Region_idx)">Region Indexer (Region_idx)</a>
  
  
  
  <a class="side__nav-link--within-page side__nav-link--within-page--h1" href="#Region-Probabilities-(Region_probs)">Region Probabilities (Region_probs)</a>
  
  
                                        </div>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/idf">Iterative Decomposition Framework</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/region-probabilities">Region probabilities</a>
                                        
                                        
                                        
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/loading-files">Multifile development</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/extracting-ocaml-modules-with-imandra-extract">Extracting OCaml modules</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/plugins">Code generation and plugins</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/reflection">Reflection of terms</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/examples">Examples</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/recursion-induction-and-rewriting">Recursion, Induction and Rewriting</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-merge-sort">Verifying merge sort in Imandra</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/ubs-case-study">Analysing the UBS ATS Dark Pool</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/six-swiss-exchange-pricing">Region Decomposition - Exchange Pricing</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/exchange-implied-trading">Exchange Implied Trading</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/webservice-auth-logic">Analysing Web-app authentication logic</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/simple-vehicle-controller">Simple vehicle controller</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/simple-stoplight-model">Simple car intersection model</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/ripple-carry-adder">Verifying a Ripple Carry Adder</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-an-ros-node">Creating and Verifying a ROS Node</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-tic-tac-toe">Tic Tac Toe with ReasonML</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/probabilistic-reasoning-in-reasonml">Probabilistic Reasoning in ReasonML</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/sudoku">Solving Sudoku with Imandra</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/crossing-river-safely">Crossing the river safely</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-facetime-state-machines">Exploring The Apple FaceTime Bug with ReasonML State Machines</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/key-pair-security">Key Pair Security in Imandra</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/a-comparison-with-tla-plus">A comparison with TLA+</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/solver-synthesis">Synthesising a game solver in Imandra</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/supervised-learning">Analysing Machine Learning Models</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/school-scheduler">Solving school scheduling during COVID</a>
                                        
                                        
                                        
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1 ">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/reference">Reference</a>
                                
                                <ul class="side__nav-list--sub-level-2 ">
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/odoc/imandra-base/Imandra_prelude/">Standard Library</a>
                                        
                                        
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty">
                                        
                                        <a class="side__nav-link" href="/imandra-docs/odoc/">API Docs</a>
                                        
                                        
                                        
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                        </ul>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/idf-py">Py IDF</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/ipl">Imandra Protocol Language</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/imandra-rule-synth">Imandra Rule Synth</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item">
                        <a class="side__nav-link" href="/fix-engine">FIX Engine</a>
                        
                    </li>
                    
                </ul>
            </nav>
        </div>
    </div>

    <div class="background">
    </div>



    <div class="template-header">
        <div class="top-bar">
            <div class="side__nav-search">
                <input id="search" type="search" placeholder="Search">
                <div class="side__nav-search-icon">
                    <i class="fa fa-search"></i>
                </div>
            </div>

            <nav class="top-bar__nav-container">
                <a href="#" class="top-bar__toggle">≡</a>
                <div class="top-nav-bar__group ">
                    <div class="top-nav-bar__nav nav-bar--blue top-nav-bar__nav--hidden">
                        <ul class="top-nav-bar__links top-nav-bar__links--hidden-smaller-than-tablet">
                            <li class="top-nav-bar__item">
                                <a href="https://www.imandra.ai/" class="top-nav-bar__link">Home</a>
                            </li>
                            <li class="top-nav-bar__item">
                                <a href="https://try.imandra.ai/" class="top-nav-bar__link">Try</a>
                            </li>
                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--engine">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Engine</a>
                                <ul class="dropdown-content dropdown-content--engine">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--core.svg" alt="Imandra Core" title="Imandra Core Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/core">Imandra Core</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--demos.svg" alt="Demo Gallery" title="Imandra Demo Gallery Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/demos">Demo Gallery</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--docs.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/">Docs</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--research.svg" alt="Research" title="Research Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/research">Research</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--industries">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Industries</a>
                                <ul class="dropdown-content dropdown-content--industries">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--financial.svg" alt="Financial Markets" title="Financial Markets Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/imarkets">Financial Markets</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--autonomy.svg" alt="Autonomous Systems" title="Autonomous Systems Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/autonomy">Autonomous Systems</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--ml.svg" alt="Machine Learning" title="Machine Learning Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/ml">Machine Learning</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--government.svg" alt="Machine Learning" title="Machine Learning Icon">
                                        <a class="dropdown__link dropdown__link--last" href="https://www.imandra.ai/government">Government and defense</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--media">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Media</a>
                                <ul class="dropdown-content dropdown-content--media">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--media.svg" alt="Media" title="Media Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/media">Media</a></li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--blog.svg" alt="Blog" title="Blog Icon">
                                        <a class="dropdown__link dropdown__link--last " href="https://medium.com/imandra">Blog</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--company">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Company</a>
                                <ul class="dropdown-content dropdown-content--company">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--about.svg" alt="About" title="About Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/about">About</a></li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--menu--careers.svg" alt=" Careers" title="Careers Icon">
                                        <a class="dropdown__link dropdown__link--last dropdown__link--bottom" href="https://www.imandra.ai/careers">Careers</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <div class="template-header__image-container template-header__image-container--jupyter">
            <div class="template-header__image" href ="/imandra-docs">
                <img class="site-specific-image" src="/imandra-docs/static/img/site_specific_image_v_2.svg">
            </div>
        </div>

    </div>



    <script>
        document.getElementById('toggler--left').addEventListener('click', function () {
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');
            document.getElementsByClassName('side__nav-container')[0].classList.toggle(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.add('top-nav-bar__nav--hidden');
        });

        document.getElementById('toggler--right').addEventListener('click', function () {
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');

            document.getElementsByClassName('side__nav-container')[0].classList.add(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.toggle(
                'top-nav-bar__nav--hidden');
        });
    </script>
</header>
                <article class="article__container article__container--notebooks">
                    <div class="main-content main-content--jupyter">
                        
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="An-introduction-to-imandra-tools">An introduction to <code>imandra-tools</code><a class="anchor-link" href="#An-introduction-to-imandra-tools">&#182;</a></h1><p>In this notebook, we'll introduce the <code>imandra-tools</code> library and go through how to use its powerful modules to augment Imandra's decomposition facilities.</p>
<p>Normally, before using <code>imandra-tools</code>, one would have to require it in their Imandra toplevel by executing the require statement <code>#require "imandra-tools"</code>. Since the <code>#require</code> directive is disabled for security reasons in this notebook, this step won't be necessary as we've pre-loaded imandra-tools.</p>
<p>Let's make sure this is actually the case before starting.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-2" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="o">#</span><span class="n">show</span> <span class="nc">Imandra_tools</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[1]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>module Imandra_tools :
  sig
    module Idf = Imandra_tools.Idf
    module Idf_intf = Imandra_tools.Idf_intf
    module Region_idx = Imandra_tools.Region_idx
    module Region_json = Imandra_tools.Region_json
    module Region_pp = Imandra_tools.Region_pp
    module Region_pp_intf = Imandra_tools.Region_pp_intf
    module Region_probs = Imandra_tools.Region_probs
    module Region_term_synth = Imandra_tools.Region_term_synth
  end
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Great! Let's start exploring <code>imandra-tools</code>.</p>
<ul>
<li><a href="#Iterative-Decomposition-Framework-%28Idf%29">Idf</a></li>
<li><a href="#Region-Pretty-Printer-%28Region_pp%29">Region_pp</a></li>
<li><a href="#Region-Term-Synthesizer-%28Region_term_synth%29">Region_term_synth</a></li>
<li><a href="#Region-Indexer-%28Region_idx%29">Region_idx</a></li>
<li><a href="#Region-Probabilities-%28Region_probs%29">Region_probs</a></li>
</ul>
<div style="margin-top: 1em; background-color: #ffcc66; padding: 1em">
Note: this is an introductory walkthrough of the capabilities of `imandra-tools`, much more than what's described in this notebook is possible with it, but we'll defer a more in-depth explanation of each module in future notebooks.
</div><h1 id="Iterative-Decomposition-Framework-(Idf)">Iterative Decomposition Framework (Idf)<a class="anchor-link" href="#Iterative-Decomposition-Framework-(Idf)">&#182;</a></h1><p>The first module we're going to explore is <code>Imandra_tools.Idf</code>. Its broad purpose is to provide a framework allowing for iterative, lazy decomposition of state-machine models.</p>
<p>Before diving into its usage, let's first define a simple example of such a model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-4" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">module</span> <span class="nc">Model</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">message</span> <span class="o">=</span> <span class="nc">Add</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">|</span> <span class="nc">Sub</span> <span class="k">of</span> <span class="kt">int</span> <span class="o">|</span> <span class="nc">Reset</span>

  <span class="k">type</span> <span class="n">counter_state</span> <span class="o">=</span> <span class="o">{</span> <span class="n">counter</span> <span class="o">:</span> <span class="kt">int</span>
                       <span class="o">;</span> <span class="n">default</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">}</span>

  <span class="k">let</span> <span class="n">one_step</span> <span class="n">msg</span> <span class="n">state</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">1337</span> <span class="k">then</span>
      <span class="o">{</span> <span class="n">state</span> <span class="k">with</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">default</span> <span class="o">}</span>
    <span class="k">else</span>
      <span class="k">match</span> <span class="n">msg</span> <span class="k">with</span>
      <span class="o">|</span> <span class="nc">Reset</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">state</span> <span class="k">with</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">}</span>
      <span class="o">|</span> <span class="nc">Add</span> <span class="n">n</span> <span class="o">-&gt;</span>
         <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">9000</span> <span class="k">then</span>
           <span class="o">{</span> <span class="n">state</span> <span class="k">with</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">}</span>
         <span class="k">else</span>
           <span class="o">{</span> <span class="n">state</span> <span class="k">with</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="n">n</span> <span class="o">}</span>
      <span class="o">|</span> <span class="nc">Sub</span> <span class="n">n</span> <span class="o">-&gt;</span>
         <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span> <span class="k">then</span>
           <span class="n">state</span>
         <span class="k">else</span>
           <span class="o">{</span> <span class="n">state</span> <span class="k">with</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span> <span class="o">-</span> <span class="n">n</span> <span class="o">}</span>
  <span class="k">end</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>module Model :
  sig
    type message = Add of int | Sub of int | Reset
    type counter_state = { counter : int; default : int; }
    val one_step : message -&gt; counter_state -&gt; counter_state
  end
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The above model is not very interesting but it exemplifies all that's needed for a model to be suitable for usage with <code>Idf</code>:</p>
<ul>
<li>An algebraic type describing all the possible messages a model can react to (<code>message</code>)</li>
<li>A type describing the current state of the model (<code>counter_state</code>)</li>
<li>A transition function from message and state to new state (<code>one_step</code>)</li>
</ul>
<p>Now that the module is defined, we need to set-up <code>Idf</code> for its decomposition.</p>
<p>We need to do is define a module implementing the <code>Idf_intf.DFSM_SIG</code> module signature:</p>
<ul>
<li>a <code>State_machine</code> module implementing the <code>Idf_intf.SM_SIG</code> module signature:<ul>
<li>an <code>event</code> type mapping to the model message type</li>
<li>a <code>state</code> type mapping to the model state type</li>
<li>an <code>init_state</code> value of type <code>state</code></li>
<li>a <code>step</code> transition function mapping to the model transition function</li>
<li>an <code>is_valid</code> function that takes an <code>event</code> and a <code>state</code> and checks whether that <code>&lt;event,state&gt;</code> transition is valid or not</li>
</ul>
</li>
<li>a <code>module_name</code> value mapping to the name of the module being defined (this is necessary for reflection purposes)</li>
<li>a <code>Template</code> module implementing the <code>Idf_intf.TPL_SIG</code> module signature:<ul>
<li>a <code>t</code> variant type symbolically describing events from our model</li>
<li>a <code>c</code> variant type mapping to the concrete <code>event</code> type</li>
<li>a <code>concrete</code> function mapping <code>t</code> events to <code>c</code> events</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-6" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">open</span> <span class="nc">Imandra_tools</span>

<span class="k">module</span> <span class="nc">Decomp</span> <span class="o">=</span> <span class="k">struct</span>

  <span class="k">module</span> <span class="nc">State_machine</span> <span class="o">=</span> <span class="k">struct</span>
    <span class="k">open</span> <span class="nc">Model</span>

    <span class="k">type</span> <span class="n">event</span> <span class="o">=</span> <span class="n">message</span>
    <span class="k">type</span> <span class="n">state</span> <span class="o">=</span> <span class="n">counter_state</span>

    <span class="k">let</span> <span class="n">init_state</span> <span class="o">:</span> <span class="n">state</span> <span class="o">=</span>
      <span class="o">{</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">23</span> <span class="o">}</span>

    <span class="k">let</span> <span class="n">step</span> <span class="o">(</span><span class="n">event</span> <span class="o">:</span> <span class="n">event</span><span class="o">)</span> <span class="o">(</span><span class="n">state</span> <span class="o">:</span> <span class="n">state</span><span class="o">)</span> <span class="o">:</span> <span class="n">state</span> <span class="o">=</span>
       <span class="n">one_step</span> <span class="n">event</span> <span class="n">state</span>

    <span class="k">let</span> <span class="n">is_valid</span> <span class="o">(</span><span class="n">event</span> <span class="o">:</span> <span class="n">event</span><span class="o">)</span> <span class="o">(</span><span class="n">state</span> <span class="o">:</span> <span class="n">state</span><span class="o">)</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span>
      <span class="k">match</span> <span class="n">event</span> <span class="k">with</span>
      <span class="o">|</span> <span class="nc">Reset</span> <span class="o">-&gt;</span> <span class="bp">true</span>
      <span class="o">|</span> <span class="nc">Add</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="o">|</span> <span class="nc">Sub</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span>

  <span class="k">end</span>

  <span class="k">let</span> <span class="n">module_name</span> <span class="o">=</span> <span class="s2">&quot;Decomp&quot;</span>

  <span class="k">module</span> <span class="nc">Template</span> <span class="o">=</span> <span class="k">struct</span>
    <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Add</span> <span class="o">|</span> <span class="nc">Sub</span> <span class="o">|</span> <span class="nc">Reset</span> <span class="o">|</span> <span class="nc">Any</span>
    <span class="k">type</span> <span class="n">c</span> <span class="o">=</span> <span class="nn">State_machine</span><span class="p">.</span><span class="n">event</span>

    <span class="k">let</span> <span class="n">concrete</span> <span class="n">c</span> <span class="n">t</span> <span class="o">=</span> <span class="k">match</span> <span class="n">c</span><span class="o">,</span> <span class="n">t</span> <span class="k">with</span>
        <span class="o">|</span> <span class="nc">Add</span><span class="o">,</span> <span class="nn">Model</span><span class="p">.</span><span class="nc">Add</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">true</span>
        <span class="o">|</span> <span class="nc">Sub</span><span class="o">,</span> <span class="nn">Model</span><span class="p">.</span><span class="nc">Sub</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">true</span>
        <span class="o">|</span> <span class="nc">Reset</span><span class="o">,</span> <span class="nn">Model</span><span class="p">.</span><span class="nc">Reset</span> <span class="o">-&gt;</span> <span class="bp">true</span>
        <span class="o">|</span> <span class="nc">Any</span><span class="o">,</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">true</span>
        <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">false</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>module Decomp :
  sig
    module State_machine :
      sig
        type event = Model.message
        type state = Model.counter_state
        val init_state : state
        val step : event -&gt; state -&gt; state
        val is_valid : event -&gt; state -&gt; bool
      end
    val module_name : string
    module Template :
      sig
        type t = Add | Sub | Reset | Any
        type c = State_machine.event
        val concrete : t -&gt; c -&gt; bool
      end
  end
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We're now ready to create a decomposition recipe and apply it to an event template, simply instantiating <code>Idf</code> with <code>Decomp</code> in a module <code>IDF</code>.</p>
<p>We can use the <code>IDF</code> module to start decomposing any sequences of events, let's do that over a template of <code>[any; add; any]</code> events:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-8" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="o">#</span><span class="n">program</span><span class="o">;;</span>

<span class="k">module</span> <span class="nc">IDF</span> <span class="o">=</span> <span class="nn">Idf</span><span class="p">.</span><span class="nc">Make</span><span class="o">(</span><span class="nc">Decomp</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">g</span> <span class="o">=</span> <span class="nn">IDF</span><span class="p">.</span><span class="nn">G</span><span class="p">.</span><span class="n">create</span> <span class="bp">()</span><span class="o">;;</span>
<span class="nn">IDF</span><span class="p">.</span><span class="n">decompose</span> <span class="o">~</span><span class="n">g</span> <span class="o">(</span><span class="nn">Decomp</span><span class="p">.</span><span class="nn">Template</span><span class="p">.</span><span class="o">[</span><span class="nc">Any</span><span class="o">;</span><span class="nc">Add</span><span class="o">;</span><span class="nc">Any</span><span class="o">])</span> <span class="bp">()</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val root_ZHMySlZ5akVYU1JPYmZKVm1UMGh0YUI4VDhBdTZJRFZ6TkRLTWJrcnk5RQ :
  Model.message list -&gt; Model.counter_state = &lt;fun&gt;
module Mex :
  sig
    val get_option : (Term.term -&gt; &#39;a_0) -&gt; Term.term -&gt; &#39;a_0 option
    val get_nativeint : Term.term -&gt; nativeint
    val get_Peano_nat_t : Term.term -&gt; Peano_nat.t
    val get_unit : Term.term -&gt; unit
    val get_result :
      (Term.term -&gt; &#39;a_0) -&gt;
      (Term.term -&gt; &#39;a_1) -&gt; Term.term -&gt; (&#39;a_0, &#39;a_1) result
    val get_Result_t :
      (Term.term -&gt; &#39;a_0) -&gt;
      (Term.term -&gt; &#39;a_1) -&gt; Term.term -&gt; (&#39;a_0, &#39;a_1) result
    val get_either :
      (Term.term -&gt; &#39;a_0) -&gt;
      (Term.term -&gt; &#39;a_1) -&gt; Term.term -&gt; (&#39;a_0, &#39;a_1) either
    val get_List_t : (Term.term -&gt; &#39;a_0) -&gt; Term.term -&gt; &#39;a_0 list
    val get_Int_t : Term.term -&gt; int
    val get_Bool_t : Term.term -&gt; bool
    val get_Option_t : (Term.term -&gt; &#39;a_0) -&gt; Term.term -&gt; &#39;a_0 option
    val get_Real_t : Term.term -&gt; real
    val get_Map_t :
      (Term.term -&gt; &#39;a_0) -&gt;
      (Term.term -&gt; &#39;a_1) -&gt; Term.term -&gt; (&#39;a_0, &#39;a_1) Map.t
    val get_Multiset_t : (Term.term -&gt; &#39;a_0) -&gt; Term.term -&gt; &#39;a_0 Multiset.t
    val get_Set_t : (Term.term -&gt; &#39;a_0) -&gt; Term.term -&gt; &#39;a_0 Set.t
    val get_String_t : Term.term -&gt; string
    val get_Float_t : Term.term -&gt; float
    val get_Reflect_Uid_t : Term.term -&gt; Reflect.Uid.t
    val get_Reflect_Type_t : Term.term -&gt; Reflect.Type.t
    val get_Reflect_Var_t : Term.term -&gt; Reflect.Var.t
    val get_Reflect_Term_const : Term.term -&gt; Reflect.Term.const
    val get_Reflect_Term_binding :
      (Term.term -&gt; &#39;a_0) -&gt; Term.term -&gt; &#39;a_0 Reflect.Term.binding
    val get_Reflect_Term_t : Term.term -&gt; Reflect.Term.t
    val get_Model_message : Term.term -&gt; Model.message
    val get_Model_counter_state : Term.term -&gt; Model.counter_state
    val get_Decomp_State_machine_event : Term.term -&gt; Model.message
    val get_Decomp_State_machine_state : Term.term -&gt; Model.counter_state
    val get_Decomp_Template_t : Term.term -&gt; Decomp.Template.t
    val get_Decomp_Template_c : Term.term -&gt; Model.message
    type e_t = Model.message list
    type extract_type = { e : e_t; }
    val ret_e : extract_type -&gt; e_t
    val of_model : ?signature:string -&gt; Top_result.term_model -&gt; extract_type
  end
- : unit = ()
module IDF :
  sig
    module DSM :
      sig
        module State_machine :
          sig
            type state = Model.counter_state
            type event = Model.message
            val init_state : state
            val step : event -&gt; state -&gt; state
            val is_valid : event -&gt; state -&gt; bool
          end
        module Template :
          sig
            type t = Decomp.Template.t
            type c = State_machine.event
            val concrete : t -&gt; c -&gt; bool
          end
        val module_name : string
      end
    val pp_state : Model.counter_state -&gt; string
    type target = DSM.Template.t list
    type node = IDF.node
    type path = node list
    module G :
      sig
        type t = IDF.G.t
        module V :
          sig
            type t = node
            val compare : t -&gt; t -&gt; int/2
            val hash : t -&gt; int/2
            val equal : t -&gt; t -&gt; bool
            type label = t
            val create : t -&gt; t
            val label : t -&gt; t
          end
        type vertex = node
        module E :
          sig
            type t = IDF.G.edge
            val compare : t -&gt; t -&gt; int/2
            type vertex = node
            val src : t -&gt; vertex
            val dst : t -&gt; vertex
            type label = IDF.G.E.label
            val create : vertex -&gt; label -&gt; vertex -&gt; t
            val label : t -&gt; label
          end
        type edge = E.t
        val is_directed : bool
        val is_empty : t -&gt; bool
        val nb_vertex : t -&gt; int/2
        val nb_edges : t -&gt; int/2
        val out_degree : t -&gt; vertex -&gt; int/2
        val in_degree : t -&gt; vertex -&gt; int/2
        val mem_vertex : t -&gt; vertex -&gt; bool
        val mem_edge : t -&gt; vertex -&gt; vertex -&gt; bool
        val mem_edge_e : t -&gt; edge -&gt; bool
        val find_edge : t -&gt; vertex -&gt; vertex -&gt; edge
        val find_all_edges : t -&gt; vertex -&gt; vertex -&gt; edge list
        val succ : t -&gt; vertex -&gt; vertex list
        val pred : t -&gt; vertex -&gt; vertex list
        val succ_e : t -&gt; vertex -&gt; edge list
        val pred_e : t -&gt; vertex -&gt; edge list
        val iter_vertex : (vertex -&gt; unit) -&gt; t -&gt; unit
        val fold_vertex : (vertex -&gt; &#39;a -&gt; &#39;a) -&gt; t -&gt; &#39;a -&gt; &#39;a
        val iter_edges : (vertex -&gt; vertex -&gt; unit) -&gt; t -&gt; unit
        val fold_edges : (vertex -&gt; vertex -&gt; &#39;a -&gt; &#39;a) -&gt; t -&gt; &#39;a -&gt; &#39;a
        val iter_edges_e : (edge -&gt; unit) -&gt; t -&gt; unit
        val fold_edges_e : (edge -&gt; &#39;a -&gt; &#39;a) -&gt; t -&gt; &#39;a -&gt; &#39;a
        val map_vertex : (vertex -&gt; vertex) -&gt; t -&gt; t
        val iter_succ : (vertex -&gt; unit) -&gt; t -&gt; vertex -&gt; unit
        val iter_pred : (vertex -&gt; unit) -&gt; t -&gt; vertex -&gt; unit
        val fold_succ : (vertex -&gt; &#39;a -&gt; &#39;a) -&gt; t -&gt; vertex -&gt; &#39;a -&gt; &#39;a
        val fold_pred : (vertex -&gt; &#39;a -&gt; &#39;a) -&gt; t -&gt; vertex -&gt; &#39;a -&gt; &#39;a
        val iter_succ_e : (edge -&gt; unit) -&gt; t -&gt; vertex -&gt; unit
        val fold_succ_e : (edge -&gt; &#39;a -&gt; &#39;a) -&gt; t -&gt; vertex -&gt; &#39;a -&gt; &#39;a
        val iter_pred_e : (edge -&gt; unit) -&gt; t -&gt; vertex -&gt; unit
        val fold_pred_e : (edge -&gt; &#39;a -&gt; &#39;a) -&gt; t -&gt; vertex -&gt; &#39;a -&gt; &#39;a
        val create : ?size:int/2 -&gt; unit -&gt; t
        val clear : t -&gt; unit
        val copy : t -&gt; t
        val add_vertex : t -&gt; vertex -&gt; unit
        val remove_vertex : t -&gt; vertex -&gt; unit
        val add_edge : t -&gt; vertex -&gt; vertex -&gt; unit
        val add_edge_e : t -&gt; edge -&gt; unit
        val remove_edge : t -&gt; vertex -&gt; vertex -&gt; unit
        val remove_edge_e : t -&gt; edge -&gt; unit
        val root : t -&gt; vertex
        val leaves : t -&gt; vertex list
        val output_graph : t -&gt; file:string -&gt; unit
      end
    val paths : ?from:node -&gt; G.t -&gt; path list
    val region : node -&gt; Top_result.modular_region
    val expanded_constraints : node -&gt; Term.term list
    val sample : node -&gt; Model.message list
    val sample_region : Top_result.modular_region -&gt; Model.message list
    type region_expander = string option * string list * string option
    val target_steps :
      node -&gt; (DSM.Template.t * bool option * region_expander option) list
    type replay_sample =
      IDF.replay_sample = {
      state_before : Model.counter_state;
      event : Model.message;
      state_after : Model.counter_state;
    }
    val replay_events : Model.message list -&gt; replay_sample list
    val replay : node -&gt; replay_sample list
    val decompose :
      g:G.t -&gt;
      ?basis:string list -&gt;
      ?include_partial_paths:bool -&gt;
      ?expanding:string list -&gt;
      ?valid_pol:bool option list -&gt;
      ?assuming:string -&gt;
      ?region_expander:region_expander list -&gt; target -&gt; unit -&gt; unit
  end
val g : IDF.G.t = &lt;abstr&gt;
- : unit = ()
val guard_ZHMySlZ5akVYU1JPYmZKVm1UMGh0YUI4VDhBdTZJRFZ6TkRLTWJrcnk5RQ_RGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWU :
  Model.message list -&gt; bool = &lt;fun&gt;
val target_ZHMySlZ5akVYU1JPYmZKVm1UMGh0YUI4VDhBdTZJRFZ6TkRLTWJrcnk5RQ_RGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWU :
  Model.message list -&gt; Model.counter_state = &lt;fun&gt;
val guard_ZHMySlZ5akVYU1JPYmZKVm1UMGh0YUI4VDhBdTZJRFZ6TkRLTWJrcnk5RQ_RGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWUsRGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWVEZWNvbXAuVGVtcGxhdGUuQWRkOlNvbWUgdHJ1ZQ :
  Model.message list -&gt; bool = &lt;fun&gt;
val target_ZHMySlZ5akVYU1JPYmZKVm1UMGh0YUI4VDhBdTZJRFZ6TkRLTWJrcnk5RQ_RGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWUsRGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWVEZWNvbXAuVGVtcGxhdGUuQWRkOlNvbWUgdHJ1ZQ :
  Model.message list -&gt; Model.counter_state = &lt;fun&gt;
val guard_ZHMySlZ5akVYU1JPYmZKVm1UMGh0YUI4VDhBdTZJRFZ6TkRLTWJrcnk5RQ_RGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWUsRGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWVEZWNvbXAuVGVtcGxhdGUuQWRkOlNvbWUgdHJ1ZSxEZWNvbXAuVGVtcGxhdGUuQW55OlNvbWUgdHJ1ZURlY29tcC5UZW1wbGF0ZS5BZGQ6U29tZSB0cnVlRGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWU :
  Model.message list -&gt; bool = &lt;fun&gt;
val target_ZHMySlZ5akVYU1JPYmZKVm1UMGh0YUI4VDhBdTZJRFZ6TkRLTWJrcnk5RQ_RGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWUsRGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWVEZWNvbXAuVGVtcGxhdGUuQWRkOlNvbWUgdHJ1ZSxEZWNvbXAuVGVtcGxhdGUuQW55OlNvbWUgdHJ1ZURlY29tcC5UZW1wbGF0ZS5BZGQ6U29tZSB0cnVlRGVjb21wLlRlbXBsYXRlLkFueTpTb21lIHRydWU :
  Model.message list -&gt; Model.counter_state = &lt;fun&gt;
- : unit = ()
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div><pre></pre></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Since <code>IDF</code> generates a decomposition graph, we need to first create an empty graph via <code>IDF.G.create</code>, we can then list all the paths of the decomposition graph from the initial state to the final state:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-10" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">paths</span> <span class="o">=</span> <span class="nn">IDF</span><span class="p">.</span><span class="n">paths</span> <span class="n">g</span>
<span class="k">let</span> <span class="n">first_path</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">hd</span> <span class="n">paths</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val paths : IDF.path list =
  [[&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;];
   [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;]; [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; ...];
   ...]
val first_path : IDF.path = [&lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;; &lt;abstr&gt;]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This output is not very useful, but we can ask <code>Idf</code> to play out a sample execution of that path:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-12" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="nn">IDF</span><span class="p">.</span><span class="n">replay</span> <span class="o">(</span><span class="n">first_path</span> <span class="o">|&gt;</span> <span class="nn">CCList</span><span class="p">.</span><span class="n">last_opt</span> <span class="o">|&gt;</span> <span class="nn">CCOpt</span><span class="p">.</span><span class="n">get_exn</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : IDF.replay_sample list =
[{IDF.state_before = {Model.counter = 0; default = 23}; event = Model.Add 1;
  state_after = {Model.counter = 1; default = 23}};
 {IDF.state_before = {Model.counter = 1; default = 23};
  event = Model.Add 9000; state_after = {Model.counter = 0; default = 23}};
 {IDF.state_before = {Model.counter = 0; default = 23};
  event = Model.Add 9001; state_after = {Model.counter = 0; default = 23}}]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Or we can ask <code>Idf</code> to let us inspect the regions for that path (each region in the list will correspond to the constraints and invariant of the model up to each event in the template):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-14" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">first_path_regions</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">IDF</span><span class="p">.</span><span class="n">region</span> <span class="n">first_path</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val first_path_regions : Top_result.modular_region list =
  [{Imandra_surface.Modular_region.mreg_session = 1i; mreg_id = 0i;
    mreg_constraints = [true];
    mreg_invariant = {Model.counter = 0; Model.default = 23};
    mreg_args = [(e : Decomp.State_machine.event list)];
    mreg_status = Imandra_surface.Modular_region.Unknown};
   {Imandra_surface.Modular_region.mreg_session = 1i; mreg_id = 1i;
    mreg_constraints =
     [not (List.hd e = Model.Reset); Is_a(Model.Add, List.hd e);
      Destruct(Model.Add, 0, List.hd e) &lt;= 9000; e &lt;&gt; []; List.tl e = [];
      not (Destruct(Model.Add, 0, List.hd e) &lt;= 0)];
    mreg_invariant =
     {Model.counter = 0 + Destruct(Model.Add, 0, List.hd e);
      Model.default = 23};
    mreg_args = [(e : Decomp.State_machine.event list)];
    mreg_status = Imandra_surface.Modular_region.Unknown};
   {Imandra_surface.Modular_region.mreg_session = 1i; mreg_id = 5i;
    mreg_constraints =
     [not (Destruct(Model.Add, 0, List.hd e) &lt;= 0);
      Destruct(Model.Add, 0, List.hd e) &lt;= 9000; Is_a(Model.Add, List.hd e);
      not (List.hd e = Model.Reset);
      not (Destruct(Model.Add, 0, List.hd e) = 1337);
      not
      ((Destruct(Model.Add, 0, List.hd e)
        + Destruct(Model.Add, 0, List.hd (List.tl e)))
       &lt;= 9000);
      not (List.hd (List.tl e) = Model.Reset);
      Is_a(Model.Add, List.hd (List.tl e)); e &lt;&gt; []; (List.tl e) &lt;&gt; [];
      List.tl (List.tl e) = [];
      not (Destruct(Model.Add, 0, List.hd (List.tl e)) &lt;= 0)];
    mreg_invariant = {Model.counter = 0; Model.default = 23};
    mreg_args = [(e : Decomp.State_machine.event list)];
    mreg_status = Imandra_surface.Modular_region.Unknown};
   {Imandra_surface.Modular_region.mreg_session = 1i; mreg_id = 19i;
    mreg_constraints =
     [not (Destruct(Model.Add, 0, List.hd (List.tl e)) &lt;= 0);
      Is_a(Model.Add, List.hd (List.tl e));
      not (List.hd (List.tl e) = Model.Reset);
      not
      ((Destruct(Model.Add, 0, List.hd e)
        + Destruct(Model.Add, 0, List.hd (List.tl e)))
       &lt;= 9000);
      not (Destruct(Model.Add, 0, List.hd e) = 1337);
      not (List.hd e = Model.Reset); Is_a(Model.Add, List.hd e);
      Destruct(Model.Add, 0, List.hd e) &lt;= 9000;
      not (Destruct(Model.Add, 0, List.hd e) &lt;= 0);
      not (Destruct(Model.Add, 0, List.hd (List.tl (List.tl e))) &lt;= 9000);
      not (List.hd (List.tl (List.tl e)) = Model.Reset);
      Is_a(Model.Add, List.hd (List.tl (List.tl e))); e &lt;&gt; [];
      (List.tl e) &lt;&gt; []; (List.tl (List.tl e)) &lt;&gt; [];
      List.tl (List.tl (List.tl e)) = [];
      not (Destruct(Model.Add, 0, List.hd (List.tl (List.tl e))) &lt;= 0)];
    mreg_invariant = {Model.counter = 0; Model.default = 23};
    mreg_args = [(e : Decomp.State_machine.event list)];
    mreg_status = Imandra_surface.Modular_region.Unknown}]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For a full description of the <code>Idf</code> API and capabilities, check out the <a href="/imandra-docs/notebooks/idf/">Iterative Decomposition Framework</a> page.</p>
<p>Looking at the above regions we can spot a common problem with decompositions: the regions become very hard to read, even with quite simple models.</p>
<p>This is a good moment to introduce a second <code>imandra-tools</code> module:</p>
<h1 id="Region-Pretty-Printer-(Region_pp)">Region Pretty Printer (Region_pp)<a class="anchor-link" href="#Region-Pretty-Printer-(Region_pp)">&#182;</a></h1><p>The purpose of the <code>Region_pp</code> module is twofold: it provides a <em>default</em> drop-in pretty printer for regions, much more powerful than the default region printer <em>and</em> it also provides an extensible framework for creating powerful printers with semantic and ontologic understanding of the model being decomposed.</p>
<p>Behind the scenes, the printer has phases for constraint unification, merging, normalisation and pruning, symbolic evaluation, and much more - all of it is user-extensible and customizable.</p>
<p>All it takes to start reaping the benefits is to install the default pretty printer:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-16" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="o">#</span><span class="n">install_printer</span> <span class="nn">Region_pp</span><span class="p">.</span><span class="n">print</span><span class="o">;;</span>

<span class="n">first_path_regions</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : Top_result.modular_region list =
[---[region]---
 Constraints:
   [  ]
 Invariant:
   F = Model.{ counter = 0 ; default = 23 }
  -------------;
 ---[region]---
 Constraints:
   [ (List.hd e) is Model.Add
   ; 0 &lt; Destruct(Model.Add, 0, (List.hd e)) &lt;= 9000
   ; (List.tl e) = [] ]
 Invariant:
   F =
   Model.{
     counter = Destruct(Model.Add, 0, (List.hd e))
   ; default = 23
   }
  -------------;
 ---[region]---
 Constraints:
   [ (List.hd e) is Model.Add
   ; (List.hd (List.tl e)) is Model.Add
   ; 0 &lt; Destruct(Model.Add, 0, (List.hd e)) &lt;= 9000
   ; Destruct(Model.Add, 0, (List.hd e)) &lt;&gt; 1337
   ; (Destruct(Model.Add, 0, (List.hd e)) +
        Destruct(Model.Add, 0, (List.hd (List.tl e))))
       &gt; 9000
   ; (List.tl (List.tl e)) = []
   ; Destruct(Model.Add, 0, (List.hd (List.tl e))) &gt; 0 ]
 Invariant:
   F = Model.{ counter = 0 ; default = 23 }
  -------------;
 ---[region]---
 Constraints:
   [ (List.hd (List.tl e)) is Model.Add
   ; (List.hd e) is Model.Add
   ; (List.hd (List.tl (List.tl e))) is Model.Add
   ; Destruct(Model.Add, 0, (List.hd (List.tl e))) &gt; 0
   ; (Destruct(Model.Add, 0, (List.hd e)) +
        Destruct(Model.Add, 0, (List.hd (List.tl e))))
       &gt; 9000
   ; Destruct(Model.Add, 0, (List.hd e)) &lt;&gt; 1337
   ; 0 &lt; Destruct(Model.Add, 0, (List.hd e)) &lt;= 9000
   ; Destruct(Model.Add, 0, (List.hd (List.tl (List.tl e)))) &gt; 9000
   ; (List.tl (List.tl (List.tl e))) = [] ]
 Invariant:
   F = Model.{ counter = 0 ; default = 23 }
  -------------]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can immediately appreciate that just under half the total constraints have been identified as redundant and eliminated.</p>
<p>Let's look at another example:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-18" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="o">#</span><span class="n">logic</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="kt">int</span> <span class="nn">Set</span><span class="p">.</span><span class="n">t</span><span class="o">)</span> <span class="n">y</span> <span class="n">z</span> <span class="o">=</span>
  <span class="k">if</span> <span class="nn">Set</span><span class="p">.</span><span class="n">subset</span> <span class="n">x</span> <span class="n">y</span> <span class="k">then</span>
    <span class="nn">Set</span><span class="p">.</span><span class="n">add</span> <span class="n">z</span> <span class="n">x</span>
  <span class="k">else</span>
    <span class="nn">Set</span><span class="p">.</span><span class="n">add</span> <span class="n">z</span> <span class="o">(</span><span class="nn">Set</span><span class="p">.</span><span class="n">empty</span><span class="o">);;</span>

<span class="o">#</span><span class="n">program</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">d</span> <span class="o">=</span> <span class="nn">Modular_decomp</span><span class="p">.</span><span class="n">top</span> <span class="s2">&quot;f&quot;</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">rs</span> <span class="o">=</span> <span class="nn">Modular_decomposition</span><span class="p">.</span><span class="n">to_region_list</span> <span class="n">d</span> <span class="o">|&gt;</span> <span class="nn">CCList</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="o">_)</span> <span class="o">-&gt;</span> <span class="nn">Modular_decomp</span><span class="p">.</span><span class="n">get_region</span> <span class="n">d</span> <span class="n">i</span><span class="o">);;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val f : int Set.t -&gt; int Set.t -&gt; int -&gt; int Set.t = &lt;fun&gt;
val d : Top_result.modular_decomposition =
  {Imandra_interactive.Modular_decomp.MD.md_session = 2i;
   md_f =
    {Imandra_surface.Uid.name = &#34;f&#34;; id = &lt;abstr&gt;; special_tag = &lt;abstr&gt;;
     namespace = &lt;abstr&gt;;
     chash = Some 5TxglC7SODQbo0rSHeXCN7M4LjjUd1E+ZgVXWZQ6FoA;
     depth = (3i, 2i)};
   md_args = [(x : (int, bool) Map.t); (y : (int, bool) Map.t); (z : int)];
   md_regions = &lt;abstr&gt;}
val rs : Top_result.modular_region list =
  [---[region]---
   Constraints:
     [ not (Set.subset x y) ]
   Invariant:
     F = Set.add z Set.empty
    -------------;
   ---[region]---
   Constraints:
     [ Set.subset x y ]
   Invariant:
     F = Set.add z x
    -------------]
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div class="imandra-alternatives" id="alt-8a486aca-80b5-4acd-9b67-74b764327370"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>Voronoi (2 of 2)</a></li><li class="" data-toggle="tab"><a>Table</a></li></ul><div class="tab-content"><div class="tab-pane active"><div id="decompose-a5b49ba3-4373-45fb-97a5-230e86b77ac1" class="decompose"><textarea class="display-none">{
  &quot;regions&quot;: [
    {
      &quot;constraints&quot;: [ &quot;not (Set.subset x y)&quot; ],
      &quot;region&quot;: {
        &quot;constraints&quot;: [ &quot;not (Set.subset x y)&quot; ],
        &quot;invariant&quot;: &quot;F = Set.add z Set.empty&quot;
      },
      &quot;groups&quot;: [],
      &quot;label&quot;: &quot;2&quot;,
      &quot;weight&quot;: 1
    },
    {
      &quot;constraints&quot;: [ &quot;Set.subset x y&quot; ],
      &quot;region&quot;: {
        &quot;constraints&quot;: [ &quot;Set.subset x y&quot; ],
        &quot;invariant&quot;: &quot;F = Set.add z x&quot;
      },
      &quot;groups&quot;: [],
      &quot;label&quot;: &quot;1&quot;,
      &quot;weight&quot;: 1
    }
  ]
}</textarea><div class="decompose-foamtree"></div><div class="decompose-details"><div class="decompose-details-header">Regions details</div><div class="decompose-details-no-selection"><p>No group selected.</p><ul><li>Concrete regions are numbered</li><li>Unnumbered regions are groups whose children share a particular constraint</li><li>Click on a region to view its details</li><li>Double click on a region to zoom in on it</li><li>Shift+double click to zoom out</li><li>Hit escape to reset back to the top</li></ul></div><div class="decompose-details-selection hidden"><div><span class="decompose-details-label">Direct sub-regions: </span><span class="decompose-details-direct-sub-regions-text">-</span></div><div><span class="decompose-details-label">Contained regions: </span><span class="decompose-details-contained-regions-text">-</span></div><div class="decompose-details-section-header">Constraints</div><div class="decompose-details-constraints"><pre class="decompose-details-constraint">&lt;constraint&gt;</pre></div><div class="decompose-details-invariant"><div class="decompose-details-section-header">Invariant</div><pre class="decompose-details-invariant-text">&lt;invariant&gt;</pre></div></div></div><script>
(function () {
  require(['nbextensions/nbimandra/regions'], function (regions) {
    var target = '#decompose-a5b49ba3-4373-45fb-97a5-230e86b77ac1';
    regions.hydrate(target);
  });
})();
</script></div></div><div class="tab-pane"><div><div>decomp of (f x, y, z<div class="imandra-table" id="table-5648d2b1-05a7-45d3-87d6-fa1f24a00c1b"><table><thead><tr><th>Reg_id</th><th>Constraints</th><th>Invariant</th></tr></thead><tr><td>1</td><td><ul><li><pre>not (Set.subset x y)</pre></li></ul></td><td><pre>Set.add z Set.empty</pre></td></tr><tr><td>0</td><td><ul><li><pre>Set.subset x y</pre></li></ul></td><td><pre>Set.add z x</pre></td></tr></table></div></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-8a486aca-80b5-4acd-9b67-74b764327370';
  alternatives.hydrate(target);
});
</script></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>It seems like <code>Region_pp</code> could do a better job here:</p>
<ul>
<li><code>Set.subset x y</code> is printed as <code>Set.union x y = y</code></li>
<li><code>Set.add x y</code> is printed as <code>Map.add x y true</code></li>
<li><code>Set.add z (Set.empty)</code> is printed as <code>Map.add' (Map.const false) z true</code> instead of using a more desiderable set syntax like <code>{ z }</code></li>
</ul>
<p>Let's use the extension mechanisms of <code>Region_pp</code> to achieve just that:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-20" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">open</span> <span class="nc">Region_pp_intf</span>

<span class="k">module</span> <span class="nc">Custom</span> <span class="o">=</span> <span class="k">struct</span>

  <span class="k">type</span> <span class="n">t</span> <span class="o">=</span>
    <span class="o">|</span> <span class="nc">Set</span> <span class="k">of</span> <span class="n">t</span> <span class="n">node_</span> <span class="kt">list</span>

  <span class="k">let</span> <span class="n">map</span> <span class="n">f</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="nc">Set</span> <span class="n">els</span> <span class="o">-&gt;</span> <span class="nc">Set</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">f</span> <span class="n">els</span><span class="o">)</span>

  <span class="k">let</span> <span class="n">compare</span> <span class="n">compare</span> <span class="n">one</span> <span class="n">two</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">one</span><span class="o">,</span> <span class="n">two</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Set</span> <span class="n">s_one</span><span class="o">,</span> <span class="nc">Set</span> <span class="n">s_two</span> <span class="o">-&gt;</span>
       <span class="k">if</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span> <span class="n">s_one</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">length</span> <span class="n">s_two</span> <span class="o">&amp;&amp;</span>
            <span class="nn">CCList</span><span class="p">.</span><span class="n">for_all</span> <span class="o">(</span><span class="k">fun</span> <span class="n">el</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">exists</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">el</span> <span class="n">x</span> <span class="o">=</span> <span class="nc">Equivalent</span><span class="o">)</span> <span class="n">s_two</span><span class="o">))</span> <span class="n">s_one</span> <span class="k">then</span>
         <span class="nc">Equivalent</span>
       <span class="k">else</span>
         <span class="nc">UnComparable</span>

  <span class="k">let</span> <span class="n">print</span> <span class="n">p</span> <span class="o">~</span><span class="n">focus</span> <span class="n">out</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="nc">Set</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="nn">CCFormat</span><span class="p">.</span><span class="o">(</span><span class="n">fprintf</span> <span class="n">out</span> <span class="s2">&quot;@[&lt;hv&gt;{ %a@ }@]&quot;</span> <span class="o">(</span><span class="kt">list</span> <span class="o">~</span><span class="n">sep</span><span class="o">:(</span><span class="n">return</span> <span class="s2">&quot;@ ; &quot;</span><span class="o">)</span> <span class="n">p</span><span class="o">))</span> <span class="n">s</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nc">PPrinter</span> <span class="o">=</span> <span class="nn">Region_pp</span><span class="p">.</span><span class="nc">Make</span><span class="o">(</span><span class="nc">Custom</span><span class="o">)</span>

<span class="k">open</span> <span class="nc">Custom</span>
<span class="k">open</span> <span class="nc">PPrinter</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">refine_</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Map.add&#39;&quot;</span><span class="o">,</span> <span class="o">_)</span> <span class="k">as</span> <span class="n">ks</span> <span class="k">when</span> <span class="n">is_proper_set</span> <span class="n">ks</span> <span class="o">-&gt;</span>
     <span class="nc">Custom</span> <span class="o">(</span><span class="nc">Set</span> <span class="o">(</span><span class="n">gather_keys</span> <span class="n">ks</span><span class="o">))</span>

  <span class="o">|</span> <span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Map.add&#39;&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">m</span><span class="o">;</span> <span class="n">k</span><span class="o">;</span> <span class="nc">Boolean</span> <span class="bp">true</span><span class="o">])</span> <span class="o">-&gt;</span>
     <span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.add&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">m</span><span class="o">;</span> <span class="n">k</span><span class="o">])</span>

    <span class="c">(* verify (fun x y -&gt; Set.union x y = y ==&gt; Set.subset x y)  *)</span>

  <span class="o">|</span> <span class="nc">Eq</span> <span class="o">(</span><span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.union&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]),</span> <span class="n">z</span><span class="o">)</span> <span class="k">when</span> <span class="nn">Comparator</span><span class="p">.</span><span class="o">(</span><span class="n">is_eq</span> <span class="o">(</span><span class="n">compare</span> <span class="n">y</span> <span class="n">z</span><span class="o">))</span> <span class="o">-&gt;</span>
     <span class="nc">Eq</span> <span class="o">(</span><span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.subset&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]),</span> <span class="nc">Boolean</span> <span class="bp">true</span><span class="o">)</span>

  <span class="o">|</span> <span class="nc">Neq</span> <span class="o">(</span><span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.union&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]),</span> <span class="n">z</span><span class="o">)</span> <span class="k">when</span> <span class="nn">Comparator</span><span class="p">.</span><span class="o">(</span><span class="n">is_eq</span> <span class="o">(</span><span class="n">compare</span> <span class="n">y</span> <span class="n">z</span><span class="o">))</span> <span class="o">-&gt;</span>
     <span class="nc">Eq</span> <span class="o">(</span><span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.subset&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]),</span> <span class="nc">Boolean</span> <span class="bp">false</span><span class="o">)</span>

  <span class="o">|</span> <span class="nc">Eq</span> <span class="o">(</span><span class="n">z</span><span class="o">,</span> <span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.union&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]))</span> <span class="k">when</span> <span class="nn">Comparator</span><span class="p">.</span><span class="o">(</span><span class="n">is_eq</span> <span class="o">(</span><span class="n">compare</span> <span class="n">y</span> <span class="n">z</span><span class="o">))</span> <span class="o">-&gt;</span>
     <span class="nc">Eq</span> <span class="o">(</span><span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.subset&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]),</span> <span class="nc">Boolean</span> <span class="bp">true</span><span class="o">)</span>

  <span class="o">|</span> <span class="nc">Neq</span> <span class="o">(</span><span class="n">z</span><span class="o">,</span> <span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.union&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]))</span> <span class="k">when</span> <span class="nn">Comparator</span><span class="p">.</span><span class="o">(</span><span class="n">is_eq</span> <span class="o">(</span><span class="n">compare</span> <span class="n">y</span> <span class="n">z</span><span class="o">))</span> <span class="o">-&gt;</span>
     <span class="nc">Eq</span> <span class="o">(</span><span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Set.subset&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">x</span><span class="o">;</span><span class="n">y</span><span class="o">]),</span> <span class="nc">Boolean</span> <span class="bp">false</span><span class="o">)</span>

  <span class="o">|</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span>

<span class="ow">and</span> <span class="n">gather_keys</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Map.add&#39;&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">m</span><span class="o">;</span> <span class="n">k</span><span class="o">;</span> <span class="nc">Boolean</span> <span class="bp">true</span><span class="o">])</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">gather_keys</span> <span class="n">m</span>
  <span class="o">|</span> <span class="nc">Funcall</span> <span class="o">(</span><span class="nc">Var</span> <span class="s2">&quot;Map.const&quot;</span><span class="o">,</span> <span class="o">[</span><span class="nc">Boolean</span> <span class="bp">false</span><span class="o">])</span> <span class="o">-&gt;</span> <span class="bp">[]</span>
  <span class="o">|</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">sprintf</span> <span class="s2">&quot;Unexpected set value: %s&quot;</span> <span class="o">(</span><span class="nn">PPrinter</span><span class="p">.</span><span class="nn">Printer</span><span class="p">.</span><span class="n">to_string</span> <span class="n">x</span><span class="o">))</span>

<span class="ow">and</span> <span class="n">is_proper_set</span> <span class="n">x</span> <span class="o">=</span>
  <span class="k">try</span> <span class="n">ignore</span><span class="o">(</span><span class="n">gather_keys</span> <span class="n">x</span><span class="o">);</span> <span class="bp">true</span> <span class="k">with</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">false</span>

<span class="k">let</span> <span class="n">refine</span> <span class="n">ast</span> <span class="o">=</span> <span class="nn">XF</span><span class="p">.</span><span class="n">walk_fix</span> <span class="n">refine_</span> <span class="n">ast</span> <span class="o">|&gt;</span> <span class="nn">CCList</span><span class="p">.</span><span class="n">return</span>

<span class="k">let</span> <span class="n">print</span> <span class="o">=</span> <span class="nn">PPrinter</span><span class="p">.</span><span class="n">print</span> <span class="o">~</span><span class="n">refine</span> <span class="bp">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>module Custom :
  sig
    type t = Set of t node_ list
    val map : (t node_ -&gt; t node_) -&gt; t -&gt; t
    val compare : (t node_ -&gt; t node_ -&gt; comparison) -&gt; t -&gt; t -&gt; comparison
    val print :
      t node_ CCFormat.printer -&gt; focus:&#39;a -&gt; Format.formatter -&gt; t -&gt; unit
  end
module PPrinter :
  sig
    type custom = PPrinter.custom
    type node = custom node_
    module XF :
      sig
        val map : (node -&gt; node) -&gt; node -&gt; node
        val walk : pre:(node -&gt; node) -&gt; ?post:(node -&gt; node) -&gt; node -&gt; node
        val fix_ : ?bound:int/2 -&gt; (&#39;a -&gt; &#39;a) -&gt; &#39;a -&gt; &#39;a -&gt; &#39;a
        val fix : ?bound:int/2 -&gt; (&#39;a -&gt; &#39;a) -&gt; &#39;a -&gt; &#39;a
        val walk_fix : ?bound:int/2 -&gt; (node -&gt; node) -&gt; node -&gt; node
        val iterated : unit -&gt; &#39;a
        val iter : f:(node -&gt; unit) -&gt; node -&gt; unit
        val exists : f:(node -&gt; bool) -&gt; node -&gt; bool
      end
    val vars : node -&gt; string list
    val has_symbolic_term : node -&gt; bool
    module Printer :
      sig
        val print :
          ?p:(node CCFormat.printer -&gt;
              Format.formatter -&gt; node -&gt; unit option) -&gt;
          ?focus:string -&gt; unit -&gt; node CCFormat.printer
        val to_string :
          ?p:(node CCFormat.printer -&gt;
              Format.formatter -&gt; node -&gt; unit option) -&gt;
          ?focus:string -&gt; node -&gt; string
      end
    module Comparator :
      sig
        val is_eq : comparison -&gt; bool
        val compare : node -&gt; node -&gt; comparison
        val compare_all : node list -&gt; node list -&gt; comparison
      end
    module Simplifier : sig val simplify : node -&gt; node end
    module Unifier :
      sig
        type unifier = node -&gt; node -&gt; node option
        val unify : ?unify:unifier -&gt; node list -&gt; node list
      end
    module Parser : sig val parse : Term.term -&gt; node option end
    module Compactor : sig val compact : node list -&gt; node list end
    type refiner = node -&gt; node list
    type pprinter =
        ?unify:Unifier.unifier -&gt;
        ?refine:refiner -&gt; ?inv:bool -&gt; Term.term list -&gt; node list
    val pp : pprinter
    val print :
      ?pp:pprinter -&gt;
      ?unify:Unifier.unifier -&gt;
      ?refine:refiner -&gt;
      ?print:(node CCFormat.printer -&gt;
              Format.formatter -&gt; node -&gt; unit option) -&gt;
      ?skip_invariant:bool -&gt;
      ?focus:string -&gt;
      unit -&gt; Format.formatter -&gt; Top_result.modular_region -&gt; unit
    val to_string :
      ?unify:Unifier.unifier -&gt;
      ?refine:refiner -&gt; Top_result.modular_region -&gt; string
  end
val refine_ : custom node_ -&gt; custom node_ = &lt;fun&gt;
val gather_keys : custom node_ -&gt; custom node_ list = &lt;fun&gt;
val is_proper_set : custom node_ -&gt; bool = &lt;fun&gt;
val refine : node -&gt; node list = &lt;fun&gt;
val print : Format.formatter -&gt; Top_result.modular_region -&gt; unit = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's look at what we've done:</p>
<ul>
<li>first we've defined a <code>Custom</code> module whose signature includes the signature of <code>Region_pp_intf.SIG</code>, defining <code>map</code>ping, <code>print</code>ing and <code>compare</code>ing functions for an abstract <code>Set</code> value</li>
<li>next we instantiate <code>Region_pp.Make</code> using this <code>Custom</code> module, creating a <code>PPrinter</code> module that is <code>Set</code>-aware</li>
<li>finally we define a <code>refine</code> function that transforms a <code>PPrinter.node</code> into custom <code>Set</code> values or converts <code>Map.</code> invocations into appropriate <code>Set.</code> ones.</li>
</ul>
<p>Let's install this printer and look at the regions again:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-22" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="o">#</span><span class="n">install_printer</span> <span class="n">print</span><span class="o">;;</span>
<span class="n">rs</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : Top_result.modular_region list =
[---[region]---
 Constraints:
   [ not (Set.subset x y) ]
 Invariant:
   F = Set.add z Set.empty
  -------------;
 ---[region]---
 Constraints:
   [ Set.subset x y ]
 Invariant:
   F = Set.add z x
  -------------]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Great! Exactly what we wanted to be printed.</p>
<p><code>Region_pp</code> provides more extension hooks and utilities than just the <code>PP</code> functor and <code>~refine</code>, but we'll go over that in more detail in a dedicated notebook.</p>
<p>Let's explore the next <code>imandra-tools</code> module</p>
<h1 id="Region-Term-Synthesizer-(Region_term_synth)">Region Term Synthesizer (Region_term_synth)<a class="anchor-link" href="#Region-Term-Synthesizer-(Region_term_synth)">&#182;</a></h1><p><code>Imandra</code>'s ability to both reify failed proofs into counter-examples and sample values from regions provides a lot of power. <code>Region_term_synth</code> extends this power, allowing <code>Imandra</code> to synthesize any region's <code>Term</code> expression as code.</p>
<p>This, combined with <code>Imandra</code>'s decomposition facilities, allow us to generate powerful and complete regression test suites, analyse existing test suites to detect region coverage, and much more.</p>
<p>Let's see a quick example of how this works in practice:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-24" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="nn">Caml</span><span class="p">.</span><span class="nn">List</span><span class="p">.</span><span class="n">mapi</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="n">region</span> <span class="o">-&gt;</span>
  <span class="k">let</span> <span class="n">gs</span> <span class="o">=</span> <span class="s2">&quot;region_&quot;</span> <span class="o">^</span> <span class="o">(</span><span class="n">string_of_int</span> <span class="n">i</span><span class="o">)</span> <span class="k">in</span> <span class="c">(* Imandra_util.Util.gensym () *)</span>
  <span class="k">let</span> <span class="n">term</span> <span class="o">=</span> <span class="nn">Term</span><span class="p">.</span><span class="n">and_l</span> <span class="o">@@</span> <span class="nn">Modular_region</span><span class="p">.</span><span class="n">constraints</span> <span class="n">region</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">body</span> <span class="o">=</span> <span class="nn">Region_term_synth</span><span class="p">.</span><span class="n">synthesize</span> <span class="o">~</span><span class="n">default</span><span class="o">:</span><span class="nn">Term</span><span class="p">.</span><span class="nn">Syn</span><span class="p">.</span><span class="nc">False</span> <span class="n">term</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">args</span> <span class="o">=</span> <span class="nn">Modular_region</span><span class="p">.</span><span class="n">args</span> <span class="n">region</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Var</span><span class="p">.</span><span class="n">name</span> <span class="o">|&gt;</span> <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot; &quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">func</span> <span class="o">=</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">sprintf</span> <span class="s2">&quot;let %s %s = %s&quot;</span> <span class="n">gs</span> <span class="n">args</span> <span class="n">body</span> <span class="k">in</span>
  <span class="nn">System</span><span class="p">.</span><span class="n">eval</span> <span class="n">func</span><span class="o">;</span>
  <span class="n">gs</span><span class="o">)</span>
  <span class="n">rs</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val region_0 : &#39;a Set.t -&gt; &#39;a Set.t -&gt; &#39;b -&gt; bool = &lt;fun&gt;
val region_1 : &#39;a Set.t -&gt; &#39;a Set.t -&gt; &#39;b -&gt; bool = &lt;fun&gt;
- : string list = [&#34;region_0&#34;; &#34;region_1&#34;]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The above should be quite straightforward:</p>
<ul>
<li>We extract the constraints from the region and we conjoin them into a single <code>Term</code></li>
<li>We ask <code>Region_term_synth</code> to synthesize our term, using <code>false</code> as a default value (we're synthesizing a boolean function)</li>
<li>Finally we generate a string representation of a function using the synthesized term as its body, and evaluate it</li>
</ul>
<p>We can start playing with those functions immediately:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-26" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">region_0</span> <span class="o">(</span><span class="nn">Set</span><span class="p">.</span><span class="n">of_list</span> <span class="o">[</span><span class="mi">1</span><span class="o">])</span> <span class="nn">Set</span><span class="p">.</span><span class="n">empty</span> <span class="mi">0</span><span class="o">;;</span>
<span class="n">region_0</span> <span class="nn">Set</span><span class="p">.</span><span class="n">empty</span> <span class="o">(</span><span class="nn">Set</span><span class="p">.</span><span class="n">of_list</span> <span class="o">[</span><span class="mi">1</span><span class="o">])</span> <span class="mi">0</span><span class="o">;;</span>

<span class="n">region_1</span> <span class="nn">Set</span><span class="p">.</span><span class="n">empty</span> <span class="o">(</span><span class="nn">Set</span><span class="p">.</span><span class="n">of_list</span> <span class="o">[</span><span class="mi">1</span><span class="o">])</span> <span class="mi">0</span><span class="o">;;</span>
<span class="n">region_1</span> <span class="o">(</span><span class="nn">Set</span><span class="p">.</span><span class="n">of_list</span> <span class="o">[</span><span class="mi">1</span><span class="o">])</span> <span class="nn">Set</span><span class="p">.</span><span class="n">empty</span> <span class="mi">0</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : bool = true
- : bool = false
- : bool = true
- : bool = false
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Great! <code>region_0</code> is now a boolean function that checks whether or not certain values of <code>x</code> and <code>y</code> belong to the region of behaviour 0. <code>region_1</code> does the same for the region of behaviour 1.</p>
<p>This ability to generate <em>total</em> functions from <em>partial regions of behaviour</em> is fundamental to creating modules like <code>Idf</code> and <code>Region_idx</code>.</p>
<h1 id="Region-Indexer-(Region_idx)">Region Indexer (Region_idx)<a class="anchor-link" href="#Region-Indexer-(Region_idx)">&#182;</a></h1><p>It may be sometimes useful to know which region a particular input belongs to; while this can be done by using <code>Region_term_synth</code> and synthesizing recogniser functions for each region and testing them against the value until we find a match, this could get very computationally expensive in the presence of a large number of regions and constraints.</p>
<p><code>Region_idx</code> provides a solution for this: it allows to create "indexing" functions that efficiently match input values against a single entry in a list of regions.
After providing a first class module specificing the types of the arguments to the function the regions belong to (as a tuple), <code>Region_idx.indexer_for</code> returns an index alist and an indexer function.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-28" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">idx</span><span class="o">,</span> <span class="n">indexer</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">args</span> <span class="o">=</span> <span class="o">(</span><span class="k">module</span> <span class="k">struct</span> <span class="k">type</span> <span class="n">args</span> <span class="o">=</span> <span class="kt">int</span> <span class="nn">Set</span><span class="p">.</span><span class="n">t</span> <span class="o">*</span> <span class="kt">int</span> <span class="nn">Set</span><span class="p">.</span><span class="n">t</span> <span class="o">*</span> <span class="kt">int</span> <span class="k">end</span> <span class="o">:</span> <span class="nn">Region_idx</span><span class="p">.</span><span class="nc">Args</span> <span class="k">with</span> <span class="k">type</span> <span class="n">args</span> <span class="o">=</span> <span class="o">_)</span> <span class="k">in</span>
  <span class="nn">Region_idx</span><span class="p">.</span><span class="n">indexer_for</span> <span class="n">args</span> <span class="n">rs</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val g___1 : &#39;a Set.t -&gt; &#39;a Set.t -&gt; &#39;b -&gt; int/2 = &lt;fun&gt;
- : unit = ()
val idx : (int/2 * Top_result.modular_region) list =
  [(0i,
    ---[region]---
    Constraints:
      [ not (Set.subset x y) ]
    Invariant:
      F = Set.add z Set.empty
     -------------);
   (1i,
    ---[region]---
    Constraints:
      [ Set.subset x y ]
    Invariant:
      F = Set.add z x
     -------------)]
val indexer : int/1 Set.t * int/1 Set.t * int/1 -&gt; int/2 = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The first value returned is an alist of index -&gt; region, while the second value is the indexer function, taking as inputs the arguments of the regions (as a tuple) and returning the index of the matching region, or raising <code>Not_found</code> if the values don't match any regions (This can happen if the values provided don't satisfy the side condition, or if the list of regions passed to <code>indexer_for</code> was partial).</p>
<p>Let's say we want to know which region the arguments <code>Set.empty, (Set.of_list [1]), 0</code> belong to, we just need to find its index and find the matching region:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-30" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexer</span> <span class="o">(</span><span class="nn">Set</span><span class="p">.</span><span class="n">empty</span><span class="o">,</span> <span class="o">(</span><span class="nn">Set</span><span class="p">.</span><span class="n">of_list</span> <span class="o">[</span><span class="mi">1</span><span class="o">]),</span> <span class="mi">0</span><span class="o">)</span> <span class="k">in</span>
  <span class="nn">CCList</span><span class="p">.</span><span class="n">assq</span> <span class="n">i</span> <span class="n">idx</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : Top_result.modular_region =
---[region]---
Constraints:
  [ Set.subset x y ]
Invariant:
  F = Set.add z x
 -------------
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Region-Probabilities-(Region_probs)">Region Probabilities (Region_probs)<a class="anchor-link" href="#Region-Probabilities-(Region_probs)">&#182;</a></h1><p>What if we want to not just identify the distinct regions of a program's behaviour, but how likely those behaviours are to occur? The <code>Region_probs</code> module allows us to do just that. In particular, users can easily create custom hierarchical statistical models defining joint distributions over inputs to their programs or functions, then sample from these models to get a probability distribution over regions, or query them with Boolean conditions. Alternatively, a dataset in the form of a <code>CSV</code> file can be imported and used as a set of samples when the underlying distribution is unknown. This introduction contains a short example, but for a more detailed tutorial of how to use the module, please see the dedicated <a href="/imandra-docs/notebooks/region-probabilities/">Region Probabilities notebook</a>.</p>
<p>First we'll open the <code>Region_probs</code> module, then define some custom types and a function that we'll be decomposing:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-32" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="o">#</span><span class="n">logic</span><span class="o">;;</span>
<span class="k">open</span> <span class="nc">Region_probs</span><span class="o">;;</span>

<span class="k">type</span> <span class="n">colour</span> <span class="o">=</span> <span class="nc">Red</span> <span class="o">|</span> <span class="nc">Green</span> <span class="o">|</span> <span class="nc">Blue</span><span class="o">;;</span>
<span class="k">type</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">{</span><span class="n">colour</span> <span class="o">:</span> <span class="n">colour</span><span class="o">;</span> <span class="n">broken</span> <span class="o">:</span> <span class="kt">bool</span><span class="o">};;</span>
<span class="k">type</span> <span class="n">dom</span> <span class="o">=</span> <span class="o">(</span><span class="n">obj</span> <span class="o">*</span> <span class="nn">Q</span><span class="p">.</span><span class="n">t</span> <span class="o">*</span> <span class="nn">Z</span><span class="p">.</span><span class="n">t</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">f&#39;</span> <span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">temp</span><span class="o">,</span> <span class="n">num</span><span class="o">)</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">a</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="nc">Red</span> <span class="k">then</span>
      <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">broken</span> <span class="k">then</span> <span class="n">num</span> <span class="k">else</span> <span class="mi">7</span>
    <span class="k">else</span>
      <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">b</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;.</span> <span class="mi">18</span><span class="o">.</span><span class="mi">5</span> <span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="nc">Blue</span> <span class="k">then</span>
      <span class="n">temp</span> <span class="o">+.</span> <span class="mi">4</span><span class="o">.</span><span class="mi">3</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="nc">Green</span> <span class="k">then</span>
      <span class="n">temp</span> <span class="o">-.</span> <span class="mi">7</span><span class="o">.</span><span class="mi">8</span>
    <span class="k">else</span>
      <span class="mi">14</span><span class="o">.</span><span class="mi">1</span> <span class="k">in</span>
  <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type colour = Red | Green | Blue
type obj = { colour : colour; broken : bool; }
type dom = obj * real * int
val f&#39; : obj * real * int -&gt; int * real = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we can define a joint distribution over inputs to <code>f</code> using some built-in probability distributions and a sequential sampling procedure. We can call this function with the unit argument <code>()</code> to generate samples:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-34" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">distribution</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">c</span> <span class="o">=</span> <span class="n">categorical</span> <span class="o">~</span><span class="n">classes</span><span class="o">:[</span><span class="nc">Red</span><span class="o">;</span> <span class="nc">Green</span><span class="o">;</span> <span class="nc">Blue</span><span class="o">]</span> <span class="o">~</span><span class="n">probs</span><span class="o">:[</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="o">;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="o">]</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="n">bernoulli</span> <span class="o">~</span><span class="n">p</span><span class="o">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">4</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">mu</span> <span class="o">=</span> <span class="k">if</span> <span class="n">b</span> <span class="k">then</span> <span class="mi">20</span><span class="o">.</span> <span class="k">else</span> <span class="mi">10</span><span class="o">.</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">gaussian</span> <span class="o">~</span><span class="n">mu</span> <span class="o">~</span><span class="n">sigma</span><span class="o">:</span><span class="mi">5</span><span class="o">.</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">num</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">Green</span> <span class="k">then</span>
      <span class="n">poisson</span> <span class="o">~</span><span class="n">lambda</span><span class="o">:</span><span class="mi">6</span><span class="o">.</span><span class="mi">5</span> <span class="o">~</span><span class="n">constraints</span><span class="o">:[(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">10</span><span class="o">)]</span> <span class="bp">()</span>
    <span class="k">else</span>
      <span class="n">poisson</span> <span class="o">~</span><span class="n">lambda</span><span class="o">:</span><span class="mi">6</span><span class="o">.</span><span class="mi">5</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="o">({</span><span class="n">colour</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span> <span class="n">broken</span> <span class="o">=</span> <span class="n">b</span><span class="o">},</span> <span class="n">temp</span><span class="o">,</span> <span class="n">num</span><span class="o">)</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>

<span class="n">distribution</span> <span class="bp">()</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val distribution : unit -&gt; obj * real * int = &lt;fun&gt;
- : obj * real * int =
({colour = Red; broken = false}, 3692047287333181/281474976710656, 5)
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we have all these components we can find the regions of <code>f</code>, create a model from our <code>distribution</code> function, then estimate and display region probabilities:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Imandra-tools%20Introduction.ipynb%23try-cell-36" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">d</span> <span class="o">=</span> <span class="nn">Modular_decomp</span><span class="p">.</span><span class="n">top</span> <span class="o">~</span><span class="n">prune</span><span class="o">:</span><span class="bp">true</span> <span class="s2">&quot;f&#39;&quot;</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>

<span class="k">let</span> <span class="n">regions</span> <span class="o">=</span> <span class="nn">Modular_decomp</span><span class="p">.</span><span class="n">get_regions</span> <span class="n">d</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>

<span class="k">module</span> <span class="nc">Example</span> <span class="o">=</span> <span class="nn">Distribution</span><span class="p">.</span><span class="nc">From_Sampler</span> <span class="o">(</span><span class="k">struct</span> <span class="k">type</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span> <span class="k">let</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">distribution</span> <span class="k">end</span><span class="o">)</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>

<span class="k">let</span> <span class="n">probs</span> <span class="o">=</span> <span class="nn">Example</span><span class="p">.</span><span class="n">get_probs</span> <span class="n">regions</span> <span class="bp">()</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>

<span class="n">print_probs</span> <span class="n">probs</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val d : Top_result.modular_decomposition =
  {Imandra_interactive.Modular_decomp.MD.md_session = 3i;
   md_f =
    {Imandra_surface.Uid.name = &#34;f&#39;&#34;; id = &lt;abstr&gt;; special_tag = &lt;abstr&gt;;
     namespace = &lt;abstr&gt;;
     chash = Some YFaICL9zUmzK01GcQMEnt6tJme/GNl9xF9eRBwCjBBM;
     depth = (3i, 3i)};
   md_args = [(_x : (obj * real * int))]; md_regions = &lt;abstr&gt;}
val regions : Top_result.modular_region list =
  [---[region]---
   Constraints:
     [ _x[0].colour is Blue
     ; _x[1] &lt;= 37/2 ]
   Invariant:
     F = ((_x[2] * 2), 141/10)
    -------------;
   ---[region]---
   Constraints:
     [ _x[0].colour is Green
     ; _x[1] &lt;= 37/2 ]
   Invariant:
     F = ((_x[2] * 2), (_x[1] - 39/5))
    -------------;
   ---[region]---
   Constraints:
     [ _x[0].colour is Green
     ; _x[1] &gt; 37/2 ]
   Invariant:
     F = ((_x[2] * 2), (_x[1] - 39/5))
    -------------;
   ---[region]---
   Constraints:
     [ _x[0].colour is Blue
     ; _x[1] &gt; 37/2 ]
   Invariant:
     F = ((_x[2] * 2), (_x[1] + 43/10))
    -------------;
   ---[region]---
   Constraints:
     [ _x[0].colour is Red
     ; _x[1] &lt;= 37/2
     ; not _x[0].broken ]
   Invariant:
     F = (7, 141/10)
    -------------;
   ---[region]---
   Constraints:
     [ _x[0].colour is Red
     ; _x[1] &gt; 37/2
     ; not _x[0].broken ]
   Invariant:
     F = (7, 141/10)
    -------------;
   ---[region]---
   Constraints:
     [ _x[0].colour is Red
     ; _x[1] &lt;= 37/2
     ; _x[0].broken ]
   Invariant:
     F = (_x[2], 141/10)
    -------------;
   ---[region]---
   Constraints:
     [ _x[0].colour is Red
     ; _x[1] &gt; 37/2
     ; _x[0].broken ]
   Invariant:
     F = (_x[2], 141/10)
    -------------]
module Example :
  sig
    type domain = dom
    val get_probs :
      Top_result.modular_region list -&gt;
      ?assuming:string -&gt;
      ?n:int/1 -&gt;
      ?d:string -&gt;
      ?step_function:(dom -&gt; dom) -&gt;
      ?num_steps:int/1 -&gt;
      unit -&gt; (int/2, float * Top_result.modular_region) Hashtbl.t
    val query :
      (dom -&gt; bool) -&gt;
      ?n:int -&gt;
      ?d:string -&gt; ?max_std_err:real -&gt; ?precision:int -&gt; unit -&gt; unit
    val save : string -&gt; ?n:int -&gt; ?d:dom list -&gt; unit -&gt; unit
    val load : string -&gt; dom list
  end
val g___19 : obj * real * &#39;a -&gt; int/2 = &lt;fun&gt;
- : unit = ()
val probs : (int/2, float * Top_result.modular_region) Hashtbl.t = &lt;abstr&gt;
Region   Probability
6        0.0733
2        0.0516
7        0.1292
3        0.0817
5        0.0141
4        0.2905
0        0.2147
1        0.1449

- : unit = ()
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div class="imandra-alternatives" id="alt-1e2c2e6f-42dd-4563-8bd8-5bb9c4716ad3"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>Voronoi (8 of 8)</a></li><li class="" data-toggle="tab"><a>Table</a></li></ul><div class="tab-content"><div class="tab-pane active"><div id="decompose-606fbe50-131b-4741-b957-0361975fcd53" class="decompose"><textarea class="display-none">{
  &quot;regions&quot;: [
    {
      &quot;constraints&quot;: [ &quot;_x[1] &gt; 37/2&quot; ],
      &quot;region&quot;: null,
      &quot;groups&quot;: [
        {
          &quot;constraints&quot;: [ &quot;_x[1] &gt; 37/2&quot;, &quot;_x[0].colour is Green&quot; ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [ &quot;_x[0].colour is Green&quot;, &quot;_x[1] &gt; 37/2&quot; ],
            &quot;invariant&quot;: &quot;F = ((_x[2] * 2), (_x[1] - 39/5))&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;2&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [ &quot;_x[1] &gt; 37/2&quot;, &quot;_x[0].colour is Blue&quot; ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [ &quot;_x[0].colour is Blue&quot;, &quot;_x[1] &gt; 37/2&quot; ],
            &quot;invariant&quot;: &quot;F = ((_x[2] * 2), (_x[1] + 43/10))&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;1&quot;,
          &quot;weight&quot;: 1
        }
      ],
      &quot;label&quot;: &quot;&quot;,
      &quot;weight&quot;: 2
    },
    {
      &quot;constraints&quot;: [ &quot;_x[1] &lt;= 37/2&quot; ],
      &quot;region&quot;: null,
      &quot;groups&quot;: [
        {
          &quot;constraints&quot;: [ &quot;_x[1] &lt;= 37/2&quot;, &quot;_x[0].colour is Green&quot; ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [ &quot;_x[0].colour is Green&quot;, &quot;_x[1] &lt;= 37/2&quot; ],
            &quot;invariant&quot;: &quot;F = ((_x[2] * 2), (_x[1] - 39/5))&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;2.2&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [ &quot;_x[1] &lt;= 37/2&quot;, &quot;_x[0].colour is Blue&quot; ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [ &quot;_x[0].colour is Blue&quot;, &quot;_x[1] &lt;= 37/2&quot; ],
            &quot;invariant&quot;: &quot;F = ((_x[2] * 2), 141/10)&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;2.1&quot;,
          &quot;weight&quot;: 1
        }
      ],
      &quot;label&quot;: &quot;&quot;,
      &quot;weight&quot;: 2
    },
    {
      &quot;constraints&quot;: [ &quot;_x[0].colour is Red&quot; ],
      &quot;region&quot;: null,
      &quot;groups&quot;: [
        {
          &quot;constraints&quot;: [
            &quot;_x[0].colour is Red&quot;, &quot;_x[1] &gt; 37/2&quot;, &quot;not _x[0].broken&quot;
          ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [
              &quot;_x[0].colour is Red&quot;, &quot;_x[1] &gt; 37/2&quot;, &quot;not _x[0].broken&quot;
            ],
            &quot;invariant&quot;: &quot;F = (7, 141/10)&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;1.3.1&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [
            &quot;_x[0].colour is Red&quot;, &quot;_x[1] &lt;= 37/2&quot;, &quot;not _x[0].broken&quot;
          ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [
              &quot;_x[0].colour is Red&quot;, &quot;_x[1] &lt;= 37/2&quot;, &quot;not _x[0].broken&quot;
            ],
            &quot;invariant&quot;: &quot;F = (7, 141/10)&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;1.2.1&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [ &quot;_x[0].colour is Red&quot;, &quot;_x[0].broken&quot; ],
          &quot;region&quot;: null,
          &quot;groups&quot;: [
            {
              &quot;constraints&quot;: [
                &quot;_x[0].colour is Red&quot;, &quot;_x[0].broken&quot;, &quot;_x[1] &gt; 37/2&quot;
              ],
              &quot;region&quot;: {
                &quot;constraints&quot;: [
                  &quot;_x[0].colour is Red&quot;, &quot;_x[1] &gt; 37/2&quot;, &quot;_x[0].broken&quot;
                ],
                &quot;invariant&quot;: &quot;F = (_x[2], 141/10)&quot;
              },
              &quot;groups&quot;: [],
              &quot;label&quot;: &quot;1.1.2&quot;,
              &quot;weight&quot;: 1
            },
            {
              &quot;constraints&quot;: [
                &quot;_x[0].colour is Red&quot;, &quot;_x[0].broken&quot;, &quot;_x[1] &lt;= 37/2&quot;
              ],
              &quot;region&quot;: {
                &quot;constraints&quot;: [
                  &quot;_x[0].colour is Red&quot;, &quot;_x[1] &lt;= 37/2&quot;, &quot;_x[0].broken&quot;
                ],
                &quot;invariant&quot;: &quot;F = (_x[2], 141/10)&quot;
              },
              &quot;groups&quot;: [],
              &quot;label&quot;: &quot;1.1.1&quot;,
              &quot;weight&quot;: 1
            }
          ],
          &quot;label&quot;: &quot;&quot;,
          &quot;weight&quot;: 2
        }
      ],
      &quot;label&quot;: &quot;&quot;,
      &quot;weight&quot;: 4
    }
  ]
}</textarea><div class="decompose-foamtree"></div><div class="decompose-details"><div class="decompose-details-header">Regions details</div><div class="decompose-details-no-selection"><p>No group selected.</p><ul><li>Concrete regions are numbered</li><li>Unnumbered regions are groups whose children share a particular constraint</li><li>Click on a region to view its details</li><li>Double click on a region to zoom in on it</li><li>Shift+double click to zoom out</li><li>Hit escape to reset back to the top</li></ul></div><div class="decompose-details-selection hidden"><div><span class="decompose-details-label">Direct sub-regions: </span><span class="decompose-details-direct-sub-regions-text">-</span></div><div><span class="decompose-details-label">Contained regions: </span><span class="decompose-details-contained-regions-text">-</span></div><div class="decompose-details-section-header">Constraints</div><div class="decompose-details-constraints"><pre class="decompose-details-constraint">&lt;constraint&gt;</pre></div><div class="decompose-details-invariant"><div class="decompose-details-section-header">Invariant</div><pre class="decompose-details-invariant-text">&lt;invariant&gt;</pre></div></div></div><script>
(function () {
  require(['nbextensions/nbimandra/regions'], function (regions) {
    var target = '#decompose-606fbe50-131b-4741-b957-0361975fcd53';
    regions.hydrate(target);
  });
})();
</script></div></div><div class="tab-pane"><div><div>decomp of (f' _x<div class="imandra-table" id="table-255673ad-14e5-4319-8067-9c4cc8a24b14"><table><thead><tr><th>Reg_id</th><th>Constraints</th><th>Invariant</th></tr></thead><tr><td>7</td><td><ul><li><pre>not (_x.0.colour = Green)</pre></li><li><pre>not (_x.1 &gt;. 37/2)</pre></li><li><pre>not (_x.0.colour = Red)</pre></li></ul></td><td><pre>(_x.2 * 2, 141/10)</pre></td></tr><tr><td>6</td><td><ul><li><pre>_x.0.colour = Green</pre></li><li><pre>not (_x.1 &gt;. 37/2)</pre></li><li><pre>not (_x.0.colour = Red)</pre></li></ul></td><td><pre>(_x.2 * 2, _x.1 -. 39/5)</pre></td></tr><tr><td>5</td><td><ul><li><pre>_x.0.colour = Green</pre></li><li><pre>not (_x.0.colour = Blue)</pre></li><li><pre>_x.1 &gt;. 37/2</pre></li><li><pre>not (_x.0.colour = Red)</pre></li></ul></td><td><pre>(_x.2 * 2, _x.1 -. 39/5)</pre></td></tr><tr><td>4</td><td><ul><li><pre>_x.0.colour = Blue</pre></li><li><pre>_x.1 &gt;. 37/2</pre></li><li><pre>not (_x.0.colour = Red)</pre></li></ul></td><td><pre>(_x.2 * 2, _x.1 +. 43/10)</pre></td></tr><tr><td>3</td><td><ul><li><pre>not (_x.0.colour = Green)</pre></li><li><pre>not (_x.1 &gt;. 37/2)</pre></li><li><pre>not _x.0.broken</pre></li><li><pre>_x.0.colour = Red</pre></li></ul></td><td><pre>(7, 141/10)</pre></td></tr><tr><td>2</td><td><ul><li><pre>not (_x.0.colour = Green)</pre></li><li><pre>not (_x.0.colour = Blue)</pre></li><li><pre>_x.1 &gt;. 37/2</pre></li><li><pre>not _x.0.broken</pre></li><li><pre>_x.0.colour = Red</pre></li></ul></td><td><pre>(7, 141/10)</pre></td></tr><tr><td>1</td><td><ul><li><pre>not (_x.0.colour = Green)</pre></li><li><pre>not (_x.1 &gt;. 37/2)</pre></li><li><pre>_x.0.broken</pre></li><li><pre>_x.0.colour = Red</pre></li></ul></td><td><pre>(_x.2, 141/10)</pre></td></tr><tr><td>0</td><td><ul><li><pre>not (_x.0.colour = Green)</pre></li><li><pre>not (_x.0.colour = Blue)</pre></li><li><pre>_x.1 &gt;. 37/2</pre></li><li><pre>_x.0.broken</pre></li><li><pre>_x.0.colour = Red</pre></li></ul></td><td><pre>(_x.2, 141/10)</pre></td></tr></table></div></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-1e2c2e6f-42dd-4563-8bd8-5bb9c4716ad3';
  alternatives.hydrate(target);
});
</script></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To see more of what can be done with the <code>Region_probs</code> module, including forming models based on existing datasets and querying models using Boolean conditions, along with additional options, please see the <a href="/imandra-docs/notebooks/region-probabilities/">Region Probabilities notebook</a>.</p>
</div>
</div>
</div>
                    </div>
                </article>
            </main>
            <footer class="footer">
                <a class="copyrights"href="http://imandra.ai">&#9400; 2018 - 2020 Imandra Inc. All rights reserved.</a>
            </footer>
        </div>
    
 


    <script>
    (function () {
            var lastId;
            var sideMenu = $("#side-nav-menu");
            var topMenu = $("#top-menu");
            var topMenuHeight = topMenu.outerHeight() + 15;

            // All list items
            var menuItems = sideMenu.find('a.side__nav-link--within-page');

            // Anchors corresponding to menu items
            var scrollItems = menuItems.map(function () {
              var item = $(this).attr("href");
              var thisItem = item.substring(item.lastIndexOf("#") + 1, item.length);
              var linkedItem = $('#' + CSS.escape(thisItem));
              if (linkedItem.length) { return linkedItem; }
            });

            // Bind to scroll
            $(window).scroll(function () {
                // Get container scroll position
                var fromTop = $(this).scrollTop() + topMenuHeight;;
                // Get id of current scroll item
                var cur = scrollItems.map(function () {
                    if ($(this).offset().top < fromTop)
                        return this;
                });
                cur = cur[cur.length - 1];
                // Get the id of the current element
                var id = cur && cur.length ? cur[0].id : "";
                if (id && lastId !== id) {
                    lastId = id;
                    // Set/remove active class
                    menuItems.each(function (idx, item) {
                    var $item = $(item);
                    $item.removeClass("side__nav-link--within-page--active");

                    if (item.href.endsWith('#' + lastId)) {
                        $item.addClass("side__nav-link--within-page--active");
                    };
                    });
                }
            });
        })()
    </script>
    <script type="text/javascript"> docsearch({
      apiKey: 'ff3a61a82b58783e62ebfbf51e50b0bc',
      indexName: 'imandra',
      inputSelector: '#search',
      debug: false // Set debug to true if you want to inspect the dropdown
    });
    </script>

    </body>
</html>
