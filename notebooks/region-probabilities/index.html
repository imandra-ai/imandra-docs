<!DOCTYPE html>
<html>
    <head><meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Imandra Documentation - Region Probabilities</title>
        <meta property="og:url" content="https://docs.imandra.ai/imandra-docs/notebooks/region-probabilities/">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Imandra Documentation - Region Probabilities">
        <meta property="og:description" content="Estimating Region Probabilities from Statistical Models and Datasets">
        <meta property="og:image" content="https://storage.googleapis.com/imandra-assets/images/og_image_default_i78.jpg">


        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116937440-6"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-116937440-1');
        </script>
        <script type="text/javascript"> var sc_project=11767520; var sc_invisible=1; var sc_security="fa7e88d1"; </script>
        <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
        <noscript><div class="statcounter">
            <a title="Web Analytics" href="http://statcounter.com/" target="_blank">
                <img class="statcounter" src="//c.statcounter.com/11767520/0/fa7e88d1/1/" alt="Web Analytics"></a>
        </div></noscript>
        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i%7CMerriweather:300,300i,400,400i%7CRoboto+Slab:300,300i,400,400i">

        <link rel="stylesheet" href="/imandra-docs/static/style/style.min.2726b43b.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/nbextensions/nbimandra/styles.b466ce6f.css" type="text/css">
        <link rel="stylesheet" href="/imandra-docs/static/docs-styles.b9de737f.css" type="text/css">
        
        <link rel="stylesheet" href="/imandra-docs/static/jekyll-styles.4b9defbe.css" type="text/css">
        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="/imandra-docs/static/nbimandra-rjs-bundle.b85e58fd.js"></script>

        <style type="text/css">
         .highlight .hll { background-color: #ffffcc }
         .highlight  { background: #f8f8f8; }
         .highlight .c { color: #408080; font-style: italic } /* Comment */
         .highlight .err { border: 1px solid #FF0000 } /* Error */
         .highlight .k { color: #008000; font-weight: bold } /* Keyword */
         .highlight .o { color: #666666 } /* Operator */
         .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
         .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
         .highlight .cp { color: #BC7A00 } /* Comment.Preproc */
         .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
         .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
         .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
         .highlight .gd { color: #A00000 } /* Generic.Deleted */
         .highlight .ge { font-style: italic } /* Generic.Emph */
         .highlight .gr { color: #FF0000 } /* Generic.Error */
         .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
         .highlight .gi { color: #00A000 } /* Generic.Inserted */
         .highlight .go { color: #888888 } /* Generic.Output */
         .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
         .highlight .gs { font-weight: bold } /* Generic.Strong */
         .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
         .highlight .gt { color: #0044DD } /* Generic.Traceback */
         .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
         .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
         .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
         .highlight .kp { color: #008000 } /* Keyword.Pseudo */
         .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
         .highlight .kt { color: #B00040 } /* Keyword.Type */
         .highlight .m { color: #666666 } /* Literal.Number */
         .highlight .s { color: #BA2121 } /* Literal.String */
         .highlight .na { color: #7D9029 } /* Name.Attribute */
         .highlight .nb { color: #008000 } /* Name.Builtin */
         .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
         .highlight .no { color: #880000 } /* Name.Constant */
         .highlight .nd { color: #AA22FF } /* Name.Decorator */
         .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
         .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
         .highlight .nf { color: #0000FF } /* Name.Function */
         .highlight .nl { color: #A0A000 } /* Name.Label */
         .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
         .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
         .highlight .nv { color: #19177C } /* Name.Variable */
         .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
         .highlight .w { color: #bbbbbb } /* Text.Whitespace */
         .highlight .mb { color: #666666 } /* Literal.Number.Bin */
         .highlight .mf { color: #666666 } /* Literal.Number.Float */
         .highlight .mh { color: #666666 } /* Literal.Number.Hex */
         .highlight .mi { color: #666666 } /* Literal.Number.Integer */
         .highlight .mo { color: #666666 } /* Literal.Number.Oct */
         .highlight .sa { color: #BA2121 } /* Literal.String.Affix */
         .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
         .highlight .sc { color: #BA2121 } /* Literal.String.Char */
         .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
         .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
         .highlight .s2 { color: #BA2121 } /* Literal.String.Double */
         .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
         .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
         .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
         .highlight .sx { color: #008000 } /* Literal.String.Other */
         .highlight .sr { color: #BB6688 } /* Literal.String.Regex */
         .highlight .s1 { color: #BA2121 } /* Literal.String.Single */
         .highlight .ss { color: #19177C } /* Literal.String.Symbol */
         .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
         .highlight .fm { color: #0000FF } /* Name.Function.Magic */
         .highlight .vc { color: #19177C } /* Name.Variable.Class */
         .highlight .vg { color: #19177C } /* Name.Variable.Global */
         .highlight .vi { color: #19177C } /* Name.Variable.Instance */
         .highlight .vm { color: #19177C } /* Name.Variable.Magic */
         .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
        </style>

        <!-- Loading mathjax macro -->
        <!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --><script>
  function handleCopyClick() {
      var el = this;
      var terminal = el.closest('.terminal');
      var highlight = terminal.getElementsByClassName('highlight')[0];
      copyToClipboardMsg(highlight);

      terminal.classList.add('terminal--hide');
      setTimeout(function () {
          terminal.classList.remove('terminal--hide');
      }, 2000);


      function copyToClipboardMsg(elem) {
          var succeed = copyToClipboard(elem);
          var msg;
          if (!succeed) {
              msg = 'Error!';
          } else {
              msg = 'Copied!';
          }

          var msgElem = terminal.querySelector('.terminal__copy-msg');
          msgElem.innerHTML = msg;
          setTimeout(function () {
              msgElem.innerHTML = 'You rock!';
          }, 1000);
      }

      function copyToClipboard(elem) {
          // create hidden text element, if it doesn't already exist
          var targetId = '_hiddenCopyText_';
          var isInput = elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA';
          var origSelectionStart, origSelectionEnd;
          if (isInput) {
              // can just use the original source element for the selection and copy
              target = elem;
              origSelectionStart = elem.selectionStart;
              origSelectionEnd = elem.selectionEnd;
          } else {
              // must use a temporary form element for the selection and copy
              target = terminal.querySelector('#' + targetId);
              if (!target) {
                  var target = document.createElement('textarea');
                  // target.style.display = 'flex';
                  // target.style.position = 'absolute';
                  // target.style.left = '-1000%';
                  target.id = targetId;
                 elem.appendChild(target);
              }
              target.textContent = elem.textContent.trim();
          }

          // select the content
          var currentFocus = document.activeElement;
          target.focus();
          target.setSelectionRange(0, target.value.length);

          // copy the selection
          var succeed;
          try {
              succeed = document.execCommand('copy');
          } catch (e) {
              succeed = false;
          }
          // restore original focus
          if (currentFocus && typeof currentFocus.focus === 'function') {
              currentFocus.focus();
          }

          if (isInput) {
              // restore prior selection
              elem.setSelectionRange(origSelectionStart, origSelectionEnd);
          } else {
              // clear temporary content
              elem.removeChild(target);
          }
          return succeed;
      }
  }
</script>
    </head>
    <body>
        <div class="background">
        </div>
        <div class="page-container">
            <main class="main-content-column">
                <!-- Jupyter (Imandra core docs) version -->
<header class="header">
    <div class="top-row-container">
        <div class="top-row">

            <div id="toggler--left" class="side__left-menu-toggler">
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p class="side__toggle-text">Docs</p>
            </div>

            <div class="side__logo-container">
                <a class="side__logo-link" href="/">
                    <img class="side__logo " src = "/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-docs.svg">
                    <img class="side__logo--min " src="/imandra-docs/jekyll-resources/assets/img/imandra-gradient-logo-min.svg">

                </a>
            </div>

            <div id="toggler--right" class="side__right-menu-toggler">
                <p class="side__toggle-text">Pages</p>
                <div class="side__toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <nav class="side__nav-container side__nav-container--hidden">

                <ul class="side__nav-list">
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link" href="/">Documentation Home</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs">Imandra</a>
                        
                        <ul class="side__nav-list--sub-level-1">
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/welcome">A Quick Tour</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" target="_blank" rel="noopener noreferrer" href="/imandra-docs/odoc/imandra-base/Imandra_prelude/">Standard Library</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" target="_blank" rel="noopener noreferrer" href="/imandra-docs/odoc/">API Docs</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/installation">Installation</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-simple">Installer</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-manual-opam">Manual (opam)</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-docker">Docker Image</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-vscode">VSCode</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/installation-jupyter">Jupyter</a>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/logic-and-program-modes">Logic and Program Modes</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/verification-commands">Verification</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-commands">Commands</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-attributes">Attributes</a>
                                        
                                        <ul class="side__nav-list--sub-level-3">
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-attributes/#Verification-Hints">Verification Hints</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-attributes/#Rule-Classes">Rule Classes</a>
                                            </li>
                                            
                                        </ul>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-unrolling">Unrolling</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-simplification">Simplification</a>
                                        
                                        <ul class="side__nav-list--sub-level-3">
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-simplification/#Rewrite-Rules">Rewrite Rules</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-simplification/#Forward-chaining-Rules">Forward-chaining Rules</a>
                                            </li>
                                            
                                        </ul>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-blast">Blast</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-induction">Induction</a>
                                        
                                        <ul class="side__nav-list--sub-level-3">
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-induction/#Functional-Induction">Functional Induction</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-induction/#Structural-Induction">Structural Induction</a>
                                            </li>
                                            
                                        </ul>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall">Waterfall</a>
                                        
                                        <ul class="side__nav-list--sub-level-3">
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall/#Simplification">Simplification</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall/#Unrolling-check">Unrolling check</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall/#Destructor-Elimination">Destructor Elimination</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall/#Fertilization">Fertilization</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall/#Generalization">Generalization</a>
                                            </li>
                                            
                                            <li class="side__nav-list-item--sub-level-3">
                                              <a class="side__nav-link" href="/imandra-docs/notebooks/verification-waterfall/#Induction">Induction</a>
                                            </li>
                                            
                                        </ul>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/proving-program-termination">Proving Program Termination</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/decomposition-flags">Region Decomposition</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/imandra-tools-intro">Imandra Tools Introduction</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/idf">Iterative Decomposition Framework</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link side__nav-link--active" href="/imandra-docs/notebooks/region-probabilities">Region Probabilities</a>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/loading-files">Multifile development</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/extracting-ocaml-modules-with-imandra-extract">Extracting OCaml modules with imandra-extract</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                </ul>
                            </li>
                            
                            <li class="side__nav-list-item--sub-level-1">
                                
                                <a class="side__nav-link" href="/imandra-docs/notebooks/examples">Examples</a>
                                
                                <ul class="side__nav-list--sub-level-2">
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/recursion-induction-and-rewriting">Recursion, Induction and Rewriting</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-merge-sort">Verifying Merge Sort in Imandra</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/ubs-case-study">Analysing the UBS ATS Dark Pool</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/six-swiss-exchange-pricing">Region Decomposition - Exchange Pricing</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/webservice-auth-logic">Analysing Web-app Authentication Logic</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/simple-vehicle-controller">Simple Vehicle Controller</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/simple-stoplight-model">Simple Car Intersection model</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/ripple-carry-adder">Verifying a Ripple Carry Adder</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/verifying-an-ros-node">Creating and Verifying a ROS Node</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-tic-tac-toe">Tic Tac Toe with ReasonML</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/probabilistic-reasoning-in-reasonml">Probabilistic Reasoning in ReasonML</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/sudoku">Solving Sudoku with Imandra</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/crossing-river-safely">Crossing the River Safely</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/reasonml-facetime-state-machines">Exploring The Apple FaceTime Bug with ReasonML State Machines</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/key-pair-security">Key Pair Security in Imandra</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/a-comparison-with-tla-plus">A comparison with TLA+</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/solver-synthesis">Synthesising a Game Solver in Imandra</a>
                                        
                                    </li>
                                    
                                    <li class="side__nav-list-item--sub-level-2">
                                        <a class="side__nav-link" href="/imandra-docs/notebooks/supervised-learning">Analysing Machine Learning Models</a>
                                        
                                    </li>
                                    
                                </ul>
                            </li>
                            
                        </ul>
                        
                    </li>
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link" href="/idf-py">IDF Py</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link" href="/ipl">Imandra Protocol Language</a>
                        
                    </li>
                    
                    <li class="side__nav-list-item TopNavListItem">
                        <a class="side__nav-link" href="/fix-engine">FIX Engine</a>
                        
                    </li>
                    
                </ul>
            </nav>
        </div>
    </div>

    <div class="background">
    </div>


    <div class="template-header">
        <div class="top-bar">
            <nav class="top-bar__nav-container">
                <a href="#" class="top-bar__toggle">â‰¡</a>
                <div class="top-nav-bar__group ">
                    <div class="top-nav-bar__nav nav-bar--blue top-nav-bar__nav--hidden">
                        <ul class="top-nav-bar__links top-nav-bar__links--hidden-smaller-than-tablet">
                            <li class="top-nav-bar__item">
                                <a href="https://www.imandra.ai/" class="top-nav-bar__link">Home</a>
                            </li>
                            <li class="top-nav-bar__item">
                                <a href="https://try.imandra.ai/" class="top-nav-bar__link">Try</a>
                            </li>
                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--engine">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Engine</a>
                                <ul class="dropdown-content dropdown-content--engine">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--docs--menu.svg" alt="Docs" title="Docs Icon">
                                        <a class="dropdown__link" href="https://docs.imandra.ai/">Docs</a></li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--research--menu.svg" alt="Research" title="Research Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/research">Research</a></li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--core--menu.svg" alt="Imandra Core" title="Imandra Core Icon">
                                        <a class="dropdown__link dropdown__coming-soon dropdown__link--last">Imandra Core</a></li>
                                </ul>
                            </li>
                            <!-- <li class="top-nav-bar__item top-nav-bar__item--group dropdown--industries">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Industries</a>
                                <ul class="dropdown-content dropdown-content--industries">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--financial--menu.svg" alt="Financial Markets" title="Financial Markets Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/imarkets">Financial Markets</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--autonomy--menu.svg" alt="Autonomous Systems" title="Autonomous Systems Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/autonomy">Autonomous Systems</a>
                                    </li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--ml--menu.svg" alt="Reinforcement Learning" title="Reinforcement Learningn Icon">
                                        <a class="dropdown__link dropdown__coming-soon dropdown__link--last ">Reinforcement Learning</a>
                                    </li>
                                </ul>
                            </li> -->
                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--media">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Media</a>
                                <ul class="dropdown-content dropdown-content--media">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--media--menu.svg" alt="Media" title="Media Icon">
                                        <a class="dropdown__link " href="https://www.imandra.ai/media">Media</a></li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--blog--menu.svg" alt="Blog" title="Blog Icon">
                                        <a class="dropdown__link dropdown__link--last " href="https://medium.com/imandra">Blog</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="top-nav-bar__item top-nav-bar__item--group dropdown--company">
                                <a class="top-nav-bar__link top-nav-bar__link--group">Company</a>
                                <ul class="dropdown-content dropdown-content--company">
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--about--menu.svg" alt="About" title="About Icon">
                                        <a class="dropdown__link" href="https://www.imandra.ai/about">About</a></li>
                                    <li class="dropdown__item dropdown__item--with-icon">
                                        <img class="dropdown__icon" src="/imandra-docs/jekyll-resources/assets/img/icon--careers--menu.svg" alt=" Careers" title="Careers Icon">
                                        <a class="dropdown__link dropdown__link--last dropdown__link--bottom" href="https://www.imandra.ai/careers">Careers</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <div class="template-header__image-container template-header__image-container--jupyter">
            <div class="template-header__image" href ="/imandra-docs">
                <img class="site-specific-image" src="/imandra-docs/static/img/site_specific_image_v_2.svg">
            </div>
        </div>

    </div>



    <script>
        document.getElementById('toggler--left').addEventListener('click', function () {
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');
            document.getElementsByClassName('side__nav-container')[0].classList.toggle(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.add('top-nav-bar__nav--hidden');
        });

        document.getElementById('toggler--right').addEventListener('click', function () {
            document.querySelector('.side__left-menu-toggler .side__toggle').classList.remove(
                'side__toggle--active');
            document.querySelector('.side__right-menu-toggler .side__toggle').classList.toggle(
                'side__toggle--active');

            document.getElementsByClassName('side__nav-container')[0].classList.add(
                'side__nav-container--hidden');
            document.getElementsByClassName('top-nav-bar__nav')[0].classList.toggle(
                'top-nav-bar__nav--hidden');
        });
    </script>
</header>
                <article class="article__container article__container--notebooks">
                    <div class="main-content main-content--jupyter">
                        
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Region-Probabilities">Region Probabilities<a class="anchor-link" href="#Region-Probabilities">&#182;</a></h1><p>In this notebook we provide an introduction to the latest Imandra Tools module, <code>Region_probs</code>, which includes a small probabilistic programmining library that allows users reason about Imandra Modelling Language (IML) models probabilistically. In particular, users can easily create custom hierarchical statistical models defining joint distributions over inputs to their programs or functions, then sample from these models to get a probability distribution over regions, or query them with Boolean conditions. Alternatively, a dataset in the form of a <code>CSV</code> file can be imported and used as a set of samples. In a later notebook we'll illustrate how these tools can be used to analyse and verify the fairness of decision-making algorithms, but here we'll keep things simple and just demonstrate the basic functionalities of the module.</p>
<h3 id="Setup">Setup<a class="anchor-link" href="#Setup">&#182;</a></h3><p>We'll begin by opening the module and installing a pretty printer that will display a decimal version of the real numbers that we'll often be using in this notebook:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-2" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">open</span> <span class="nn">Imandra_tools</span><span class="p">.</span><span class="nc">Region_probs</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">pp_approx</span> <span class="n">fmt</span> <span class="n">r</span> <span class="o">=</span> <span class="nn">CCFormat</span><span class="p">.</span><span class="n">fprintf</span> <span class="n">fmt</span> <span class="s2">&quot;%s&quot;</span> <span class="o">(</span><span class="nn">Real</span><span class="p">.</span><span class="n">to_string_approx</span> <span class="n">r</span><span class="o">)</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>
<span class="o">#</span><span class="n">install_printer</span> <span class="n">pp_approx</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[1]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val pp_approx : CCFormat.t -&gt; Q.t -&gt; unit = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that the module's interface and type signatures can be found <a href="https://docs.imandra.ai/imandra-docs/odoc/imandra-tools/Imandra_tools/Region_probs/index.html">in the docs pages</a>.</p>
<h3 id="Basic-Distributions">Basic Distributions<a class="anchor-link" href="#Basic-Distributions">&#182;</a></h3><p>The <code>Region_probs</code> module contains 13 of the most common discrete and continuous univariate probability distributions which can be parameterised and then used directly. In particular, we support the following distributions:</p>
<ul>
<li>Bernoulli</li>
<li>Beta</li>
<li>Binomial</li>
<li>Categorical</li>
<li>Cauchy</li>
<li>Exponential</li>
<li>Gamma</li>
<li>Guassian</li>
<li>Laplace</li>
<li>Logistic</li>
<li>LogNormal</li>
<li>Poisson</li>
<li>Uniform</li>
</ul>
<p>Each distribution has named parameters and can take an optional argument <code>~constraints</code> which truncates the distribution to within the bounds specified by the constraint list. For example, we can define a Gaussian random variable <code>x</code> with mean <code>5</code> and standard deviation <code>1.3</code>, that is restricted to the regions <code>[2.5, 5]</code> and <code>[5.8, 10.3]</code> as:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-4" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">gaussian</span> <span class="o">~</span><span class="n">mu</span><span class="o">:</span><span class="mi">5</span><span class="o">.</span> <span class="o">~</span><span class="n">sigma</span><span class="o">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">3</span> <span class="o">~</span><span class="n">constraints</span><span class="o">:[(</span><span class="mi">2</span><span class="o">.</span><span class="mi">5</span><span class="o">,</span><span class="mi">5</span><span class="o">.);</span> <span class="o">(</span><span class="mi">5</span><span class="o">.</span><span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">.</span><span class="mi">3</span><span class="o">)]</span> <span class="o">[@@</span><span class="n">program</span><span class="o">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val x : unit -&gt; Q.t = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We then sample from the distribution to get a particular value by calling <code>x</code> with the unit argument <code>()</code>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-6" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">x</span> <span class="bp">()</span><span class="o">;;</span>
<span class="n">x</span> <span class="bp">()</span><span class="o">;;</span>
<span class="n">x</span> <span class="bp">()</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>- : Q.t = 4.19759047912
- : Q.t = 6.70332026077
- : Q.t = 4.08217241141
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Building-Statistical-Models">Building Statistical Models<a class="anchor-link" href="#Building-Statistical-Models">&#182;</a></h3><p>Using the basic univariate distributions above as building blocks we can create more complex custom joint distributions over inputs by generating samples sequentially. For example, let's define a distribution over some apples in a shop. Let's consider three kinds of apple, <code>Braeburn</code>, <code>Granny_Smith</code>, and <code>Red_Delicious</code> which are stocked in varying proportions. We can also suppose that their weights might be normally distributed according to their kind. Let's assume that each apple stays in the shop for a week at a time and that there is a <code>0.4</code> chance that any particular apple gets bought on a particular day. Then the number of days an apple has been in the shop can be modelled by a Binomial distribution. Finally, let's say that the apples tend to turn ripe quickly after <code>3</code> days, if they're not already ripe. Thus, a joint distribution over apples can be given as follows:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-8" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">type</span> <span class="n">kind</span> <span class="o">=</span> <span class="nc">Braeburn</span> <span class="o">|</span> <span class="nc">Granny_Smith</span> <span class="o">|</span> <span class="nc">Red_Delicious</span>

<span class="k">type</span> <span class="n">apple</span> <span class="o">=</span> <span class="o">{</span> <span class="n">kind</span><span class="o">:</span> <span class="n">kind</span><span class="o">;</span>
               <span class="n">mass</span><span class="o">:</span> <span class="nn">Q</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
               <span class="n">days_old</span><span class="o">:</span> <span class="nn">Z</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
               <span class="n">is_ripe</span><span class="o">:</span> <span class="kt">bool</span> <span class="o">}</span>

<span class="k">let</span> <span class="n">apple_dist</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="n">categorical</span> <span class="o">~</span><span class="n">classes</span><span class="o">:[</span><span class="nc">Braeburn</span><span class="o">;</span> <span class="nc">Granny_Smith</span><span class="o">;</span> <span class="nc">Red_Delicious</span><span class="o">]</span> <span class="o">~</span><span class="n">probs</span><span class="o">:[</span><span class="mi">0</span><span class="o">.</span><span class="mi">25</span><span class="o">;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">6</span><span class="o">;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">15</span><span class="o">]</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">mean_mass</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Braeburn</span> <span class="o">-&gt;</span> <span class="mi">85</span><span class="o">.</span>
  <span class="o">|</span> <span class="nc">Granny_Smith</span> <span class="o">-&gt;</span> <span class="mi">80</span><span class="o">.</span>
  <span class="o">|</span> <span class="nc">Red_Delicious</span> <span class="o">-&gt;</span> <span class="mi">100</span><span class="o">.</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mean_mass</span> <span class="n">k</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="n">gaussian</span> <span class="o">~</span><span class="n">mu</span> <span class="o">~</span><span class="n">sigma</span><span class="o">:</span><span class="mi">5</span><span class="o">.</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">d_o</span> <span class="o">=</span> <span class="n">binomial</span> <span class="o">~</span><span class="n">n</span><span class="o">:</span><span class="mi">7</span> <span class="o">~</span><span class="n">p</span><span class="o">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">4</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">ripe_chance</span> <span class="n">days</span> <span class="o">=</span> <span class="k">if</span> <span class="n">days</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">then</span> <span class="mi">0</span><span class="o">.</span><span class="mi">9</span> <span class="k">else</span> <span class="mi">0</span><span class="o">.</span><span class="mi">4</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ripe_chance</span> <span class="n">d_o</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">i_r</span> <span class="o">=</span> <span class="n">bernoulli</span> <span class="o">~</span><span class="n">p</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="o">{</span><span class="n">kind</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span> <span class="n">mass</span> <span class="o">=</span> <span class="n">m</span><span class="o">;</span> <span class="n">days_old</span> <span class="o">=</span> <span class="n">d_o</span><span class="o">;</span> <span class="n">is_ripe</span> <span class="o">=</span> <span class="n">i_r</span><span class="o">}</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>

<span class="n">apple_dist</span> <span class="bp">()</span><span class="o">;;</span>
<span class="n">apple_dist</span> <span class="bp">()</span><span class="o">;;</span>
<span class="n">apple_dist</span> <span class="bp">()</span><span class="o">;;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>type kind = Braeburn | Granny_Smith | Red_Delicious
type apple = { kind : kind; mass : Q.t; days_old : Z.t; is_ripe : bool; }
val apple_dist : unit -&gt; apple = &lt;fun&gt;
- : apple =
{kind = Granny_Smith; mass = 81.7329170367; days_old = 3; is_ripe = true}
- : apple =
{kind = Granny_Smith; mass = 84.8514027178; days_old = 2; is_ripe = true}
- : apple =
{kind = Granny_Smith; mass = 81.0976719168; days_old = 2; is_ripe = false}
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In general, distributions may be defined over abitrary groups of types, as long as they are outputted as tuples, in the end. For example, we could have a distribution over a list of <code>fruit</code>s in a bowl and a distribution over the colour of the bowl, but the final output would be a tuple <code>(fruits, bowl_colour)</code> of type <code>fruit list * colour</code>.</p>
<h3 id="Estimating-Region-Probabilities">Estimating Region Probabilities<a class="anchor-link" href="#Estimating-Region-Probabilities">&#182;</a></h3><p>There are two ways we can estimate region probabilities: the first is to sample from a model using a custom distribution (such as the one above), and the second is to use an existing dataset of samples whose distribution we might not be able easily write down. Given one of these we create a <code>Distribution</code> module which can then be used to get region probabilities, estimate Boolean queries, and save/load sample data. To estimate some region probabilities, we'll first need some regions! We'll right a simple function calculating the price, in pennies, of the apple then decompose it:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-10" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">price</span> <span class="n">apple</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">per_gram</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Braeburn</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">4</span>
  <span class="o">|</span> <span class="nc">Granny_Smith</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">35</span>
  <span class="o">|</span> <span class="nc">Red_Delicious</span> <span class="o">-&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">3</span>
  <span class="k">in</span> <span class="k">let</span> <span class="n">p</span> <span class="o">=</span> <span class="o">(</span><span class="n">per_gram</span> <span class="n">apple</span><span class="o">.</span><span class="n">kind</span><span class="o">)</span> <span class="o">*.</span> <span class="n">apple</span><span class="o">.</span><span class="n">mass</span> <span class="k">in</span>
  <span class="k">if</span> <span class="n">apple</span><span class="o">.</span><span class="n">days_old</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="k">then</span> <span class="n">p</span> <span class="o">/.</span> <span class="mi">2</span><span class="o">.</span> <span class="k">else</span> <span class="n">p</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">regions</span> <span class="o">=</span> <span class="nn">Decompose</span><span class="p">.</span><span class="n">top</span> <span class="s2">&quot;price&quot;</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val price : apple -&gt; real = &lt;fun&gt;
val regions : Imandra_interactive.Decompose.t list =
  [&lt;region&gt;; &lt;region&gt;; &lt;region&gt;; &lt;region&gt;; &lt;region&gt;; &lt;region&gt;]
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div class="imandra-alternatives" id="alt-1bcb2767-4ad7-4d0b-a42a-539571fe5251"><ul class="nav nav-tabs"><li class="active" data-toggle="tab"><a>Voronoi</a></li><li class="" data-toggle="tab"><a>Table</a></li></ul><div class="tab-content"><div class="tab-pane active"><div id="decompose-a5ec1ea6-2524-4812-979a-e44dde025edb" class="decompose"><textarea class="display-none">{
  &quot;regions&quot;: [
    {
      &quot;constraints&quot;: [ &quot;apple.days_old &gt;= 5&quot; ],
      &quot;region&quot;: null,
      &quot;groups&quot;: [
        {
          &quot;constraints&quot;: [
            &quot;apple.days_old &gt;= 5&quot;, &quot;apple.kind is Red_Delicious&quot;
          ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [
              &quot;apple.days_old &gt;= 5&quot;, &quot;apple.kind is Red_Delicious&quot;
            ],
            &quot;invariant&quot;: &quot;F = apple.mass * 3/20&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;2.3&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [
            &quot;apple.days_old &gt;= 5&quot;, &quot;apple.kind is Granny_Smith&quot;
          ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [
              &quot;apple.days_old &gt;= 5&quot;, &quot;apple.kind is Granny_Smith&quot;
            ],
            &quot;invariant&quot;: &quot;F = apple.mass * 7/40&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;2.2&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [ &quot;apple.days_old &gt;= 5&quot;, &quot;apple.kind is Braeburn&quot; ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [
              &quot;apple.days_old &gt;= 5&quot;, &quot;apple.kind is Braeburn&quot;
            ],
            &quot;invariant&quot;: &quot;F = apple.mass * 1/5&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;2.1&quot;,
          &quot;weight&quot;: 1
        }
      ],
      &quot;label&quot;: &quot;&quot;,
      &quot;weight&quot;: 3
    },
    {
      &quot;constraints&quot;: [ &quot;apple.days_old &lt; 5&quot; ],
      &quot;region&quot;: null,
      &quot;groups&quot;: [
        {
          &quot;constraints&quot;: [
            &quot;apple.days_old &lt; 5&quot;, &quot;apple.kind is Red_Delicious&quot;
          ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [
              &quot;apple.days_old &lt; 5&quot;, &quot;apple.kind is Red_Delicious&quot;
            ],
            &quot;invariant&quot;: &quot;F = apple.mass * 3/10&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;1.3&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [
            &quot;apple.days_old &lt; 5&quot;, &quot;apple.kind is Granny_Smith&quot;
          ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [
              &quot;apple.days_old &lt; 5&quot;, &quot;apple.kind is Granny_Smith&quot;
            ],
            &quot;invariant&quot;: &quot;F = apple.mass * 7/20&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;1.2&quot;,
          &quot;weight&quot;: 1
        },
        {
          &quot;constraints&quot;: [ &quot;apple.days_old &lt; 5&quot;, &quot;apple.kind is Braeburn&quot; ],
          &quot;region&quot;: {
            &quot;constraints&quot;: [ &quot;apple.days_old &lt; 5&quot;, &quot;apple.kind is Braeburn&quot; ],
            &quot;invariant&quot;: &quot;F = apple.mass * 2/5&quot;
          },
          &quot;groups&quot;: [],
          &quot;label&quot;: &quot;1.1&quot;,
          &quot;weight&quot;: 1
        }
      ],
      &quot;label&quot;: &quot;&quot;,
      &quot;weight&quot;: 3
    }
  ]
}</textarea><div class="decompose-foamtree"></div><div class="decompose-details"><div class="decompose-details-header">Regions details</div><div class="decompose-details-no-selection"><p>No group selected.</p><ul><li>Concrete regions are numbered</li><li>Unnumbered regions are groups whose children share a particular constraint</li><li>Click on a region to view its details</li><li>Double click on a region to zoom in on it</li><li>Shift+double click to zoom out</li><li>Hit escape to reset back to the top</li></ul></div><div class="decompose-details-selection hidden"><div><span class="decompose-details-label">Direct sub-regions: </span><span class="decompose-details-direct-sub-regions-text">-</span></div><div><span class="decompose-details-label">Contained regions: </span><span class="decompose-details-contained-regions-text">-</span></div><div class="decompose-details-section-header">Constraints</div><div class="decompose-details-constraints"><pre class="decompose-details-constraint">&lt;constraint&gt;</pre></div><div class="decompose-details-invariant"><div class="decompose-details-section-header">Invariant</div><pre class="decompose-details-invariant-text">&lt;invariant&gt;</pre></div></div></div><script>
(function () {
  require(['nbextensions/nbimandra/regions'], function (regions) {
    var target = '#decompose-a5ec1ea6-2524-4812-979a-e44dde025edb';
    regions.hydrate(target);
  });
})();
</script></div></div><div class="tab-pane"><div><div class="imandra-table" id="table-533ef201-2528-4598-87c2-32e4cd42d6d3"><table><thead><tr><th>Constraints</th><th>Invariant</th></tr></thead><tr><td><ul><li><pre>not (apple.days_old &gt;= 5)</pre></li><li><pre>not (apple.kind = Braeburn)</pre></li><li><pre>not (apple.kind = Granny_Smith)</pre></li></ul></td><td><pre>3/10 *. apple.mass</pre></td></tr><tr><td><ul><li><pre>not (apple.days_old &gt;= 5)</pre></li><li><pre>not (apple.kind = Braeburn)</pre></li><li><pre>apple.kind = Granny_Smith</pre></li></ul></td><td><pre>7/20 *. apple.mass</pre></td></tr><tr><td><ul><li><pre>not (apple.days_old &gt;= 5)</pre></li><li><pre>apple.kind = Braeburn</pre></li></ul></td><td><pre>2/5 *. apple.mass</pre></td></tr><tr><td><ul><li><pre>apple.days_old &gt;= 5</pre></li><li><pre>not (apple.kind = Braeburn)</pre></li><li><pre>not (apple.kind = Granny_Smith)</pre></li></ul></td><td><pre>3/20 *. apple.mass</pre></td></tr><tr><td><ul><li><pre>apple.days_old &gt;= 5</pre></li><li><pre>not (apple.kind = Braeburn)</pre></li><li><pre>apple.kind = Granny_Smith</pre></li></ul></td><td><pre>7/40 *. apple.mass</pre></td></tr><tr><td><ul><li><pre>apple.days_old &gt;= 5</pre></li><li><pre>apple.kind = Braeburn</pre></li></ul></td><td><pre>1/5 *. apple.mass</pre></td></tr></table></div></div></div></div><script>
require(['nbextensions/nbimandra/alternatives'], function (alternatives) {
  var target = '#alt-1bcb2767-4ad7-4d0b-a42a-539571fe5251';
  alternatives.hydrate(target);
});
</script></div>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we're in a position to calculate the probability mass of each region given our distribution above, or a separate dataset.</p>
<h4 id="Sampling-Over-Regions">Sampling Over Regions<a class="anchor-link" href="#Sampling-Over-Regions">&#182;</a></h4><p>Let's first use our <code>apple_dist</code> distribution from above to create a <code>Distribution</code> module:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-12" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">module</span> <span class="nc">Apple_S</span> <span class="o">=</span> <span class="nn">Distribution</span><span class="p">.</span><span class="nc">From_Sampler</span> <span class="o">(</span><span class="k">struct</span> <span class="k">type</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">apple</span> <span class="k">let</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">apple_dist</span> <span class="k">end</span><span class="o">)</span> <span class="o">[@@</span><span class="n">program</span><span class="o">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>module Apple_S :
  sig
    type domain = apple
    val get_probs :
      Imandra_surface.Decompose_region.t list -&gt;
      ?assuming:string -&gt;
      ?n:Z.t -&gt;
      ?d:string -&gt;
      ?step_function:(domain -&gt; domain) -&gt;
      ?num_steps:Z.t -&gt;
      unit -&gt; (int, float * Imandra_surface.Decompose_region.t) Hashtbl.t
    val query :
      (domain -&gt; bool) -&gt;
      ?n:Z.t -&gt;
      ?d:string -&gt; ?max_std_err:Q.t -&gt; ?precision:Z.t -&gt; unit -&gt; unit
    val save : string -&gt; ?n:Z.t -&gt; ?d:domain list -&gt; unit -&gt; unit
    val load : string -&gt; domain list
  end
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we can find the probabilities using the <code>get_probs</code> function, which takes the <code>regions</code> and the following optional arguments:</p>
<ul>
<li><code>n</code>: The number of samples to be generated for calculating probabilities (only applies when using <code>From_Sampler</code>, default value is <code>10000</code>)</li>
<li><code>d</code>: The file name of the dataset of samples to be imported (only applies when using <code>From_Data</code>)</li>
<li><code>step_function</code>: If the distribution is over the initial value of some type <code>x</code> and we have a function <code>val f: x -&gt; x</code> that we are decomposing that acts a step in some transition system for <code>x</code>, then we can apply this step function to <code>x</code> multiple times before calculating region probabilities</li>
<li><code>num_steps</code>: The number of times to apply the step function, if given</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-14" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">apple_probs_S</span> <span class="o">=</span> <span class="nn">Apple_S</span><span class="p">.</span><span class="n">get_probs</span> <span class="n">regions</span> <span class="bp">()</span> <span class="o">[@@</span><span class="n">program</span><span class="o">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val g___1 : apple -&gt; int = &lt;fun&gt;
- : unit = ()
val apple_probs_S :
  (int, float * Imandra_surface.Decompose_region.t) Hashtbl.t = &lt;abstr&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Probabilities can be printed using the <code>print_probs</code> function, which takes the hashtable of region probabilities outputted by <code>get_probs</code> and the following optional arguments:</p>
<ul>
<li><code>precision</code>: The number of decimal places that probabalities are displayed to (default is <code>4</code>)</li>
<li><code>full_support</code>: Whether or not to list regions that have probability <code>0</code> or not (default is <code>false</code>)</li>
<li><code>verbose</code>: Whether or not to print out a description of the region, including constraints and the invariant, alongside the probabilities (default is <code>false</code>)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-16" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">print_probs</span> <span class="n">apple_probs_S</span> <span class="o">~</span><span class="n">verbose</span><span class="o">:</span><span class="bp">true</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Region Probabilities---[region]---
Index: 2
Probability: 0.0160
Constraints:
  [ apple.kind is Red_Delicious
  ; apple.days_old &gt;= 5 ]
Invariant:
  F = apple.mass * 3/20
 -------------
---[region]---
Index: 3
Probability: 0.2191
Constraints:
  [ apple.kind is Braeburn
  ; apple.days_old &lt; 5 ]
Invariant:
  F = apple.mass * 2/5
 -------------
---[region]---
Index: 5
Probability: 0.1344
Constraints:
  [ apple.kind is Red_Delicious
  ; apple.days_old &lt; 5 ]
Invariant:
  F = apple.mass * 3/10
 -------------
---[region]---
Index: 4
Probability: 0.5483
Constraints:
  [ apple.kind is Granny_Smith
  ; apple.days_old &lt; 5 ]
Invariant:
  F = apple.mass * 7/20
 -------------
---[region]---
Index: 0
Probability: 0.0224
Constraints:
  [ apple.kind is Braeburn
  ; apple.days_old &gt;= 5 ]
Invariant:
  F = apple.mass * 1/5
 -------------
---[region]---
Index: 1
Probability: 0.0598
Constraints:
  [ apple.kind is Granny_Smith
  ; apple.days_old &gt;= 5 ]
Invariant:
  F = apple.mass * 7/40
 -------------

- : unit = ()
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Datasets-Over-Regions">Datasets Over Regions<a class="anchor-link" href="#Datasets-Over-Regions">&#182;</a></h4><p>Using a dataset to estimate probabilities is very similar to the procedure above, although as a <code>CSV</code> stores strings as opposed to types we need to include a couple of functions mapping each row (a list of strings) to our data type:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-18" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">to_apple</span> <span class="n">apple_string</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="k">match</span> <span class="nn">CCList</span><span class="p">.</span><span class="n">nth</span> <span class="n">apple_string</span> <span class="mi">0</span><span class="n">i</span> <span class="k">with</span>
  <span class="o">|</span> <span class="s2">&quot;bb&quot;</span> <span class="o">-&gt;</span> <span class="nc">Braeburn</span>
  <span class="o">|</span> <span class="s2">&quot;gs&quot;</span> <span class="o">-&gt;</span> <span class="nc">Granny_Smith</span>
  <span class="o">|</span> <span class="s2">&quot;rd&quot;</span> <span class="o">-&gt;</span> <span class="nc">Red_Delicious</span>
  <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&quot;Apple type is not bb, gs, or rd&quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="nn">Q</span><span class="p">.</span><span class="n">of_string</span> <span class="o">(</span><span class="nn">CCList</span><span class="p">.</span><span class="n">nth</span> <span class="n">apple_string</span> <span class="mi">1</span><span class="n">i</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">d_o</span> <span class="o">=</span> <span class="nn">Z</span><span class="p">.</span><span class="n">of_string</span> <span class="o">(</span><span class="nn">CCList</span><span class="p">.</span><span class="n">nth</span> <span class="n">apple_string</span> <span class="mi">2</span><span class="n">i</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">i_r</span> <span class="o">=</span> <span class="k">if</span> <span class="nn">CCList</span><span class="p">.</span><span class="n">nth</span> <span class="n">apple_string</span> <span class="mi">3</span><span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="k">then</span> <span class="bp">true</span> <span class="k">else</span> <span class="bp">false</span> <span class="k">in</span>
  <span class="o">{</span><span class="n">kind</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span> <span class="n">mass</span> <span class="o">=</span> <span class="n">m</span><span class="o">;</span> <span class="n">days_old</span> <span class="o">=</span> <span class="n">d_o</span><span class="o">;</span> <span class="n">is_ripe</span> <span class="o">=</span> <span class="n">i_r</span><span class="o">}</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>

<span class="k">let</span> <span class="n">from_apple</span> <span class="n">apple</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="k">match</span> <span class="n">apple</span><span class="o">.</span><span class="n">kind</span> <span class="k">with</span>
  <span class="o">|</span> <span class="nc">Braeburn</span> <span class="o">-&gt;</span> <span class="s2">&quot;bb&quot;</span>
  <span class="o">|</span> <span class="nc">Granny_Smith</span> <span class="o">-&gt;</span> <span class="s2">&quot;gs&quot;</span>
  <span class="o">|</span> <span class="nc">Red_Delicious</span> <span class="o">-&gt;</span> <span class="s2">&quot;rd&quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="nn">Q</span><span class="p">.</span><span class="n">to_string</span> <span class="n">apple</span><span class="o">.</span><span class="n">mass</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">d_o</span> <span class="o">=</span> <span class="nn">Z</span><span class="p">.</span><span class="n">to_string</span> <span class="n">apple</span><span class="o">.</span><span class="n">days_old</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">i_r</span> <span class="o">=</span> <span class="k">if</span> <span class="n">apple</span><span class="o">.</span><span class="n">is_ripe</span> <span class="k">then</span> <span class="s2">&quot;1&quot;</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span> <span class="k">in</span>
  <span class="o">[</span><span class="n">k</span><span class="o">;</span> <span class="n">m</span><span class="o">;</span> <span class="n">d_o</span><span class="o">;</span> <span class="n">i_r</span><span class="o">]</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val to_apple : string list -&gt; apple = &lt;fun&gt;
val from_apple : apple -&gt; string list = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With these two functions (and out <code>apple</code> type) we can define a model based on some data <code>apple.csv</code> and then use it just as we did with our previous model. Note that we <code>load</code> and <code>save</code> data from/into <code>CSV</code> files with data models, but as byte files with sampling models. Note that this final line is non-executable in this notebook, as we don't actually ahve access to the local <code>CSV</code> file</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-20" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">module</span> <span class="nc">Apple_D</span> <span class="o">=</span> <span class="nn">Distribution</span><span class="p">.</span><span class="nc">From_Data</span> <span class="o">(</span><span class="k">struct</span>
                                         <span class="k">type</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">apple</span>
                                         <span class="k">let</span> <span class="n">from_domain</span> <span class="o">=</span> <span class="n">from_apple</span>
                                         <span class="k">let</span> <span class="n">to_domain</span> <span class="o">=</span> <span class="n">to_apple</span>
                                         <span class="k">end</span><span class="o">)</span> <span class="o">[@@</span><span class="n">program</span><span class="o">];;</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>module Apple_D :
  sig
    type domain = apple
    val get_probs :
      Imandra_surface.Decompose_region.t list -&gt;
      ?assuming:string -&gt;
      ?n:Z.t -&gt;
      ?d:string -&gt;
      ?step_function:(domain -&gt; domain) -&gt;
      ?num_steps:Z.t -&gt;
      unit -&gt; (int, float * Imandra_surface.Decompose_region.t) Hashtbl.t
    val query :
      (domain -&gt; bool) -&gt;
      ?n:Z.t -&gt;
      ?d:string -&gt; ?max_std_err:Q.t -&gt; ?precision:Z.t -&gt; unit -&gt; unit
    val save : string -&gt; ?n:Z.t -&gt; ?d:domain list -&gt; unit -&gt; unit
    val load : string -&gt; domain list
  end
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<pre><code>let apple_probs_D = Apple_D.get_probs regions ~d:"apple.csv" () [@@program];;</code></pre>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Estimating-Query-Probabilities">Estimating Query Probabilities<a class="anchor-link" href="#Estimating-Query-Probabilities">&#182;</a></h3><p>The last feature we'll introduce in this notebook is the <code>query</code> function which, given a statistical model, estimates how likely it is for a particular Boolean query to hold over an instance from that distribution. <code>query</code> takes in a Boolean function over the domain (representing some condition) and the following optional arguments:</p>
<ul>
<li><code>n</code>: The number of samples to be generated for calculating probabilities (only applies when using <code>From_Sampler</code>, default value is <code>10000</code>)</li>
<li><code>d</code>: The file name of the dataset of samples to be imported (only applies when using <code>From_Data</code>)</li>
<li><code>max_std_err</code>: If estimating the probability by generating samples we can improve our estimate to within this optional bound on the standard error by taking more samples</li>
<li><code>precision</code>: The number of decimal places that probabalities are displayed to (default is <code>4</code>)</li>
</ul>
<p>Let's begin by writing a simple query, then calculate its probability:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-23" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="k">let</span> <span class="n">rip_off</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">apple</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">price</span> <span class="n">a</span><span class="o">)</span> <span class="o">&gt;=.</span> <span class="mi">30</span><span class="o">.</span> <span class="o">&amp;&amp;</span> <span class="n">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_ripe</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>val rip_off : apple -&gt; bool = &lt;fun&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Sampling-Queries">Sampling Queries<a class="anchor-link" href="#Sampling-Queries">&#182;</a></h4></div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-25" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="nn">Apple_S</span><span class="p">.</span><span class="n">query</span> <span class="n">rip_off</span> <span class="o">~</span><span class="n">n</span><span class="o">:</span><span class="mi">30000</span> <span class="bp">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Probability: 0.1179 Â± 0.0019
- : unit = ()
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Dataset-Queries">Dataset Queries<a class="anchor-link" href="#Dataset-Queries">&#182;</a></h4><p>Note once again that as we don't have access to <code>apple.csv</code> from this notebook, the following code is non-executable here:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<pre><code>Apple_D.query rip_off ~d:"apple.csv" ()</code></pre>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Optional:-Changing-the-Pseudo-Random-Number-Generator">Optional: Changing the Pseudo-Random Number Generator<a class="anchor-link" href="#Optional:-Changing-the-Pseudo-Random-Number-Generator">&#182;</a></h3><p>Sampling in the <code>Region_probs</code> module relies on access to a Pseudo-Random Number Generator (PRNG) that can produce uniform samples from the range <code>[0,1)</code>. Presently we support three PRNGs which can be changed according to the user's preferences, although in practice this should make little difference. The different PRNGs are:</p>
<ul>
<li><code>RS</code>: OCaml's standard PRNG using module Random.State</li>
<li><code>NC</code>: Cryptographic Fortuna PRNG using module Nocrypto.Rng</li>
<li><code>GSL</code>: GNU Scientific Library's Mersenne Twister PRNG using module Gsl.Rng</li>
</ul>
<p><code>NC</code> is the default option (as it produces higher quality, 'more random' output than the other two). The PRNG can be checked and changed using the <code>get_prng</code> and <code>set_prng</code> functions as follows:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="try-this-container">
  <a href="https://try.imandra.ai/launch/?next=/h/user-redirect/notebooks/Region%20Probabilities.ipynb%23try-cell-29" target="_blank" rel="nofollow">
    <div class="try-this">Try this!</div>
  </a>
</div>
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ocaml"><pre><span></span><span class="n">get_prng</span> <span class="bp">()</span><span class="o">;;</span>
<span class="n">set_prng</span> <span class="nc">GSL</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>NC: Cyrptographic Fortuna PRNG using module Nocrypto.Rng
- : unit = ()
- : unit = ()
</pre>
</div>

</div>

</div>
</div>

</div>
                    </div>

                    <div class="sidebar-right">
                        <div class="sidebar-right__menu">
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h1" href="#Region-Probabilities">Region Probabilities</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h3" href="#Setup">Setup</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h3" href="#Basic-Distributions">Basic Distributions</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h3" href="#Building-Statistical-Models">Building Statistical Models</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h3" href="#Estimating-Region-Probabilities">Estimating Region Probabilities</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h4" href="#Sampling-Over-Regions">Sampling Over Regions</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h4" href="#Datasets-Over-Regions">Datasets Over Regions</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h3" href="#Estimating-Query-Probabilities">Estimating Query Probabilities</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h4" href="#Sampling-Queries">Sampling Queries</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h4" href="#Dataset-Queries">Dataset Queries</a>
                            
                            <a class="sidebar-right__menu-item sidebar-right__menu-item--h3" href="#Optional:-Changing-the-Pseudo-Random-Number-Generator">Optional: Changing the Pseudo-Random Number Generator</a>
                            
                        </div>
                    </div></article>
            </main>
            <footer class="footer">
                <a class="copyrights"href="http://imandra.ai">&#9400; 2018 - 2019 Imandra Inc. All rights reserved.</a>
            </footer>
        </div>
    
 


    </body>
</html>
